import{_ as l,r as d,o as t,c as o,a as e,e as n,d as a,b as i}from"./app-846c6d50.js";const r={},c=i(`<h1 id="安装" tabindex="-1"><a class="header-anchor" href="#安装" aria-hidden="true">#</a> 安装</h1><h2 id="docker安装" tabindex="-1"><a class="header-anchor" href="#docker安装" aria-hidden="true">#</a> docker安装</h2><p>参考链接：https://github.com/gogs/gogs/tree/main/docker</p><h3 id="拉取镜像" tabindex="-1"><a class="header-anchor" href="#拉取镜像" aria-hidden="true">#</a> 拉取镜像</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull gogs/gogs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="创建卷映射目录" tabindex="-1"><a class="header-anchor" href="#创建卷映射目录" aria-hidden="true">#</a> 创建卷映射目录</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /var/gogs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>目录结构：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/var/gogs
|-- git
|   |-- gogs-repositories
|-- ssh
|   |-- # ssh public/private keys for Gogs
|-- gogs
    |-- conf
    |-- data
    |-- log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="创建docker实例" tabindex="-1"><a class="header-anchor" href="#创建docker实例" aria-hidden="true">#</a> 创建docker实例</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">--name</span><span class="token operator">=</span>gogs <span class="token parameter variable">-p</span> <span class="token number">10022</span>:22 <span class="token parameter variable">-p</span> <span class="token number">10880</span>:3000 <span class="token parameter variable">-v</span> /var/gogs:/data gogs/gogs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>端口解析：10022为git服务访问端口 10880为web管理服务访问端口</p><h3 id="应用设置" tabindex="-1"><a class="header-anchor" href="#应用设置" aria-hidden="true">#</a> 应用设置</h3><p><strong>Repository Root Path</strong>: 默认/home/git/gogs-repositories，不用修改。</p><p><strong>Run User</strong>: 默认git，不用修改。</p><p><strong>Domain</strong>：docker容器ip，如果需要在docker宿主机外访问gogs服务需要设置该参数。此时运行gogs的容器就需要独立的网络ip。</p><p><strong>SSH Port</strong>：Use the exposed port from Docker container. For example, your SSH server listens on <code>22</code> inside Docker, <strong>but</strong> you expose it by <code>10022:22</code>, then use <code>10022</code> for this value. <strong>Builtin SSH server is not recommended inside Docker Container</strong></p><p><strong>HTTP Port</strong>:容器内http服务监听的端口</p><p><strong>Application URL</strong>: Use combination of <strong>Domain</strong> and <strong>exposed HTTP Port</strong> values (e.g. <code>http://192.168.99.100:10880/</code>).</p><h3 id="容器设置" tabindex="-1"><a class="header-anchor" href="#容器设置" aria-hidden="true">#</a> 容器设置</h3><p>This container has some options available via environment variables, these options are opt-in features that can help the administration of this container:</p>`,21),u=i("<li>SOCAT_LINK: <ul><li>Possible value: <code>true</code>, <code>false</code>, <code>1</code>, <code>0</code></li><li>Default: <code>true</code></li><li>Action: Bind linked docker container to localhost socket using socat. Any exported port from a linked container will be binded to the matching port on localhost.</li><li>Disclaimer: As this option rely on the environment variable created by docker when a container is linked, this option should be deactivated in managed environment such as Rancher or Kubernetes (set to <code>0</code> or <code>false</code>)</li></ul></li><li>RUN_CROND: <ul><li>Possible value: <code>true</code>, <code>false</code>, <code>1</code>, <code>0</code></li><li>Default: <code>false</code></li><li>Action: Request crond to be run inside the container. Its default configuration will periodically run all scripts from <code>/etc/periodic/${period}</code> but custom crontabs can be added to <code>/var/spool/cron/crontabs/</code>.</li></ul></li>",2),p=e("li",null,[n("Possible value: "),e("code",null,"3h"),n(", "),e("code",null,"7d"),n(", "),e("code",null,"3M")],-1),b=e("li",null,[n("Default: "),e("code",null,"null")],-1),m=e("code",null,"RUN_CROND",-1),v=e("code",null,"true",-1),h={href:"https://github.com/gogs/gogs/tree/main/docker#backup-system",target:"_blank",rel:"noopener noreferrer"},g=e("li",null,[n("Possible value: "),e("code",null,"360m"),n(", "),e("code",null,"7d"),n(", "),e("code",null,"...m/d")],-1),k=e("li",null,[n("Default: "),e("code",null,"7d")],-1),f={href:"https://github.com/gogs/gogs/tree/main/docker#backup-system",target:"_blank",rel:"noopener noreferrer"},_=e("li",null,[n("Possible value: "),e("code",null,"/app/gogs/example/custom/config")],-1),x=e("li",null,[n("Default: "),e("code",null,"null")],-1),y=e("code",null,"--config",-1),P=e("code",null,"gogs backup",-1),R={href:"https://github.com/gogs/gogs/tree/main/docker#backup-system",target:"_blank",rel:"noopener noreferrer"},D=e("li",null,[n("Possible value: "),e("code",null,"test-repo1"),n(", "),e("code",null,"test-repo2")],-1),S=e("li",null,[n("Default: "),e("code",null,"null")],-1),B=e("code",null,"--exclude-repos",-1),w=e("code",null,"gogs backup",-1),A={href:"https://github.com/gogs/gogs/tree/main/docker#backup-system",target:"_blank",rel:"noopener noreferrer"},T=e("li",null,[n("Possible value: "),e("code",null,"--verbose --exclude-mirror-repos")],-1),U=e("li",null,[n("Default: "),e("code",null,"null")],-1),E=e("code",null,"gogs backup",-1),N={href:"https://github.com/gogs/gogs/tree/main/docker#backup-system",target:"_blank",rel:"noopener noreferrer"},I=i('<h3 id="备份" tabindex="-1"><a class="header-anchor" href="#备份" aria-hidden="true">#</a> 备份</h3><p>Automated backups with retention policy:</p><ul><li><code>BACKUP_INTERVAL</code> controls how often the backup job runs and supports interval in hours (h), days (d), and months (M), eg. <code>3h</code>, <code>7d</code>, <code>3M</code>. The lowest possible value is one hour (<code>1h</code>).</li><li><code>BACKUP_RETENTION</code> supports expressions in minutes (m) and days (d), eg. <code>360m</code>, <code>2d</code>. The lowest possible value is 60 minutes (<code>60m</code>).</li></ul><h3 id="升级" tabindex="-1"><a class="header-anchor" href="#升级" aria-hidden="true">#</a> 升级</h3><p>​ 警告：数据一定要保存到容器外，即运行容器时指定参数 -v /var/gogs:/data 将数据目录映射到宿主机中。</p><p>升级步骤:</p><ul><li><p><code>docker pull gogs/gogs</code></p></li><li><p><code>docker stop gogs</code></p></li><li><p><code>docker rm gogs</code></p></li><li><p>最后使用之前运行容器实例相同的参数运行新实例。</p><h3 id="高级配置" tabindex="-1"><a class="header-anchor" href="#高级配置" aria-hidden="true">#</a> 高级配置</h3></li></ul>',7),C={href:"http://www.ateijelo.com/blog/2016/07/09/share-port-22-between-docker-gogs-ssh-and-local-system",target:"_blank",rel:"noopener noreferrer"},O=i('<h2 id="gogs服务初始化" tabindex="-1"><a class="header-anchor" href="#gogs服务初始化" aria-hidden="true">#</a> gogs服务初始化</h2><h3 id="数据库配置" tabindex="-1"><a class="header-anchor" href="#数据库配置" aria-hidden="true">#</a> 数据库配置</h3><p>​ 数据库使用mysql</p><h2 id="配置ssh认证密钥" tabindex="-1"><a class="header-anchor" href="#配置ssh认证密钥" aria-hidden="true">#</a> 配置ssh认证密钥</h2><h3 id="界面配置步骤" tabindex="-1"><a class="header-anchor" href="#界面配置步骤" aria-hidden="true">#</a> 界面配置步骤</h3><p>此处不介绍密钥如何生成。</p><p>代码下载测试，git clone ssh://git@192.168.1.103:10022/cxf/test.git 或者 git clone http://192.168.1.103:10880/cxf/test.git 仓库地址根据实际情况修改。</p><h2 id="二进制包安装" tabindex="-1"><a class="header-anchor" href="#二进制包安装" aria-hidden="true">#</a> 二进制包安装</h2><p>参考地址：https://gogs.io/docs/installation/install_from_binary</p><h3 id="包下载地址" tabindex="-1"><a class="header-anchor" href="#包下载地址" aria-hidden="true">#</a> 包下载地址</h3><p>​ https://gogs.io/docs/installation/install_from_binary</p><h3 id="安装步骤概述" tabindex="-1"><a class="header-anchor" href="#安装步骤概述" aria-hidden="true">#</a> 安装步骤概述</h3>',12),K={href:"https://gogs.io/docs/installation",target:"_blank",rel:"noopener noreferrer"},V=i("<li>解压压缩包。</li><li>使用命令 <code>cd</code> 进入到刚刚创建的目录。</li><li>执行命令 <code>./gogs web</code>。</li><li>Gogs 默认会在端口 <code>3000</code> 启动 HTTP 服务，访问 <code>/install</code> 以进行初始配置（例如 http://localhost:3000/install ）。</li>",4),G={href:"https://gogs.io/docs/installation/configuration_and_run.html",target:"_blank",rel:"noopener noreferrer"},L=i(`<h3 id="安装环境" tabindex="-1"><a class="header-anchor" href="#安装环境" aria-hidden="true">#</a> 安装环境</h3><h4 id="docker安装ubuntu" tabindex="-1"><a class="header-anchor" href="#docker安装ubuntu" aria-hidden="true">#</a> docker安装ubuntu</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-itd</span> <span class="token parameter variable">--name</span><span class="token operator">=</span>ubuntu_gogs <span class="token parameter variable">-p</span> <span class="token number">10023</span>:22 <span class="token parameter variable">-p</span> <span class="token number">10881</span>:3000  cxf/ubuntu:0.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="安装git" tabindex="-1"><a class="header-anchor" href="#安装git" aria-hidden="true">#</a> 安装git</h4><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>apt-get install -y git
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>报错:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>root@1db2ec488772:/# apt-get install -y git
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
Some packages could not be installed. This may mean that you have
requested an impossible situation or if you are using the unstable
distribution that some required packages have not yet been created
or been moved out of Incoming.
The following information may help to resolve the situation:

The following packages have unmet dependencies:
 perl : Depends: perl-base (= 5.26.1-6ubuntu0.6) but 5.34.0-3ubuntu1.1 is to be installed
 perl-base : Breaks: perl (&lt; 5.34.0~) but 5.26.1-6ubuntu0.6 is to be installed
E: Error, pkgProblemResolver::Resolve generated breaks, this may be caused by held packages.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>解决错误：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-f</span> perl-base<span class="token operator">=</span><span class="token number">5.26</span>.1-6
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>root@1db2ec488772:/# apt install -f perl-base=5.26.1-6
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
Suggested packages:
  perl
The following packages will be REMOVED:
  usrmerge
The following packages will be DOWNGRADED:
  perl-base
0 upgraded, 0 newly installed, 1 downgraded, 1 to remove and 0 not upgraded.
Need to get 1391 kB of archives.
After this operation, 115 kB disk space will be freed.
Do you want to continue? [Y/n] y
0% [Working]
Get:1 http://mirrors.aliyun.com/ubuntu bionic/main amd64 perl-base amd64 5.26.1-6 [1391 kB]
Fetched 1391 kB in 13s (104 kB/s)
debconf: delaying package configuration, since apt-utils is not installed
(Reading database ... 10000 files and directories currently installed.)
Removing usrmerge (25ubuntu2) ...
dpkg: warning: downgrading perl-base from 5.34.0-3ubuntu1.1 to 5.26.1-6
(Reading database ... 9974 files and directories currently installed.)
Preparing to unpack .../perl-base_5.26.1-6_amd64.deb ...
Unpacking perl-base (5.26.1-6) over (5.34.0-3ubuntu1.1) ...
Setting up perl-base (5.26.1-6) ...

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>安装成功：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">git</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>root@1db2ec488772:/# git --version
git version 2.17.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="安装ssh服务" tabindex="-1"><a class="header-anchor" href="#安装ssh服务" aria-hidden="true">#</a> 安装ssh服务</h4><p>执行安装命令报错：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">apt-get</span> <span class="token function">install</span>  openssh-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>root@1db2ec488772:/# apt-get install  openssh-server
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
Some packages could not be installed. This may mean that you have
requested an impossible situation or if you are using the unstable
distribution that some required packages have not yet been created
or been moved out of Incoming.
The following information may help to resolve the situation:

The following packages have unmet dependencies:
 libc6 : Breaks: openssh-server (&lt; 1:8.2p1-4) but 1:7.6p1-4ubuntu0.7 is to be installed
         Recommends: libnss-nis but it is not installable
         Recommends: libnss-nisplus but it is not installable
E: Unable to correct problems, you have held broken packages.

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>root@1db2ec488772:/<span class="token comment"># apt-cache policy libc6 openssh-server</span>
libc6:
  Installed: <span class="token number">2.35</span>-0ubuntu3.1
  Candidate: <span class="token number">2.35</span>-0ubuntu3.1
  Version table:
 *** <span class="token number">2.35</span>-0ubuntu3.1 <span class="token number">100</span>
        <span class="token number">100</span> /var/lib/dpkg/status
     <span class="token number">2.27</span>-3ubuntu1.6 <span class="token number">500</span>
        <span class="token number">500</span> http://mirrors.aliyun.com/ubuntu bionic-updates/main amd64 Packages
        <span class="token number">500</span> http://mirrors.163.com/ubuntu bionic-updates/main amd64 Packages
     <span class="token number">2.27</span>-3ubuntu1.5 <span class="token number">500</span>
        <span class="token number">500</span> http://mirrors.aliyun.com/ubuntu bionic-security/main amd64 Packages
        <span class="token number">500</span> http://mirrors.163.com/ubuntu bionic-security/main amd64 Packages
     <span class="token number">2.27</span>-3ubuntu1 <span class="token number">500</span>
        <span class="token number">500</span> http://mirrors.aliyun.com/ubuntu bionic/main amd64 Packages
        <span class="token number">500</span> http://mirrors.163.com/ubuntu bionic/main amd64 Packages
openssh-server:
  Installed: <span class="token punctuation">(</span>none<span class="token punctuation">)</span>
  Candidate: <span class="token number">1</span>:7.6p1-4ubuntu0.7
  Version table:
     <span class="token number">1</span>:7.6p1-4ubuntu0.7 <span class="token number">500</span>
        <span class="token number">500</span> http://mirrors.aliyun.com/ubuntu bionic-updates/main amd64 Packages
        <span class="token number">500</span> http://mirrors.163.com/ubuntu bionic-updates/main amd64 Packages
     <span class="token number">1</span>:7.6p1-4ubuntu0.5 <span class="token number">500</span>
        <span class="token number">500</span> http://mirrors.aliyun.com/ubuntu bionic-security/main amd64 Packages
        <span class="token number">500</span> http://mirrors.163.com/ubuntu bionic-security/main amd64 Packages
     <span class="token number">1</span>:7.6p1-4 <span class="token number">500</span>
        <span class="token number">500</span> http://mirrors.aliyun.com/ubuntu bionic/main amd64 Packages
        <span class="token number">500</span> http://mirrors.163.com/ubuntu bionic/main amd64 Packages
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最后执行命令升级所有包，才正确安装了openssh-server</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">apt-get</span> upgrade
<span class="token function">apt-get</span> <span class="token function">install</span>  openssh-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>root@1db2ec488772:/# service ssh start
 * Starting OpenBSD Secure Shell server sshd                                                                                                                                                 [ OK ]
root@1db2ec488772:/# service ssh restart
 * Restarting OpenBSD Secure Shell server sshd                                                                                                                                               [ OK ]
root@1db2ec488772:/# service ssh status
 * sshd is running
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,22);function q(H,M){const s=d("ExternalLinkIcon");return t(),o("div",null,[c,e("ul",null,[u,e("li",null,[n("BACKUP_INTERVAL: "),e("ul",null,[p,b,e("li",null,[n("Action: In combination with "),m,n(" set to "),v,n(", enables backup system. See: "),e("a",h,[n("Backup System"),a(s)])])])]),e("li",null,[n("BACKUP_RETENTION: "),e("ul",null,[g,k,e("li",null,[n("Action: Used by backup system. Backups older than specified in expression are deleted periodically. See: "),e("a",f,[n("Backup System"),a(s)])])])]),e("li",null,[n("BACKUP_ARG_CONFIG: "),e("ul",null,[_,x,e("li",null,[n("Action: Used by backup system. If defined, supplies "),y,n(" argument to "),P,n(". See: "),e("a",R,[n("Backup System"),a(s)])])])]),e("li",null,[n("BACKUP_ARG_EXCLUDE_REPOS: "),e("ul",null,[D,S,e("li",null,[n("Action: Used by backup system. If defined, supplies "),B,n(" argument to "),w,n(". See: "),e("a",A,[n("Backup System"),a(s)])])])]),e("li",null,[n("BACKUP_EXTRA_ARGS: "),e("ul",null,[T,U,e("li",null,[n("Action: Used by backup system. If defined, append content to arguments to "),E,n(". See: "),e("a",N,[n("Backup System"),a(s)])])])])]),I,e("p",null,[n("​ "),e("a",C,[n("docker容器和宿主机共用22端口的配置"),a(s)])]),O,e("ol",null,[e("li",null,[n("检查"),e("a",K,[n("环境要求"),a(s)]),n("是否已满足")]),V]),e("p",null,[n("安装完成后可继续参照 "),e("a",G,[n("配置与运行"),a(s)]),n("。")]),L])}const j=l(r,[["render",q],["__file","gogs.html.vue"]]);export{j as default};
