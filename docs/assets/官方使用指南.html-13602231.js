import{_ as o,r as p,o as i,c as l,e as a,w as u,d as s,a as n,b as e}from"./app-b63b8632.js";const r="/notes/assets/image-20231114152756160-ebe47335.png",d="/notes/assets/image-20231114152907992-371599ed.png",k="/notes/assets/block-graph-IRExamples-runBinarySearchIterativelyTryCatch-3-91213f227f0d525b2f4b2dd20d65799d-97255241.svg",v="/notes/assets/graph-IRExamples-runBinarySearchIterativelyTryCatch-3-b1b5ea61a4a8aad2ac98e69e4abd8d45-bff53448.svg",m={},h=e(`<p>https://jacodb.org/documentation/installation/</p><p>有些例子已经不符合最新版本。</p><h1 id="一-安装" tabindex="-1"><a class="header-anchor" href="#一-安装" aria-hidden="true">#</a> 一 安装</h1><p>​ 项目中添加JacoDB。</p><h2 id="gradle" tabindex="-1"><a class="header-anchor" href="#gradle" aria-hidden="true">#</a> Gradle</h2><p>​ 在build.gradle.kts文件的dependencies节点添加以下内容</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>implementation(group = &quot;org.jacodb&quot;, name = &quot;jacodb-api&quot;, version = jacodbVersion)
implementation(group = &quot;org.jacodb&quot;, name = &quot;jacodb-core&quot;, version = jacodbVersion)
implementation(group = &quot;org.jacodb&quot;, name = &quot;jacodb-analysis&quot;, version = jacodbVersion)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="maven" tabindex="-1"><a class="header-anchor" href="#maven" aria-hidden="true">#</a> Maven</h2><p>​ 在pom.xml的dependencies节点添加以下依赖：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.jacodb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jacodb-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.jacodb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jacodb-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.jacodb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jacodb-analysis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="二-基本使用" tabindex="-1"><a class="header-anchor" href="#二-基本使用" aria-hidden="true">#</a> 二 基本使用</h1><p>​ JacoDB API的两个级别：</p><p>​ 🍸一个是提供代表文件系统级别的信息，例如bytecode和classes信息。</p><p>​ 🍸另一个提供运行时信息，例如types。</p><p>​ bytecode和classes信息来自.class 文件：包含方法、字段等的类。</p><p>​ types表示可以是可空的、带有参数的类型。例如：</p><p>​ 类图：</p><p><img src="`+r+'" alt="image-20231114152756160"></p><p>​ 类型图：</p><p><img src="'+d+`" alt="image-20231114152907992"></p><p>​ 这两个层次都与 JcClasspath 相关联。您无法修改从纯字节码中检索的类。types可能通过泛型替换手动构建。</p><p>​ JcClasspath 是classes和types的入口。</p><p>​ JcClassOrInterface 代表着一个类文件。数组或者原始类型没有JcClassOrInterface。</p><p>​ JcType 代表来自 JVM 运行时的类型。</p><p>​ JcClassType#methods包括：</p><p>​ 封装类的public/protected/private方法。</p><p>​ 在编译时可见的所有祖先方法。</p><p>​ 仅来自声明类的构造方法。</p><p>​ JcClassType#fields包括：</p><p>​ 封装类的public/protected/private字段。</p><p>​ 在编译时可见的所有祖先字段。</p><h3 id="获取已声明的方法" tabindex="-1"><a class="header-anchor" href="#获取已声明的方法" aria-hidden="true">#</a> 获取已声明的方法</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Example</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">MethodNode</span> <span class="token function">findNormalDistribution</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">File</span> commonsMath32 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;commons-math3-3.2.jar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">File</span> commonsMath36 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;commons-math3-3.6.1.jar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">File</span> buildDir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;my-project/build/classes/java/main&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JcDatabase</span> database <span class="token operator">=</span> <span class="token class-name">JacoDB</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">JcSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">useProcessJavaRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">persistent</span><span class="token punctuation">(</span><span class="token string">&quot;/tmp/compilation-db/&quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// persist data</span>
        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Let&#39;s load these three bytecode locations</span>
        database<span class="token punctuation">.</span><span class="token function">asyncLoad</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>commonsMath32<span class="token punctuation">,</span> commonsMath36<span class="token punctuation">,</span> buildDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// This method just refreshes the libraries inside the database. If there are any changes in libs then </span>
        <span class="token comment">// the database updates data with the new results.</span>
        database<span class="token punctuation">.</span><span class="token function">asyncLoad</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span>buildDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Let&#39;s assume that we want to get bytecode info only for \`commons-math3\` version 3.2.</span>
        <span class="token class-name">JcClassOrInterface</span> jcClass <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">asyncClasspath</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>commonsMath32<span class="token punctuation">,</span> buildDir<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findClassOrNull</span><span class="token punctuation">(</span><span class="token string">&quot;org.apache.commons.math3.distribution.NormalDistribution&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jcClass<span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jcClass<span class="token punctuation">.</span><span class="token function">getAnnotations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">JcClasses</span><span class="token punctuation">.</span><span class="token function">getConstructors</span><span class="token punctuation">(</span>jcClass<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// At this point the database read the method bytecode and return the result.</span>
        <span class="token keyword">return</span> jcClass<span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">asmNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 如果待处理的 JAR 文件被更改或移除，<code>body</code> 方法将返回 null。如果类环境不完整（即，类路径中找不到方法的超类、接口、返回类型或参数），则 API 在运行时会抛出 <code>NoClassInClasspathException</code>。</p><h3 id="监听文件系统更新" tabindex="-1"><a class="header-anchor" href="#监听文件系统更新" aria-hidden="true">#</a> 监听文件系统更新</h3><p>​ 数据库可以在后台监视文件系统的变化，并显式刷新 JAR 文件：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">watchFileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
<span class="token class-name">JcDatabase</span> database <span class="token operator">=</span> <span class="token class-name">JacoDB</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JcSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">watchFileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">useProcessJavaRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">loadByteCode</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>lib1<span class="token punctuation">,</span> buildDir<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">persistent</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// A user rebuilds the buildDir folder.</span>
    <span class="token comment">// The database re-reads the rebuilt directory in the background.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="获取type信息" tabindex="-1"><a class="header-anchor" href="#获取type信息" aria-hidden="true">#</a> 获取type信息</h3><p>​ types包括：</p><p>​ 基本类型，</p><p>​ 类，</p><p>​ 数组，</p><p>​ 有界和无界通配符</p><p>​ types级别表示根据给定泛型类型中的参数替代所呈现的运行时行为。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">A</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token class-name">T</span> x <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">A</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">typesSubstitution</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">JcClassType</span> b <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">JcClassType</span><span class="token punctuation">)</span>classpath<span class="token punctuation">.</span><span class="token function">findTypeOrNull</span><span class="token punctuation">(</span><span class="token string">&quot;org.jacodb.examples.JavaReadMeExamples.B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">JcType</span> xType <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">getFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>it <span class="token operator">-&gt;</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFieldType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">JcClassType</span> stringType <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">JcClassType</span><span class="token punctuation">)</span> classpath<span class="token punctuation">.</span><span class="token function">findTypeOrNull</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>xType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>stringType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// will print &quot;true&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="多线程" tabindex="-1"><a class="header-anchor" href="#多线程" aria-hidden="true">#</a> 多线程</h3><p>​ <code>JcClassOrInterface</code>、<code>JcMethod</code> 和 <code>JcClasspath</code> 的实例是线程安全且不可变的。</p><p>​ <code>JcClasspath</code> 表示类的一个独立快照，自创建以来无法修改。删除或修改库文件不会影响 <code>JcClasspath</code> 实例的结构。<code>JcClasspath#close</code> 方法释放所有快照并清理持久化的数据，如果某些库已过时。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">JcDatabase</span> database <span class="token operator">=</span> <span class="token class-name">JacoDB</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">JcSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">watchFileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">useProcessJavaRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">loadByteCode</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>lib1<span class="token punctuation">,</span> buildDir<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">persistent</span><span class="token punctuation">(</span><span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">JcClasspath</span> cp <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">asyncClasspath</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span>buildDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        database<span class="token punctuation">.</span><span class="token function">asyncRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// does not affect cp classes</span>

        <span class="token class-name">JcClasspath</span> cp1 <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">asyncClasspath</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span>buildDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// will use new version of compiled results in buildDir</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 如果对 <code>JcClasspath</code> 实例的请求包含尚未索引的库，则会触发索引过程，并返回 <code>JcClasspath</code> 集合的新实例。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">autoProcessing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
    <span class="token class-name">JcDatabase</span> database <span class="token operator">=</span> <span class="token class-name">JacoDB</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">JcSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">loadByteCode</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>lib1<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">persistent</span><span class="token punctuation">(</span><span class="token string">&quot;...&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token class-name">JcClasspath</span> cp <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">asyncClasspath</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span>buildDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// database will automatically process buildDir</span>
        
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ JacoDB 是线程安全的。如果在另一个线程加载 JAR 文件时请求 <code>JcClasspath</code> 实例，<code>JcClasspath</code> 可以表示正在加载的 JAR 文件的一致状态。在 <code>JcClasspath</code> 中显示的是完全加载的 JAR 文件。请注意：不能保证提交用于加载的所有 JAR 文件实际上都会被加载。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Example</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        val db <span class="token operator">=</span> <span class="token class-name">JacoDB</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JcSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> db<span class="token punctuation">.</span><span class="token function">asyncLoad</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>lib1<span class="token punctuation">,</span> lib2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// maybe created when lib2 or both are not loaded into database</span>
            <span class="token comment">// but buildDir will be loaded anyway</span>
            <span class="token keyword">var</span> cp <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">asyncClasspath</span><span class="token punctuation">(</span>buildDir<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="bytecode加载" tabindex="-1"><a class="header-anchor" href="#bytecode加载" aria-hidden="true">#</a> Bytecode加载</h3><p>​ 字节码加载包括两个步骤：</p><p>​ 从 JAR 文件或构建目录中检索有关类名的信息，</p><p>​ 从 JAR 文件或构建目录中读取类的字节码并进行处理（持久化数据，设置 <code>JcFeature</code> 实现等）。</p><p>​ 在执行第一步后，JacoDB 或 JcClasspath 实例将立即返回。您在第二步期间检索类的最终表示。在这两个步骤之间的某个时刻，<code>.class</code> 文件可能会发生变化，类的表示将相应地受到影响。</p><h1 id="三-数据库特性" tabindex="-1"><a class="header-anchor" href="#三-数据库特性" aria-hidden="true">#</a> 三 数据库特性</h1><p>​ <code>Feature</code> 是一个允许基于字节码存储和查询附加信息的接口。<code>Feature</code> 需要在创建 <code>JacoDB</code> 实例时设置。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token class-name">JacoDb</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JcSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">useProcessJRE</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">persistent</span><span class="token punctuation">(</span><span class="token string">&quot;/tmp/compilation-db/\${System.currentTimeMillis()}&quot;</span><span class="token punctuation">)</span> <span class="token comment">// persist data</span>
    <span class="token punctuation">.</span><span class="token function">installFeatures</span><span class="token punctuation">(</span><span class="token class-name">Usages</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">,</span> <span class="token class-name">InMemoryHierarchy</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="inmemoryhierarchy" tabindex="-1"><a class="header-anchor" href="#inmemoryhierarchy" aria-hidden="true">#</a> <code>InMemoryHierarchy</code></h2><p>​ 默认情况下，JacoDB 将类层次结构的信息存储在 SQL 数据库中（<code>ClassHierarchies</code> 表，包含列：<code>class_id</code>、<code>super_id</code>、<code>is_interface</code>）。这允许我们使用递归 SQL 查询检索特定类的层次结构。递归查询相当常见但也相当慢。</p><p>​ <code>InMemoryHierarchy</code> 解决了内置解决方案的性能问题。它引入了一个快速搜索的内存缓存。</p><p>​ 内存开销为 O(类的数量)。对于约 50K 个类的项目（包括运行时），这样一个缓存的内存消耗约为 ~6.5 Mb 堆内存。</p><h2 id="usages" tabindex="-1"><a class="header-anchor" href="#usages" aria-hidden="true">#</a> <code>Usages</code></h2><p>​ 您可以找到使用方法和字段的地方。为了获得更好的性能，请使用<code>InMemoryHierarchy</code>。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token class-name">JacoDb</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JcSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">useProcessJRE</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">persistent</span><span class="token punctuation">(</span><span class="token string">&quot;/tmp/compilation-db/\${System.currentTimeMillis()}&quot;</span><span class="token punctuation">)</span> <span class="token comment">// persist data</span>
    <span class="token punctuation">.</span><span class="token function">installFeatures</span><span class="token punctuation">(</span><span class="token class-name">Usages</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">,</span> <span class="token class-name">InMemoryHierarchy</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> method <span class="token operator">=</span> run<span class="token punctuation">;</span> <span class="token comment">// java.lang.Runnable#run method</span>
<span class="token keyword">var</span> field <span class="token operator">=</span> field<span class="token punctuation">;</span> <span class="token comment">// java.lang.String#value field</span>
<span class="token keyword">var</span> cp <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">asyncClasspath</span><span class="token punctuation">(</span>allClasspath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cp<span class="token punctuation">.</span><span class="token function">findUsages</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// sequence of methods which calls method</span>
cp<span class="token punctuation">.</span><span class="token function">findUsages</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> <span class="token class-name">FieldUsageMode</span><span class="token punctuation">.</span><span class="token constant">READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// sequence of fields which reads field value</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ Usages 索引器遍历所有指令，收集关于方法调用或字段访问的信息，并将其存储在一个表中：</p><table><thead><tr><th>列名</th><th>列描述</th></tr></thead><tbody><tr><td><code>callee_class_symbol_id</code></td><td>被调用类名的唯一标识符</td></tr><tr><td><code>callee_name_symbol_id</code></td><td>方法/字段名的唯一标识符</td></tr><tr><td><code>callee_desc_hash</code></td><td>字段使用为 null；方法的字节码的 Sip 哈希，方法的描述</td></tr><tr><td><code>opcode</code></td><td>指令操作码</td></tr><tr><td><code>caller_class_symbols_id</code></td><td>调用者类名的唯一标识符</td></tr><tr><td><code>caller_method_offsets</code></td><td>此用法的方法编号</td></tr><tr><td><code>location_id</code></td><td>位置标识符</td></tr></tbody></table><h1 id="四-类路径特性" tabindex="-1"><a class="header-anchor" href="#四-类路径特性" aria-hidden="true">#</a> 四 类路径特性</h1><h2 id="classpath-features" tabindex="-1"><a class="header-anchor" href="#classpath-features" aria-hidden="true">#</a> Classpath features</h2><p>​ 特性用于基于 <code>JcClasspath</code> 字节码构建表示。在创建类路径时，应该传递这些特性。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">JcClasspath</span> cp <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">asyncClasspath</span><span class="token punctuation">(</span>files<span class="token punctuation">,</span>
    <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AppendMainMethodToAllClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="jcclasspathfeature" tabindex="-1"><a class="header-anchor" href="#jcclasspathfeature" aria-hidden="true">#</a> <code>JcClasspathFeature</code></h3><p>​ 这个类是所有特性的基类。它有两个方法：</p><p>​ <code>on(event)</code> 允许接收来自其他特性的事件；</p><p>​ <code>event(result, input)</code> 为其他特性生成事件。</p><p>​ 基本场景是缓存：当扩展获取有关代码结构的信息时，可以将此信息缓存以供将来使用。</p><h3 id="jcclasspathextfeature" tabindex="-1"><a class="header-anchor" href="#jcclasspathextfeature" aria-hidden="true">#</a> <code>JcClasspathExtFeature</code></h3><p>​ 可用于模拟或缓存：</p><ul><li><p><code>tryFindClass(classpath, name): Optional&lt;JcClassOrInterface&gt;?</code></p></li><li><p><code>tryFindType(classpath, name): Optional&lt;JcType&gt;?</code> 返回值应符合以下逻辑：</p></li><li><p>对于找到的类或类型，返回非空的 <code>Optional</code>；</p></li><li><p>对于在类路径中不存在的类或类型，返回空的 <code>Optional</code>；</p></li><li><p>当我们不知道类或类型是否存在时，返回 <code>null</code>。</p></li></ul><h3 id="jcclassextfeature" tabindex="-1"><a class="header-anchor" href="#jcclassextfeature" aria-hidden="true">#</a> <code>JcClassExtFeature</code></h3><p>可用于对类进行修补，添加新字段或方法：</p><ul><li><code>fieldsOf(clazz)</code> 返回特定类的附加字段列表；默认为 <code>null</code>。</li><li><code>methodsOf(clazz)</code> 返回特定类的附加方法列表；默认为 <code>null</code>。</li><li><code>extensionValuesOf(clazz)</code> 返回特定类的附加信息的映射。</li></ul><p><code>extensionValuesOf</code> 可以暴露有关类的特定信息，例如，来自 Kotlin 或 Scala 编译器。</p><h3 id="jcinstextfeature" tabindex="-1"><a class="header-anchor" href="#jcinstextfeature" aria-hidden="true">#</a> <code>JcInstExtFeature</code></h3><ul><li><code>transformRawInstList(method: JcMethod, list)</code> 转换原始指令列表。</li><li><code>transformInstList(method, list)</code> 转换指令列表 — 原始指令保持不变。</li></ul><h2 id="unknownclass" tabindex="-1"><a class="header-anchor" href="#unknownclass" aria-hidden="true">#</a> UnknownClass</h2><p>​ 可用于优雅地处理一些类未保留在类路径中的情况。例如：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Bar</span> <span class="token punctuation">{</span>

    <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token keyword">extends</span> <span class="token class-name">Bar</span> <span class="token punctuation">{</span>

    <span class="token class-name">Bar</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 假设我们有一个包含类 <code>Foo</code> 但不包含 <code>Bar</code> 的类路径。类路径的默认行为是在尝试访问不存在的类时失败。例如，解析方法指令将失败，读取类层次结构将失败，解析方法将失败。</p><p>​ <code>UnknownClasses</code> 特性修复了这种行为。所有指向无处的引用将解析为 <code>JcClassOrInterface</code> 实例的特殊实现。这样的实例将具有空的 <code>JcClassOrInterface.declaredFields</code> 和 <code>JcClassOrInterface.declaredMethods</code>，但通过 <code>JcClassOrInterface.lookup</code> 接口完成的所有解析将返回模拟实例。</p><h1 id="五-指令" tabindex="-1"><a class="header-anchor" href="#五-指令" aria-hidden="true">#</a> 五 指令</h1><h2 id="原始指令列表-api" tabindex="-1"><a class="header-anchor" href="#原始指令列表-api" aria-hidden="true">#</a> 原始指令列表 API</h2><p>​ <code>JcRawInstList</code> 表示三地址 Java 字节码指令的原始列表表示。 &quot;原始&quot; 意味着此表示不反映程序的类型和控制流信息。此表示是 JVM 字节码指令与三地址指令列表的一对一匹配。</p><p>​ 这个表示的基类是 <code>JcRawInstList</code>。它生成一个类似列表的指令集合，因此您可以修改此列表，迭代指令或通过索引访问它们。</p><h2 id="三地址指令" tabindex="-1"><a class="header-anchor" href="#三地址指令" aria-hidden="true">#</a> 三地址指令</h2><p><code>JcRawInst</code> 是原始指令的基础接口。所有指令都由对象标识，不能使用 equals 进行比较。</p><p>以下是 <code>JcRawInst</code> 实现的列表：</p><ul><li><code>JcAssignInst</code> — 赋值指令。指令的左侧只能是 <code>JcRawValue</code>，右侧可以是任何表达式（<code>JcRawExpr</code>）。</li><li><code>JcRawEnterMonitorInst</code>、<code>JcRawExitMonitorInst</code> — 监视器指令。直接对应它们现有的模拟。监视器属性只能是 <code>JcRawSimpleValue</code>。</li><li><code>JcRawCallInst</code> — 调用指令。表示不将其返回变量保存到任何本地变量的方法。返回值的方法调用通过 <code>JcRawAssignInst</code> 表示。</li><li><code>JcRawLabelInst</code> — 标签指令。用于标记代码中的一些程序点。主要用于分支指令中。标签通过名称标识，对标签的所有引用通过 <code>JcRawLabelRef</code> 类表示。</li><li><code>JcRawReturnInst</code> — 返回指令。当方法不返回任何内容时，<code>returnValue</code> 属性为 <code>null</code>。</li><li><code>JcRawThrowInst</code> — 抛出指令。</li><li><code>JcRawCatchInst</code> — 捕获指令。表示代码中 try...catch 块的条目。不直接映射到字节码指令，但表示方法的 <code>TryCatchBlock</code>。存储与捕获的可抛出异常对应的值，以及它从 <code>startInclusive</code> 到 <code>endExclusive</code> 的指令范围。</li><li><code>JcRawGotoInst</code> — 跳转指令。</li><li><code>JcRawIfInst</code> — 条件跳转指令。指令的条件必须是 <code>JcRawConditionExpr</code>，因为我们在更高级别的编程语言中使用的并非所有条件表达式都可以轻松表达为 JVM 字节码。</li><li><code>JcRawSwitchInst</code> — 开关指令。<code>LookupSwitch</code> 和 <code>TableSwitch</code> 字节码指令的组合表示。</li><li><code>JcRawLineNumberInst</code>—标识在源代码中的位置</li><li><code>JcRawAssignInst</code></li></ul><h2 id="原始表达式" tabindex="-1"><a class="header-anchor" href="#原始表达式" aria-hidden="true">#</a> 原始表达式</h2><p>​ <code>JcRawExpr</code> 是所有可以在 JVM 字节码中表示的表达式类型和值类型的基础接口。<code>JcRawExpr</code> 将其类型存储为 <code>TypeName</code> 对象，它只是一个表示为字符串的 Java 类型名称（这就是为什么它是 &quot;raw&quot;）。raw：原始的</p><p>以下是 <code>JcRawExpr</code> 实现的列表：</p><ul><li><code>JcRawBinaryExpr</code> — 允许实现所有算术表达式（例如 <code>JcRawAdd</code>、<code>JcRawMul</code> 等）、条件表达式（<code>JcRawEq</code>、<code>JcRawGt</code> 等）、逻辑表达式（<code>JcRawAnd</code>、<code>JcRawOr</code>、<code>JcRawXor</code>）的二元表达式。</li><li><code>JcRawConditionExpr</code> — 条件表达式。可用作 <code>JcRawIfInst</code> 中的条件。</li><li><code>JcRawLengthExpr</code> — 数组长度表达式。</li><li><code>JcRawNegExpr</code> — 取反表达式。</li><li><code>JcRawCastExpr</code> — 强制转换表达式。可用于转换引用类型和原始类型。</li><li><code>JcRawNewExpr</code> — 新建表达式。创建单个对象。</li><li><code>JcRawNewArrayExpr</code> — 新建数组表达式。创建给定类型的（多维）数组。</li><li><code>JcRawInstanceOfExpr</code> — instanceof 检查。</li><li><code>JcRawCallExpr</code> — 方法调用表达式。</li><li><code>JcRawDynamicCallExpr</code> — invokedynamic 指令表示。保留所有信息。</li><li><code>JcRawVirtualCallExpr</code></li><li><code>JcRawInterfaceCallExpr</code></li><li><code>JcRawStaticCallExpr</code></li><li><code>JcRawSpecialCallExpr</code></li><li><code>JcRawValue</code> — 单个值的表示。</li><li><code>JcRawSimpleValue</code> — 没有任何子值的简单值的表示。</li><li><code>JcRawThis</code></li><li><code>JcRawArgument</code></li><li><code>JcRawLocal</code></li><li><code>JcRawConstant</code></li><li><code>JcRawComplexValue</code> — 具有子值的复杂值。</li><li><code>JcRawFieldRef</code> — 字段引用。可用作字段读取访问（例如 <code>a = x.y</code>）和字段存储访问（例如 <code>x.y = a</code>）。</li><li><code>JcRawArrayAccess</code> — 数组元素引用。可用作数组读取访问（例如 <code>a = x[y]</code>）和数组存储访问（例如 <code>x[y] = a</code>）。</li></ul><p>要获得方法的三地址指令列表表示，需要调用 <code>JcMethod::instructionList</code>。指令列表构建需要 <code>JcClasspath</code>，因为某些阶段使用子类型信息。</p><h2 id="构建指令列表-实现细节" tabindex="-1"><a class="header-anchor" href="#构建指令列表-实现细节" aria-hidden="true">#</a> 构建指令列表：实现细节</h2><p>​ 原始指令列表构建器用于从字节码表示（即从 MethodNode）构建 JcRawInstList。要构建指令列表表示，MethodNode 应包含帧信息（即 FrameNode 实例），并且不应包含 JSR（跳转子例程）指令。因此，每次创建 ClassNode 时，我们调用 ClassNode.computeFrames() 扩展函数，该函数计算每个方法的帧信息。computeFrames 函数使用 ASM 功能来计算帧：它使用 ClassWriter 将 ClassNode 转换回字节码（实际上在转换期间执行帧计算），然后使用 ClassReader 再次读取该字节码。这不是最有效的方式，但是是最简单的方式：手动计算帧是相当困难的。另一件事是内联 JSR 指令。我们通过调用 MethodNode.jsrInlined 扩展来实现这一点，该扩展返回一个新的 MethodNode 实例。它使用 ASM 的 JSRInlinerAdapter 实用程序来创建一个带有内联 JRS 指令的新方法节点。</p><p>​ RawInstListBuilder 将 JVM 字节码指令列表转换为三地址指令列表。大多数转换过程都很简单：字节码指令映射到三地址表达式和指令。最复杂的部分是帧合并。JVM 帧描述了虚拟机在每个指令时的状态，即声明的局部变量和堆栈状态。当一条指令有多个前任时，我们需要将多个传入帧合并为一个。有时 JVM 在指令之前添加一个特殊的帧节点，以描述在合并后帧应该是什么样子。</p><p>​ 在帧合并过程中有四种可能的情况。</p><p>​ （1）只有一个传入帧，并且在转换前几个阶段已经完全定义（即我们已经收集了所有的帧信息）。在这种情况下，一切都相当简单，我们可以直接复制帧信息。但是，我们还可以为局部变量的类型信息进行细化。考虑以下字节码：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>NEW java/lang/ArrayList
ASTORE 0
...
FRAME FULL [ java/lang/List ]
...
NEW java/lang/LinkedList
ASTORE 0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 在转换前两条指令时，我们为单元 0 创建了一个局部变量 %0，其类型为 java.lang.ArrayList。但是，在转换帧信息时，我们看到 JVM 将单元 0 的类型视为 java.lang.List，然后使用单元 0 存储 Java List 的其他实现。我们可以将 %0 的类型细化为 java.lang.List，然后将所有 %0 的出现替换为新版本。这是通过使用 RawInstListBuilder 的 localTypeRefinement 属性和 ExprMapper 实用程序类执行的。</p><p>（2）只有一个传入帧，尚未定义。这是一种罕见的情况，但在以下情况下可能会发生：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>GOTO L2
L1
FRAME FULL [ java/lang/List ]
...
GOTO L3
L2
...
GOTO L1
L3
RETURN
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 在这种情况下，我们使用帧信息创建一个具有定义类型的新局部变量，并记得在前任中添加一个赋值，该赋值将使用正确的值初始化新变量。这是通过使用 laterAssignments 和 laterStackAssignments 映射以及 buildRequiredAssignments 函数在最后执行的。对于堆栈变量和局部变量，该过程类似。</p><p>（3）存在多个前任帧，所有这些前任帧都已定义（例如，在 if...else 块之后合并时）。在这种情况下，我们在当前帧中创建一个具有定义类型的新局部变量，并在前任块中添加必要的赋值。</p><p>（4）存在多个前任帧，其中不是所有帧都已定义（例如，在循环标题中合并时）。在这种情况下，我们在当前帧中创建一个具有定义类型的新局部变量，将必要的赋值添加到前任块中，并记得在最后向未定义的前任块添加所需的赋值。</p><p>​ RawInstListBuilder 还简化了生成的指令列表。这是必要的，因为列表构建过程自然引入了很多冗余。</p><p>​ 主要的简化阶段包括：</p><p>​ 1删除基本块内重复的赋值。</p><p>​ 2删除未使用变量的声明。</p><p>​ 3删除未使用变量的相互依赖声明（例如 a = b 和 b = a）。</p><p>​ 4简单的单元传播。</p><p>​ 5使用 JcClasspath 进行类型规范化。</p><h2 id="visitor-api" tabindex="-1"><a class="header-anchor" href="#visitor-api" aria-hidden="true">#</a> Visitor API</h2><p>chatGPT描述</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Visitor API 是 JacoDB 提供的一组 API，用于遍历和分析 JVM 字节码。该 API 允许你创建访问者（Visitor），并在访问 JVM 字节码时执行特定的操作。以下是该 API 的一些关键概念和类：
JcVisitor：
	这是 Visitor API 的主要接口。
	提供了许多 visit 方法，用于处理不同类型的元素，如类、方法、字段等。
	你可以实现此接口并重写相关的 visit 方法，以在访问字节码元素时执行自定义的逻辑。
JcNode：
	JcNode 是所有字节码元素的通用父类。
	表示字节码中的一个节点，可以是类、方法、字段等。
JcClassNode：
	表示类节点，继承自 JcNode。
	包含有关类的信息，如类名、父类、接口等。
JcMethodNode：
	表示方法节点，继承自 JcNode。
	包含有关方法的信息，如方法名、参数、返回类型等。
JcFieldNode：
	表示字段节点，继承自 JcNode。
	包含有关字段的信息，如字段名、类型等。
通过实现 JcVisitor 接口，你可以创建一个遍历字节码的自定义访问者，并在需要时执行相应的操作。这使得 JacoDB 成为一个强大的工具，用于分析和处理 Java 字节码。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 这里有一个用于遍历和修改 <code>JcRawInstList</code> 的访问者 API。访问者具有标准接口 - 它们可以通过在指令和表达式上使用 <code>accept</code> 方法来调用：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>val a = jcRawInst.accept(MyInstVisitor())
val b = jcRawExpr.accept(MyExprVisitor())
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 我们还提供了一些类似&quot;函数式&quot;的扩展，用于将访问者应用于 <code>JcRawInstList</code>：</p><ul><li><code>filter(visitor: JcRawInstVisitor&lt;Boolean&gt;): JcRawInstList</code></li><li><code>filterNot(visitor: JcRawInstVisitor&lt;Boolean&gt;): JcRawInstList</code></li><li><code>map(visitor: JcRawInstVisitor&lt;JcRawInst&gt;): JcRawInstList</code></li><li><code>mapNotNull(visitor: JcRawInstVisitor&lt;JcRawInst?&gt;): JcRawInstList</code></li><li><code>flatMap(visitor: JcRawInstVisitor&lt;Collection&lt;JcRawInst&gt;&gt;): JcRawInstList</code></li><li><code>apply(visitor: JcRawInstVisitor&lt;Unit&gt;): JcRawInstList</code></li><li><code>applyAndGet(visitor: T, getter: (T) -&gt; R): R</code></li><li><code>collect(visitor: JcRawInstVisitor&lt;T&gt;): Collection&lt;T&gt;</code></li></ul><p>​ <code>jcdb-core</code> 包含一些用于处理指令列表的实用访问者：</p><p>​ <code>ExprMapper(val mapping: Map&lt;JcRawExpr, JcRawExpr&gt;)</code> — 遍历指令列表，并将所有出现在映射中的表达式替换为相应的属性。</p><p>​ <code>FullExprSetCollector()</code> — 收集在给定对象（指令列表、单个指令或表达式）中出现的所有表达式。</p><p>​ <code>InstructionFilter(val predicate: (JcRawInst) -&gt; Boolean)</code> — 通过给定的谓词对指令进行过滤。</p><p>​ JcRawInstList可以使用MethodNodeBuilder.build()方法转换回ASM MethodNode。转换过程非常直接，不需要额外的注释。</p><h2 id="例子" tabindex="-1"><a class="header-anchor" href="#例子" aria-hidden="true">#</a> 例子</h2><p>try...catch的二分搜索实现的块图</p><p><img src="`+k+'" alt="Block graph"></p><p>try...catch的二分搜索实现的控制流图:</p><p><img src="'+v+`" alt="Block graph"></p><h1 id="六-图" tabindex="-1"><a class="header-anchor" href="#六-图" aria-hidden="true">#</a> 六 图</h1><h2 id="控制流图api" tabindex="-1"><a class="header-anchor" href="#控制流图api" aria-hidden="true">#</a> 控制流图API</h2><p>​ 方法的控制流图表示为一个JcGraph对象。要创建方法的JcGraph，可以调用三地址指令列表的<code>graph</code>函数：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>fun <span class="token function">createGraph</span><span class="token punctuation">(</span>classpath<span class="token operator">:</span> <span class="token class-name">JcClasspath</span><span class="token punctuation">,</span> method<span class="token operator">:</span> <span class="token class-name">JcMethod</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token class-name">JcGraph</span> <span class="token punctuation">{</span>
    val instructionList <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">instructionList</span><span class="token punctuation">(</span>classpath<span class="token punctuation">)</span>
    <span class="token keyword">return</span> instructionList<span class="token punctuation">.</span><span class="token function">graph</span><span class="token punctuation">(</span>classpath<span class="token punctuation">,</span> method<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="jcgraph" tabindex="-1"><a class="header-anchor" href="#jcgraph" aria-hidden="true">#</a> <code>JcGraph</code></h2><p>​ JcGraph的中间表示使用了已解析的类型信息（即JcType层次结构）和类路径信息，因此需要一个类路径实例。与JcRawInstList类似，JcGraph存储了方法指令的列表。然而，它还尝试解析方法中的所有执行路径。JcGraph操作JcInst类层次结构（在许多情况下类似于JcRawInst），并提供以下API：</p><ul><li><code>entry: JcInst</code> — 获取方法的入口点：只能有一个入口点。</li><li><code>exits: List&lt;JcInst&gt;</code> — 获取方法的所有“正常”退出点，即所有返回和抛出指令。</li><li><code>throwExits: Map&lt;JcType, List&lt;JcInst&gt;&gt;</code> — 方法的所有潜在异常退出点。</li><li><code>ref(inst: JcInst): JcInstRef</code> — 获取指令的JcInstRef。它是一个轻量级的包装器，允许在需要时引用指令。</li><li><code>inst(ref: JcInstRef): JcInst</code> — 将JcInstRef转换为JcInst。</li><li><code>previous(inst: JcInst): JcInst</code> — 获取列表中的前一条指令。</li><li><code>next(inst: JcInst): JcInst</code> — 获取列表中的下一条指令。</li><li><code>successors(inst: JcInst): Set&lt;JcInst&gt;</code> — 获取CFG中指令的所有后继。不包括任何异常控制流。</li><li><code>predecessors(inst: JcInst): Set&lt;JcInst&gt;</code> — 获取CFG中指令的所有前驱。不包括任何异常控制流。</li><li><code>throwers(inst: JcInst): Set&lt;JcInst&gt;</code> — 获取可能抛出被<code>inst</code>捕获的异常的所有指令。表示方法的异常控制流。对所有指令返回一个空集，除了<code>JcCatchInst</code>。</li><li><code>catchers(inst: JcInst): Set&lt;JcCatchInst&gt;</code> — 获取可能捕获<code>inst</code>抛出的异常的所有指令。表示方法的异常控制流。</li><li><code>exceptionExits(inst: JcInst): Set&lt;JcClassType&gt;</code> — 获取指令可能抛出的所有异常类型，方法不会捕获。</li><li><code>blockGraph(): JcBlockGraph</code> — 创建CFG的基本块表示。</li><li><code>iterator(): Iterator&lt;JcInst&gt;</code> — 在图的指令上创建一个迭代器。</li></ul><h2 id="jcblockgraph" tabindex="-1"><a class="header-anchor" href="#jcblockgraph" aria-hidden="true">#</a> <code>JcBlockGraph</code></h2><p>JcBlockGraph是用于CFG的基本块API。它操作JcBasicBlock实例——每个基本块只表示一系列指令，具有以下属性：</p><ul><li>基本块的指令在正常执行时（即没有抛出异常时）是按顺序执行的。</li><li>基本块的所有指令具有相同的异常处理程序，即对于基本块的每个指令调用<code>jcGraph.catchers(inst)</code>将返回相同的结果。</li></ul><p>JcBlockGraph提供以下API：</p><ul><li><code>entry: JcBasicBlock</code> — 方法的入口。只能有一个入口。</li><li><code>exits: List&lt;JcBasicBlock&gt;</code> — 方法的出口。</li><li><code>instructions(block: JcBasicBlock): List&lt;JcInst&gt;</code> — 获取基本块的指令。</li><li><code>predecessors(block: JcBasicBlock): Set&lt;JcBasicBlock&gt;</code> — 获取CFG中基本块的所有前驱。不包括任何异常控制流。</li><li><code>successors(block: JcBasicBlock): Set&lt;JcBasicBlock&gt;</code> — 获取CFG中基本块的所有后继。不包括任何异常控制流。</li><li><code>throwers(block: JcBasicBlock): Set&lt;JcBasicBlock&gt;</code> — 获取可能抛出被<code>block</code>捕获的异常的所有基本块。表示方法的异常控制流。对于所有块，返回一个空集，除了以<code>JcCatchInst</code>开始的块。</li><li><code>catchers(block: JcBasicBlock): Set&lt;JcBasicBlock&gt;</code> — 获取可能捕获<code>block</code>抛出的异常的所有基本块。表示方法的异常控制流。</li></ul><p>我们还提供了用于可视化JcGraph和JcBlockGraph的API：</p><ul><li><code>JcGraph.view(dotCmd: String, viewerCmd: String, viewCatchConnections: Boolean = false)</code> — 使用DOT生成SVG文件（dotCmd需要指定DOT可执行文件的路径），并使用viewerCmd程序（指定浏览器可执行文件）查看。viewCatchConnections标志定义是否在图中显示throw...catch连接。</li><li><code>JcBlockGraph.view(dotCmd: String, viewerCmd: String)</code> — 类似，但显示JcBlockGraph。</li></ul><p>CFG API在JcInst指令上操作。JcInst与JcRawInst相似，但有一些小的差异。主要区别在于JcInst使用JcType实例来表示类型。另一个区别是JcInst不需要标签来表示指令之间的连接（因为它们存储在JcGraph中）。在所有其他情况下，JcInst层次结构（包括JcExpr和JcValue）与JcRawInst层次结构（包括JcRawExpr和JcRawValue）基本相同。</p><p>值得注意的另一件事是，JcGraph表示一个不可变结构，并且不提供修改它的API。这是有意为之的，因为修改CFG需要用户了解图中的所有连接。用户在更改CFG时应正确管理这些连接。但是，用户始终可以创建带有所有必要修改的新副本的JcGraph。</p><h2 id="例子-1" tabindex="-1"><a class="header-anchor" href="#例子-1" aria-hidden="true">#</a> 例子</h2><p>​ 在<code>StringConcatSimplifier</code>类中，您可以找到对CFG的修改示例：它创建了一个新的JcGraph，其中所有的invokedynamic字符串连接指令都被替换为简单的String.concat方法调用。</p><p>​ <code> ReachingDefinitionsAnalysis</code>类是使用基本块API的示例。它使用简单的工作列表算法执行基本块的标准到达定义分析。</p><h2 id="visitor-api-1" tabindex="-1"><a class="header-anchor" href="#visitor-api-1" aria-hidden="true">#</a> Visitor API</h2><p>​ 至于三地址指令列表，我们为遍历和修改JcGraph提供了访问者API。访问者具有标准接口 - 可以通过指令和表达式上的accept方法调用它们：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>val a = jcInst.accept(MyInstVisitor())
val b = jcExpr.accept(MyExprVisitor())
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 我们还提供了类似&quot;函数式&quot;的扩展，用于将访问者应用于JcGraph：</p><ul><li>filter(visitor: JcInstVisitor&lt;Boolean&gt;): JcGraph</li><li>filterNot(visitor: JcInstVisitor&lt;Boolean&gt;): JcGraph</li><li>map(visitor: JcInstVisitor&lt;JcInst&gt;): JcGraph</li><li>mapNotNull(visitor: JcInstVisitor&lt;JcInst?&gt;): JcGraph</li><li>flatMap(visitor: JcInstVisitor&lt;Collection&lt;JcInst&gt;&gt;): JcGraph</li><li>apply(visitor: JcInstVisitor&lt;Unit&gt;): JcGraph</li><li>applyAndGet(visitor: T, getter: (T) -&gt; R): R</li><li>collect(visitor: JcInstVisitor&lt;T&gt;): Collection&lt;T&gt;</li></ul><h1 id="七-静态数据流分析" tabindex="-1"><a class="header-anchor" href="#七-静态数据流分析" aria-hidden="true">#</a> 七 静态数据流分析</h1><h2 id="数据流分析" tabindex="-1"><a class="header-anchor" href="#数据流分析" aria-hidden="true">#</a> 数据流分析</h2><p>​ 使用 jacodb-analysis 模块，可以基于三地址码中间表示执行静态数据流分析。它实现了 Reps、Horwitz 和 Sagiv（1995）论文中描述的 IFDS 求解器。IFDS 是指类别为 interprocedural（过程间）、finite（有限）、distributive（可分配的）、subset（子集） 问题的首字母缩写。</p><p>​ jacodb-analysis 模块为您提供了多个现成的分析工具，同时还提供了 API 用于构建您自己的分析工具。</p><p>​ <strong>当前的实现将代码分割为单元，以便 IFDS 框架可以并发地分析它们。信息通过摘要在单元之间共享，但每个单元的生命周期是独立控制的。这使得实现具有高度可扩展性且仍然精确。</strong></p><h2 id="基本用法" tabindex="-1"><a class="header-anchor" href="#基本用法" aria-hidden="true">#</a> 基本用法</h2><p>​ 您可以直接从您的代码中进行分析，也可以通过命令行界面执行。</p><h3 id="代码中调用" tabindex="-1"><a class="header-anchor" href="#代码中调用" aria-hidden="true">#</a> 代码中调用</h3><p>分析的入口点是 AnalysisMain 中声明的 runAnalysis 方法。该方法接受以下参数：</p><ul><li><code>graph</code> — 用于分析的应用程序图，即原始论文中所称的超图。要获取此图，应调用 ApplicationGraphFactory 中的 newApplicationGraphForAnalysis 方法。</li><li><code>unitResolver</code> — 将方法分组到单元的对象。了解有关单元解析器的更多信息。</li><li><code>ifdsUnitRunner</code> — 用于分析每个单元的运行实例。这是定义具体分析的部分。现成的运行实例位于 RunnersLibrary 中。</li><li><code>methods</code> — 要分析的方法列表。</li><li><code>timeoutMillis</code> — 可选的超时时间（以毫秒为单位）。</li></ul><p>例如，要检测给定 <code>analyzedClass</code> 方法中未使用的变量，您可以运行以下代码（假设 <code>classpath</code> 是 <code>JcClasspath</code> 的一个实例）：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JcMethod</span><span class="token punctuation">&gt;</span></span> methodsToAnalyze <span class="token operator">=</span> analyzedClass<span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">JcApplicationGraph</span> applicationGraph <span class="token operator">=</span> <span class="token class-name">ApplicationGraphFactory</span>
        <span class="token punctuation">.</span><span class="token function">asyncNewApplicationGraphForAnalysis</span><span class="token punctuation">(</span>classpath<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">UnitResolver</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> resolver <span class="token operator">=</span> <span class="token class-name">UnitResolversLibrary</span><span class="token punctuation">.</span><span class="token function">getMethodUnitResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">IfdsUnitRunner</span> runner <span class="token operator">=</span> <span class="token class-name">RunnersLibrary</span><span class="token punctuation">.</span><span class="token function">getUnusedVariableRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token class-name">AnalysisMain</span><span class="token punctuation">.</span><span class="token function">runAnalysis</span><span class="token punctuation">(</span>
        applicationGraph<span class="token punctuation">,</span>
        resolver<span class="token punctuation">,</span>
        runner<span class="token punctuation">,</span>
        methodsToAnalyze<span class="token punctuation">,</span>
        <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,178),b=e(`<h3 id="命令行界面方式" tabindex="-1"><a class="header-anchor" href="#命令行界面方式" aria-hidden="true">#</a> 命令行界面方式</h3><p>​ 要执行分析，可以使用 jacodb-cli 模块的命令行界面（CLI）。请指定以下参数：</p><p>​ --analysisConf, -a — 包含以 JSON 格式提供的分析配置的文件路径（详细描述见下文）。</p><p>​ --start, -s — 指定分析开始的类。</p><p>​ --classpath, -cp — JacoDB 分析所需的类路径。 [可选]</p><p>​ --dbLocation, -l — 存储字节码数据的 SQLite 数据库的位置。如果未指定，将不会将数据存储在数据库中。 [可选]</p><p>​ --output, -o — 用于存储分析报告的文件。默认为 report.json。</p><p>​ 分析配置文件应声明一个 analyses 对象，其中每个键是分析的名称，每个值是一个具有自定义设置的对象。对于指定的分析，runAnalysis 会执行一次。到目前为止，在设置中，您只能指定 unit resolver，它默认为 MethodUnitResolver。</p><p>​ 一个配置文件的示例：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;analyses&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;NPE&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;Unused&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;UnitResolver&quot;</span><span class="token operator">:</span> <span class="token string">&quot;class&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;SQL&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="单元解析器" tabindex="-1"><a class="header-anchor" href="#单元解析器" aria-hidden="true">#</a> 单元解析器</h2><p>​ UnitResolver 是一个简单的接口，具有将 JcMethod 映射到自定义的 UnitType 领域的 resolve 函数。它将所有方法分为可以并发分析的组或单元。一般而言，更大的单元意味着更精确但也更耗费资源的分析，因此 UnitResolver 允许您找到平衡点。您可以创建自己的 UnitResolver，但通常可以使用 UnitResolversLibrary 类中预定义的解析器，例如 methodUnitResolver 和 singletonUnitResolver。以下是预定义解析器的列表：</p><ul><li><code>methodUnitResolver</code> — 每个单元包含确切一个方法。此解析器提供最快但也最不精确的分析。如果您要分析大量代码，如大型项目或库，请使用此解析器。</li><li><code>classUnitResolver</code> — 每个单元对应一个类：一个类中的所有方法属于一个单元。</li><li><code>packageUnitResolver</code> — 与前一个相同，但每个单元对应它所声明的包。</li><li><code>singletonUnitResolver</code> — 所有现有方法都属于同一个单元。使用此解析器提供最精确但也最耗费资源的分析。如果您要分析少量代码，如一个类或一个小项目，请使用此解析器。</li></ul><h2 id="application-graph" tabindex="-1"><a class="header-anchor" href="#application-graph" aria-hidden="true">#</a> Application graph</h2><p>​ 在分析过程中，通过 JcApplicationGraph 实例提供源代码信息。该接口将程序的<strong>控制流图（CFG）<strong>与</strong>调用图</strong>结合在一起，从而提供所谓的超图。创建该实例的最简单方式是从 ApplicationGraphFactory 中调用 newApplicationGraphForAnalysis。</p><p>​ 它有一个 <code>bannedPackagePrefixes</code> 参数，是一个字符串列表。如果某个方法声明在一个包中，其名称以这些字符串之一开头，该方法不会包含在应用程序图中，因此也不会被分析。如果传递 null，则使用默认的 <code>defaultBannedPackagePrefixes</code> 值，该值会阻止分析大多数 Java 和 Kotlin 标准库方法。以下是允许额外禁用自定义包的代码示例（假设我们已经有一个作为 JcClasspath 实例化的类路径）：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> bannedPackages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bannedPackages<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">ApplicationGraphFactory</span><span class="token punctuation">.</span><span class="token function">getDefaultBannedPackagePrefixes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bannedPackages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;my.package.that.wont.be.analyzed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">JcApplicationGraph</span> customGraph <span class="token operator">=</span> <span class="token class-name">ApplicationGraphFactory</span>
    <span class="token punctuation">.</span><span class="token function">asyncNewApplicationGraphForAnalysis</span><span class="token punctuation">(</span>classpath<span class="token punctuation">,</span> bannedPackages<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
<span class="token comment">// Launch some analysis using customGraph...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="runners-library" tabindex="-1"><a class="header-anchor" href="#runners-library" aria-hidden="true">#</a> <code>Runners</code> library</h2><p>​ 以下是位于 RunnersLibrary 中实现的运行实例的列表：</p><ol><li><strong>NpeRunner</strong> — 查找可能导致 NullPointerException 的位置。</li><li><strong>UnusedVariableRunner</strong> — 查找声明未使用变量的所有语句。</li><li><strong>TaintRunner</strong> — 提供通用的污点分析。要构建它，您需要提供 sourceMethods（产生污点的方法），sinkMethods（不应将受污染的值作为参数或接收者的方法）和 sanitizeMethods（将受污染的值转换为未受污染的方法）。如果源和汇之间存在追踪（未经过消毒方法），则报告为漏洞。</li><li><strong>SqlInjectionRunner</strong> — 执行具体的污点分析，查找可能发生 SQL 注入的位置。</li></ol><h2 id="writing-custom-runners" tabindex="-1"><a class="header-anchor" href="#writing-custom-runners" aria-hidden="true">#</a> Writing custom runners</h2><p>​ 指定自己的分析比使用预定义的分析更为复杂。为了实现这一点，您应该熟悉数据流分析、IFDS 框架和流函数。</p><h3 id="one-pass-runner" tabindex="-1"><a class="header-anchor" href="#one-pass-runner" aria-hidden="true">#</a> One-pass runner</h3><p>​ 要实现一个简单的单遍分析器，请使用 IfdsBaseUnitRunner。为了实例化它，您需要一个 AnalyzerFactory 实例，这是一个可以通过 JcApplicationGraph 创建 Analyzer 的对象。Analyzer 接口包含必须实现的以下方法（请注意，此接口是实验性的，可能会在不久的将来进行更改）：</p><ol><li><code>getFlowFunctions()</code> — 应该返回一个描述四种流函数的 FlowFunctionsSpace 对象，如原始论文中定义的那样。</li><li><code>List&lt;SummaryFact&gt; getSummaryFacts(IfdsEdge edge)</code> — 每次找到新的路径边缘时，IfdsBaseUnitRunner 将调用此方法。该方法应返回由此边缘产生的所有 SummaryFact 元素。如果检测到某些漏洞，则应将其作为 VulnerabilityLocation 返回。当分析完成时，将解析此位置的 TraceGraph，并将 VulnerabilityInstance 添加到结果中。这是返回摘要事实的首选方法。</li><li><code>List&lt;SummaryFact&gt; getSummaryFacts(IfdsResults ifdsResults)</code> — 与上述方法相同，但此方法仅由 IfdsBaseUnitRunner 在事实传播完成（正常或由于取消而完成）时调用一次。它不应返回已由前一方法返回的事实。</li><li><code>getSaveSummaryEdgesAndCrossUnitCalls()</code> — 当为 true 时，将自动将摘要边和 CrossUnitCalleeFact 元素添加到摘要中。这对于前向分析以提高精度和还原跟踪是必要的，但对于反向分析通常可以将其设置为 false。</li></ol><h3 id="composite-runners" tabindex="-1"><a class="header-anchor" href="#composite-runners" aria-hidden="true">#</a> Composite runners</h3><p>​ 为了获得更高的精度，通常执行双向分析。要实现这一点，您可以按照上述说明创建后向和前向运行器，并使用现有的复合运行器之一将它们连接起来：</p><ol><li><strong>SequentialBidiIfdsUnitRunner</strong> — 接受两个运行器，即前向和后向运行器，并按顺序运行它们：首先在反转的图上运行后向分析，然后在正常的图上运行前向分析。</li><li><strong>ParallelBidiIfdsUnitRunner</strong> — 与前一个相同，但同时启动两个运行器。</li></ol><h1 id="八-迁移" tabindex="-1"><a class="header-anchor" href="#八-迁移" aria-hidden="true">#</a> 八 迁移</h1><h2 id="如何从soot迁移过来" tabindex="-1"><a class="header-anchor" href="#如何从soot迁移过来" aria-hidden="true">#</a> 如何从soot迁移过来</h2><h3 id="术语" tabindex="-1"><a class="header-anchor" href="#术语" aria-hidden="true">#</a> 术语</h3>`,31),g=n("thead",null,[n("tr",null,[n("th",null,"Term"),n("th",null,"Soot"),n("th",null,"JacoDB")])],-1),f={href:"https://jacodb.org/documentation/migration/#create-storage",target:"_blank",rel:"noopener noreferrer"},y=n("td",null,"-",-1),x=n("td",null,"JacoDB",-1),J={href:"https://jacodb.org/documentation/migration/#create-storage",target:"_blank",rel:"noopener noreferrer"},w=n("td",null,"Scene",-1),_=n("td",null,"JcClasspath",-1),j={href:"https://jacodb.org/documentation/migration/#find-class",target:"_blank",rel:"noopener noreferrer"},I=n("td",null,"SootClass",-1),S=n("td",null,"JcClassOrInterface",-1),B=n("tr",null,[n("td",null,"class method"),n("td",null,"SootMethod"),n("td",null,"JcMethod")],-1),C=n("tr",null,[n("td",null,"class field"),n("td",null,"SootField"),n("td",null,"JcField")],-1),R=n("tr",null,[n("td",null,"type (with generic substitution)"),n("td",null,"-"),n("td",null,"JcJvmType")],-1),A={href:"https://jacodb.org/documentation/migration/#get-3-address-bytecode-representation",target:"_blank",rel:"noopener noreferrer"},E=n("td",null,"JimpleBody",-1),L=n("td",null,"JcRawInstList",-1),q={href:"https://jacodb.org/documentation/migration/#get-control-flow-graph",target:"_blank",rel:"noopener noreferrer"},T=n("td",null,"ClassicCompleteUnitGraph",-1),O=n("td",null,"JcGraph",-1),M={href:"https://jacodb.org/documentation/migration/#get-hierarchy",target:"_blank",rel:"noopener noreferrer"},D=n("td",null,"Hierarchy",-1),U=n("td",null,"HierarchyExt",-1),G={href:"https://jacodb.org/documentation/migration/#get-call-graphusages",target:"_blank",rel:"noopener noreferrer"},F=n("td",null,"CallGraph",-1),P=n("td",null,"UsagesExt",-1),N=e(`<p>Inst = Instruction = 指令</p><h3 id="建议" tabindex="-1"><a class="header-anchor" href="#建议" aria-hidden="true">#</a> 建议</h3><ul><li>记得关闭资源：JcClasspath、JacoDB。创建类路径是一个涉及 I/O 操作的繁重过程。所有传递给类路径的 JAR 文件或文件夹都会被检查，我们会检查： <ul><li>它们是否已经被处理过，</li><li>它们是否自上次处理以来发生了变化，</li><li>它们是否正在被处理，因为它们之前尚未被处理。因此，代码应该尽量重复使用类路径实例。之后，我们建议调用 close 方法，因为 JacoDB 能够删除已处理的资源，这些资源在文件系统中似乎已经过时。</li></ul></li><li>如果代码可能调用类层次结构，请最好设置 InMemoryHierarchy 功能。</li><li>如果代码库足够庞大或者在进程重新启动时存活是可能的话，可以在文件系统中使用持久化数据。</li><li>仅安装对于此数据库而言是必需的那些功能。</li></ul><h3 id="operations" tabindex="-1"><a class="header-anchor" href="#operations" aria-hidden="true">#</a> Operations</h3><h4 id="create-storage" tabindex="-1"><a class="header-anchor" href="#create-storage" aria-hidden="true">#</a> Create storage</h4><p>SOOT</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// points to specific runtime version</span>
<span class="token class-name">G</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">initJdk</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">G<span class="token punctuation">.</span>JreInfo</span><span class="token punctuation">(</span>location<span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Options</span> options <span class="token operator">=</span> <span class="token class-name">Options</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
options<span class="token punctuation">.</span><span class="token function">set_soot_classpath</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Scene</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loadNecessaryClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">PackManager</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">runPacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>jacodb(java)</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token class-name">JacoDB</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JcSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// points to specific runtime version</span>
    <span class="token punctuation">.</span><span class="token function">useJavaRuntime</span><span class="token punctuation">(</span>runtimeFolder<span class="token punctuation">)</span>
    <span class="token comment">// jars to process</span>
    <span class="token punctuation">.</span><span class="token function">loadByteCode</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>jar1<span class="token punctuation">,</span> jar2<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// persist all information to improve performance between restarts</span>
    <span class="token punctuation">.</span><span class="token function">persistent</span><span class="token punctuation">(</span><span class="token string">&quot;/home/user/jcdb.db&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> classpath <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">asyncClasspath</span><span class="token punctuation">(</span><span class="token function">listOf</span><span class="token punctuation">(</span>jar1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>jacodb(kotlin)</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">val</span> db <span class="token operator">=</span> jacodb <span class="token punctuation">{</span>
    <span class="token comment">// points to specific runtime version</span>
    <span class="token function">useJavaRuntime</span><span class="token punctuation">(</span>runtimeFolder<span class="token punctuation">)</span>
    <span class="token comment">// jars to process</span>
    <span class="token function">loadByteCode</span><span class="token punctuation">(</span><span class="token function">listOf</span><span class="token punctuation">(</span>jar1<span class="token punctuation">,</span> jar2<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// persist all information to improve performance between restarts</span>
    <span class="token function">persistent</span><span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;/home/user/jcdb.db&quot;</span></span><span class="token punctuation">,</span> clearOnStart <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">val</span> classpath <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">classpath</span><span class="token punctuation">(</span><span class="token function">listOf</span><span class="token punctuation">(</span>jar1<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="find-class" tabindex="-1"><a class="header-anchor" href="#find-class" aria-hidden="true">#</a> Find class</h4><p>Soot</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">SootClass</span> clazz <span class="token operator">=</span> <span class="token class-name">Scene</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSootClass</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>JacoDB(Java)</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">var</span> clazz <span class="token operator">=</span> classpath<span class="token punctuation">.</span><span class="token function">findClassOrNull</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.String&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>JacoDB(Kotlin)</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">val</span> clazz <span class="token operator">=</span> classpath<span class="token punctuation">.</span><span class="token function">findClassOrNull</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;java.lang.String&quot;</span></span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="get-3-address-bytecode-representation" tabindex="-1"><a class="header-anchor" href="#get-3-address-bytecode-representation" aria-hidden="true">#</a> Get 3-address bytecode representation</h4><p>Soot</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">SootClass</span> clazz <span class="token operator">=</span> <span class="token class-name">Scene</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSootClass</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
clazz<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">&quot;length&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Lists</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">retrieveActiveBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>JacoDB(java)</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">var</span> clazz <span class="token operator">=</span> classpath<span class="token punctuation">.</span><span class="token function">findClassOrNull</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">JcClasses</span><span class="token punctuation">.</span><span class="token function">findDeclaredMethodOrNull</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span> <span class="token string">&quot;length&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInstructionList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>​ <span style="color:red;">实际使用没有“getInstructionList”这个方法，有函数“getInstList”方法。</span></p><p>JacoDB(Kotlin)</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">val</span> clazz <span class="token operator">=</span> classpath<span class="token punctuation">.</span><span class="token function">findClass</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;java.lang.String&quot;</span></span><span class="token punctuation">)</span>
classpath<span class="token punctuation">.</span><span class="token function">findMethodOrNull</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;length&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>instructionList
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="get-control-flow-graph" tabindex="-1"><a class="header-anchor" href="#get-control-flow-graph" aria-hidden="true">#</a> Get control flow graph</h4><p>Soot</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">ClassicCompleteUnitGraph</span><span class="token punctuation">(</span>sootMethod<span class="token punctuation">.</span><span class="token function">getActiveBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>JacoDB(Java)</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">var</span> cfg <span class="token operator">=</span> jcMethod<span class="token punctuation">.</span><span class="token function">flowGraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>JacoDB(Kotlin)</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">val</span> cfg <span class="token operator">=</span> jcMethod<span class="token punctuation">.</span><span class="token function">flowGraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="get-hierarchy" tabindex="-1"><a class="header-anchor" href="#get-hierarchy" aria-hidden="true">#</a> Get hierarchy</h4><p>Soot</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Hierarchy</span> h <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hierarchy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
h<span class="token punctuation">.</span><span class="token function">getDirectSubclassesOf</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
h<span class="token punctuation">.</span><span class="token function">getDirectSubinterfacesOf</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>JacoDB(Java)</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token class-name">JacoDB</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JcSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">(</span><span class="token class-name">InMemoryHierarchy</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
val ext <span class="token operator">=</span> classpath<span class="token punctuation">.</span><span class="token function">asyncHierarchy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ext<span class="token punctuation">.</span><span class="token function">findSubClasses</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span> allHierarchy <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
ext<span class="token punctuation">.</span><span class="token function">findOverrides</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>JacoDB(Kotlin)</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">val</span> db <span class="token operator">=</span> jacodb <span class="token punctuation">{</span>
    <span class="token comment">// highly recommend to install this extension</span>
    <span class="token function">install</span><span class="token punctuation">(</span>InMemoryHierarchy<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">val</span> ext <span class="token operator">=</span> classpath<span class="token punctuation">.</span><span class="token function">hierarchyExt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
ext<span class="token punctuation">.</span><span class="token function">findSubClasses</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span> allHierarchy <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
ext<span class="token punctuation">.</span><span class="token function">findOverrides</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="get-callgraph-usages" tabindex="-1"><a class="header-anchor" href="#get-callgraph-usages" aria-hidden="true">#</a> Get <code>CallGraph</code>/<code>Usages</code></h4><p>Soot</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">CallGraph</span> cg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CallGraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cg<span class="token punctuation">.</span><span class="token function">edgesInto</span><span class="token punctuation">(</span>edge<span class="token punctuation">)</span><span class="token punctuation">;</span>
cg<span class="token punctuation">.</span><span class="token function">edgesOutOf</span><span class="token punctuation">(</span>edge<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>JacoDB(Java)</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token class-name">JacoDB</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">JcSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// highly recommend to install InMemoryHierarchy extension</span>
    <span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">(</span><span class="token class-name">InMemoryHierarchy</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">,</span> <span class="token class-name">Usages</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> ext <span class="token operator">=</span> classpath<span class="token punctuation">.</span><span class="token function">asyncUsages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ext<span class="token punctuation">.</span><span class="token function">findUsages</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> <span class="token class-name">FieldUsageMode</span><span class="token punctuation">.</span><span class="token constant">READ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ext<span class="token punctuation">.</span><span class="token function">findUsages</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> <span class="token class-name">FieldUsageMode</span><span class="token punctuation">.</span><span class="token constant">WRITE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ext<span class="token punctuation">.</span><span class="token function">findUsages</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>JacoDB(Kotlin)</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">val</span> db <span class="token operator">=</span> jacodb <span class="token punctuation">{</span>
    <span class="token comment">// highly recommend to install InMemoryHierarchy extension</span>
    <span class="token function">install</span><span class="token punctuation">(</span>Usages<span class="token punctuation">,</span> InMemoryHierarchy<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">val</span> ext <span class="token operator">=</span> classpath<span class="token punctuation">.</span><span class="token function">usagesExt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
ext<span class="token punctuation">.</span><span class="token function">findUsages</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> FieldUsageMode<span class="token punctuation">.</span>READ<span class="token punctuation">)</span>
ext<span class="token punctuation">.</span><span class="token function">findUsages</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> FieldUsageMode<span class="token punctuation">.</span>WRITE<span class="token punctuation">)</span>
ext<span class="token punctuation">.</span><span class="token function">findUsages</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="九-api" tabindex="-1"><a class="header-anchor" href="#九-api" aria-hidden="true">#</a> 九 API</h1><p>https://jacodb.org/docs/index.html</p><h1 id="十-用法示例" tabindex="-1"><a class="header-anchor" href="#十-用法示例" aria-hidden="true">#</a> 十 用法示例</h1><h2 id="类型求解" tabindex="-1"><a class="header-anchor" href="#类型求解" aria-hidden="true">#</a> 类型求解</h2><h3 id="测试类型求解器" tabindex="-1"><a class="header-anchor" href="#测试类型求解器" aria-hidden="true">#</a> 测试类型求解器</h3><p>项目仓库的链接将稍后添加，因为项目本身尚未宣布。</p><h3 id="用例" tabindex="-1"><a class="header-anchor" href="#用例" aria-hidden="true">#</a> 用例</h3><p>​ 一种基于符号执行的多用途工具将解决类型约束作为其核心算法的一部分。通常，这个任务需要SMT求解，而这是相当耗时的。为了使工具更快运行，应该实现一个独立的TypeSolver，对于这个任务不涉及SMT求解。</p><p>​ 为了测试TypeSolver，应该提供关于类、它们的父类、实现的接口、类型参数和方法的信息，以便TypeSolver能够找到适当的类型。</p><p>​ 使用 JacoDB，您可以轻松获取这些信息。</p><h3 id="实现" tabindex="-1"><a class="header-anchor" href="#实现" aria-hidden="true">#</a> 实现</h3><p>TODO</p><h2 id="近似" tabindex="-1"><a class="header-anchor" href="#近似" aria-hidden="true">#</a> 近似</h2><h3 id="实现近似" tabindex="-1"><a class="header-anchor" href="#实现近似" aria-hidden="true">#</a> 实现近似</h3><p>​ 项目仓库的链接将稍后添加，因为该项目尚未宣布。</p><h3 id="用例-1" tabindex="-1"><a class="header-anchor" href="#用例-1" aria-hidden="true">#</a> 用例</h3><p>​ 实际代码中的许多过程都经过了优化：这些优化在实际执行时有助于性能，但会妨碍程序分析。近似方法用“模拟”替代实际的方法实现，这些模拟返回所需的值同时为我们提供所需类型的实现。</p><p>​ 例如，对于基于符号执行的多用途工具，重要的是近似某些方法：</p><ul><li>近似有助于简化方法实现，这些实现对于基于符号执行的分析来说过于复杂。</li><li>标准库中的本地方法有时可能根本没有实现。近似方法允许我们为这类方法“编写源代码”。</li></ul><h3 id="实现-1" tabindex="-1"><a class="header-anchor" href="#实现-1" aria-hidden="true">#</a> 实现</h3><p>TODO</p><h2 id="符号执行" tabindex="-1"><a class="header-anchor" href="#符号执行" aria-hidden="true">#</a> 符号执行</h2><h3 id="创建一个用于-jvm-字节码的符号分析器" tabindex="-1"><a class="header-anchor" href="#创建一个用于-jvm-字节码的符号分析器" aria-hidden="true">#</a> 创建一个用于 JVM 字节码的符号分析器</h3><p>项目仓库的链接将稍后添加，因为该项目尚未宣布。</p><h3 id="用例-2" tabindex="-1"><a class="header-anchor" href="#用例-2" aria-hidden="true">#</a> 用例</h3><p>​ 要开发一个用于 JVM 字节码的符号分析器，需要获取程序中每个方法的三地址码中间表示（3-address code IR）。以下是使用 JacoDB 和 KSMT 库实现的方法：</p><h3 id="实现-2" tabindex="-1"><a class="header-anchor" href="#实现-2" aria-hidden="true">#</a> 实现</h3><p>​ 首先，我们需要获取方法的三地址码中间表示（3-address code IR）。JacoDB具有类似于 Jimple 的自己的三地址码中间表示。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>val jcClass = TODO(&quot;obtain target class somehow&quot;)
val method = jcClass.declaredMethods.first { it.name == TODO(&quot;Target method name&quot;) }
val instList = method.instList // 3-address IR
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 其次，我们需要一个符号状态：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>data class State(
    val path: List&lt;JcInst&gt;, // Execution path
    val memory: Map&lt;String, KExpr&lt;out KSort&gt;&gt;, // Symbolic memory
    val pathCondition: List&lt;KExpr&lt;KBoolSort&gt;&gt;, // Path condition
)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 要解释符号状态，我们需要获取路径中的最后一条指令，并根据其类型进行相应的处理：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>fun interpret(state: State): Collection&lt;State&gt; {
    // 0. Get the last instruction in the path
    val inst = state.path.last()
    // 1. Process the last instruction symbolically
    return when (inst) {
        is JcAssignInst -&gt; interpretAssignInst(state, inst) // Assign instruction, i.e. n = i + 42;
        is JcIfInst -&gt; interpretIfStmt(state, inst) // Branching instruction, i.e. if (n == 101)
        else -&gt; TODO(&quot;Process other instructions as well&quot;)
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 例如，要处理赋值语句，我们需要解析赋值指令的右操作数（符号表达式）和赋值操作的左操作数（内存位置）：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>private fun interpretAssignInst(state: State, inst: JcAssignInst): Collection&lt;State&gt; {
    // 0. We need to resolve symbolic expression from [inst.rhv]
    val expr = resolveExpr(state, inst.rhv)

    // 1. We need to write the [expr] to the symbolic memory
    val nextState = when (val lhv = inst.lhv) {
        is JcLocalVar -&gt; {
            // find the next instruction
            val nextInst = inst.location.method.instList[inst.location.lineNumber + 1]
            state.copy(
                // update the symbolic memory with the new write
                memory = state.memory + (lhv.name to expr),
                // update the execution path
                path = state.path + nextInst
            )
        }

        else -&gt; TODO(&quot;Process other JcValues as well&quot;)
    }
    return listOf(nextState)
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 解析 JcExpr 是直截了当的。我们根据表达式类型匹配，并使用 KSMT 构建函数。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>private fun resolveExpr(state: State, expr: JcExpr): KExpr&lt;out KSort&gt; =
    when (expr) {
        is JcAddExpr -&gt; {
            // resolve the left operand recursively
            val leftOperand = resolveExpr(state, expr.lhv) as KExpr&lt;KBvSort&gt;
            // resolve the right operand recursively
            val rightOperand = resolveExpr(state, expr.rhv) as KExpr&lt;KBvSort&gt;
            // make a symbolic add expression with KSMT builder functions
            leftOperand.ctx.mkBvAddExpr(leftOperand, rightOperand)
        }

        // resolve an int constant
        is JcInt -&gt; ctx.mkBv(expr.value, 32U)

        is JcEqExpr -&gt; {
            // resolve the left operand recursively
            val leftOperand = resolveExpr(state, expr.lhv)
            // resolve the right operand recursively
            val rightOperand = resolveExpr(state, expr.rhv)
            // make a symbolic eq expression with KSMT builder functions
            when (leftOperand.sort) {
                // both operands of the boolean sort
                is KBoolSort -&gt; leftOperand.ctx.mkEq(
                    leftOperand as KExpr&lt;KBoolSort&gt;,
                    rightOperand as KExpr&lt;KBoolSort&gt;
                )
                // both operands of the bv sort
                is KBoolSort -&gt; leftOperand.ctx.mkEq(
                    leftOperand as KExpr&lt;KBvSort&gt;,
                    rightOperand as KExpr&lt;KBvSort&gt;
                )

                else -&gt; TODO(&quot;Process other sorts as well&quot;)
            }
        }

        is JcLocalVar -&gt; state.memory.getValue(expr.name) // get the variable from the current symbolic memory
        else -&gt; TODO(&quot;Process other JcExprs as well&quot;)
    }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 要处理分支指令，我们需要解析一个符号条件并使用求解器检查条件和!条件。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>private fun interpretIfStmt(state: State, inst: JcIfInst): Collection&lt;State&gt; {
    val nextStates = mutableListOf&lt;State&gt;()

    // 0. We need to resolve symbolic condition, which should be of the boolean sort
    val expr = resolveExpr(state, inst.condition) as KExpr&lt;KBoolSort&gt;

    // 1. Resolve the positive branch
    val positivePathCondition = state.pathCondition + expr
    // 1.0. Check for satisfiability
    if (solver.check(positivePathCondition)) {
        // 1.1. Find the positive instruction
        val positiveInst = inst.location.method.instList[inst.trueBranch.index]
        // 1.2. Add the instruction to the path
        val positivePath = state.path + positiveInst
        // 1.3. Add the positive state to the result list
        val positiveState = state.copy(path = positivePath, pathCondition = positivePathCondition)
        nextStates += positiveState
    }

    // 2. Resolve the negative branch
    val negativePathCondition = state.pathCondition + expr.run { ctx.mkNot(this) }
    // 1.0. Check for satisfiability
    if (solver.check(negativePathCondition)) {
        // 2.1. Find the negative instruction
        val negativeInst = inst.location.method.instList[inst.falseBranch.index]
        // 2.2. Add the instruction to the path
        val negativePath = state.path + negativeInst
        // 2.3. Add the negative state to the result list
        val negativeState = state.copy(path = negativePath, pathCondition = negativePathCondition)
        nextStates += negativeState
    }

    // 3. Return the result states
    return nextStates
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>完整代码</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>example</span>

<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>ksmt<span class="token punctuation">.</span></span><span class="token class-name">KContext</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>ksmt<span class="token punctuation">.</span>expr<span class="token punctuation">.</span></span><span class="token class-name">KExpr</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>ksmt<span class="token punctuation">.</span>sort<span class="token punctuation">.</span></span><span class="token class-name">KBoolSort</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>ksmt<span class="token punctuation">.</span>sort<span class="token punctuation">.</span></span><span class="token class-name">KBvSort</span>
<span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>ksmt<span class="token punctuation">.</span>sort<span class="token punctuation">.</span></span><span class="token class-name">KSort</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">JcMethod</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span>cfg<span class="token punctuation">.</span></span><span class="token class-name">JcAddExpr</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span>cfg<span class="token punctuation">.</span></span><span class="token class-name">JcAssignInst</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span>cfg<span class="token punctuation">.</span></span><span class="token class-name">JcEqExpr</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span>cfg<span class="token punctuation">.</span></span><span class="token class-name">JcExpr</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span>cfg<span class="token punctuation">.</span></span><span class="token class-name">JcIfInst</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span>cfg<span class="token punctuation">.</span></span><span class="token class-name">JcInst</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span>cfg<span class="token punctuation">.</span></span><span class="token class-name">JcInt</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span>cfg<span class="token punctuation">.</span></span><span class="token class-name">JcLocalVar</span>

<span class="token doc-comment comment">/**
 * A data class, representing symbolic state.
 *
 * Let&#39;s assume we use KSMT for storing symbolic expressions.
 */</span>
data <span class="token keyword">class</span> <span class="token class-name">State</span><span class="token punctuation">(</span>
    val path<span class="token operator">:</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JcInst</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token comment">// Execution path</span>
    val memory<span class="token operator">:</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">KExpr</span><span class="token punctuation">&lt;</span>out <span class="token class-name">KSort</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token comment">// Symbolic memory</span>
    val pathCondition<span class="token operator">:</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">KExpr</span><span class="token punctuation">&lt;</span><span class="token class-name">KBoolSort</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token comment">// Path condition</span>
<span class="token punctuation">)</span>

<span class="token doc-comment comment">/**
 * A solver interface
 */</span>
<span class="token keyword">interface</span> <span class="token class-name">Solver</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * <span class="token keyword">@return</span> true, if [pathCondition] is satisfiable, and false otherwise.
     */</span>
    fun <span class="token function">check</span><span class="token punctuation">(</span>pathCondition<span class="token operator">:</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">KExpr</span><span class="token punctuation">&lt;</span><span class="token class-name">KBoolSort</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token class-name">Boolean</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Analyzer</span><span class="token punctuation">(</span>
    ctx<span class="token operator">:</span> <span class="token class-name">KContext</span><span class="token punctuation">,</span>
    solver<span class="token operator">:</span> <span class="token class-name">Solver</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 0.1. Initialize an interpreter</span>
    <span class="token keyword">private</span> val interpreter <span class="token operator">=</span> <span class="token class-name">Interpreter</span><span class="token punctuation">(</span>solver<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span>

    fun <span class="token function">analyze</span><span class="token punctuation">(</span>method<span class="token operator">:</span> <span class="token class-name">JcMethod</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1.0. Find the first instruction</span>
        val inst <span class="token operator">=</span> method<span class="token punctuation">.</span>instList<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 1.1. Initialize an initial symbolic state</span>
        val initialState <span class="token operator">=</span> <span class="token class-name">State</span><span class="token punctuation">(</span><span class="token function">listOf</span><span class="token punctuation">(</span>inst<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">emptyMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">// 1.2. Add the initial state to the BFS-order queue</span>
        val queue <span class="token operator">=</span> <span class="token class-name">ArrayDeque</span><span class="token punctuation">(</span><span class="token function">listOf</span><span class="token punctuation">(</span>initialState<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 2.0. Pop the next state from the queue</span>
            val state <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">removeFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">// 2.1 Interpret the state symbolically and obtain next states</span>
            val nextStates <span class="token operator">=</span> interpreter<span class="token punctuation">.</span><span class="token function">interpret</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
            queue<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>nextStates<span class="token punctuation">)</span>
            <span class="token comment">// 2.2. here you can check **interesting** states and do something with them</span>
            <span class="token comment">// your own code</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * An example interpreter.
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Interpreter</span><span class="token punctuation">(</span>
    val solver<span class="token operator">:</span> <span class="token class-name">Solver</span><span class="token punctuation">,</span>
    val ctx<span class="token operator">:</span> <span class="token class-name">KContext</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * Takes a [state] and returns the next states.
     */</span>
    fun <span class="token function">interpret</span><span class="token punctuation">(</span>state<span class="token operator">:</span> <span class="token class-name">State</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">State</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token comment">// 0. Get the last instruction in the path</span>
        val inst <span class="token operator">=</span> state<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// 1. Process the last instruction symbolically</span>
        <span class="token keyword">return</span> when <span class="token punctuation">(</span>inst<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            is <span class="token class-name">JcAssignInst</span> <span class="token operator">-&gt;</span> <span class="token function">interpretAssignInst</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> inst<span class="token punctuation">)</span> <span class="token comment">// Assign instruction, i.e. n = i + 42;</span>
            is <span class="token class-name">JcIfInst</span> <span class="token operator">-&gt;</span> <span class="token function">interpretIfStmt</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> inst<span class="token punctuation">)</span> <span class="token comment">// Branching instruction, i.e. if (n == 101)</span>
            <span class="token keyword">else</span> <span class="token operator">-&gt;</span> <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token string">&quot;Process other instructions as well&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> fun <span class="token function">interpretAssignInst</span><span class="token punctuation">(</span>state<span class="token operator">:</span> <span class="token class-name">State</span><span class="token punctuation">,</span> inst<span class="token operator">:</span> <span class="token class-name">JcAssignInst</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">State</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token comment">// 0. We need to resolve symbolic expression from [inst.rhv]</span>
        val expr <span class="token operator">=</span> <span class="token function">resolveExpr</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> inst<span class="token punctuation">.</span>rhv<span class="token punctuation">)</span>

        <span class="token comment">// 1. We need to write the [expr] to the symbolic memory</span>
        val nextState <span class="token operator">=</span> when <span class="token punctuation">(</span>val lhv <span class="token operator">=</span> inst<span class="token punctuation">.</span>lhv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            is <span class="token class-name">JcLocalVar</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// find the next instruction</span>
                val nextInst <span class="token operator">=</span> inst<span class="token punctuation">.</span>location<span class="token punctuation">.</span>method<span class="token punctuation">.</span>instList<span class="token punctuation">[</span>inst<span class="token punctuation">.</span>location<span class="token punctuation">.</span>lineNumber <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>
                state<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>
                    <span class="token comment">// update the symbolic memory with the new write</span>
                    memory <span class="token operator">=</span> state<span class="token punctuation">.</span>memory <span class="token operator">+</span> <span class="token punctuation">(</span>lhv<span class="token punctuation">.</span>name <span class="token keyword">to</span> <span class="token namespace">expr</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token comment">// update the execution path</span>
                    path <span class="token operator">=</span> state<span class="token punctuation">.</span>path <span class="token operator">+</span> nextInst
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">else</span> <span class="token operator">-&gt;</span> <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token string">&quot;Process other JcValues as well&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token function">listOf</span><span class="token punctuation">(</span>nextState<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> fun <span class="token function">interpretIfStmt</span><span class="token punctuation">(</span>state<span class="token operator">:</span> <span class="token class-name">State</span><span class="token punctuation">,</span> inst<span class="token operator">:</span> <span class="token class-name">JcIfInst</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">State</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        val nextStates <span class="token operator">=</span> mutableListOf<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">State</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment">// 0. We need to resolve symbolic condition, which should be of the boolean sort</span>
        val expr <span class="token operator">=</span> <span class="token function">resolveExpr</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> inst<span class="token punctuation">.</span>condition<span class="token punctuation">)</span> as <span class="token class-name">KExpr</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">KBoolSort</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">// 1. Resolve the positive branch</span>
        val positivePathCondition <span class="token operator">=</span> state<span class="token punctuation">.</span>pathCondition <span class="token operator">+</span> expr
        <span class="token comment">// 1.0. Check for satisfiability</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>solver<span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span>positivePathCondition<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 1.1. Find the positive instruction</span>
            val positiveInst <span class="token operator">=</span> inst<span class="token punctuation">.</span>location<span class="token punctuation">.</span>method<span class="token punctuation">.</span>instList<span class="token punctuation">[</span>inst<span class="token punctuation">.</span>trueBranch<span class="token punctuation">.</span>index<span class="token punctuation">]</span>
            <span class="token comment">// 1.2. Add the instruction to the path</span>
            val positivePath <span class="token operator">=</span> state<span class="token punctuation">.</span>path <span class="token operator">+</span> positiveInst
            <span class="token comment">// 1.3. Add the positive state to the result list</span>
            val positiveState <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>path <span class="token operator">=</span> positivePath<span class="token punctuation">,</span> pathCondition <span class="token operator">=</span> positivePathCondition<span class="token punctuation">)</span>
            nextStates <span class="token operator">+=</span> positiveState
        <span class="token punctuation">}</span>

        <span class="token comment">// 2. Resolve the negative branch</span>
        val negativePathCondition <span class="token operator">=</span> state<span class="token punctuation">.</span>pathCondition <span class="token operator">+</span> expr<span class="token punctuation">.</span>run <span class="token punctuation">{</span> ctx<span class="token punctuation">.</span><span class="token function">mkNot</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token comment">// 1.0. Check for satisfiability</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>solver<span class="token punctuation">.</span><span class="token function">check</span><span class="token punctuation">(</span>negativePathCondition<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 2.1. Find the negative instruction</span>
            val negativeInst <span class="token operator">=</span> inst<span class="token punctuation">.</span>location<span class="token punctuation">.</span>method<span class="token punctuation">.</span>instList<span class="token punctuation">[</span>inst<span class="token punctuation">.</span>falseBranch<span class="token punctuation">.</span>index<span class="token punctuation">]</span>
            <span class="token comment">// 2.2. Add the instruction to the path</span>
            val negativePath <span class="token operator">=</span> state<span class="token punctuation">.</span>path <span class="token operator">+</span> negativeInst
            <span class="token comment">// 2.3. Add the negative state to the result list</span>
            val negativeState <span class="token operator">=</span> state<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>path <span class="token operator">=</span> negativePath<span class="token punctuation">,</span> pathCondition <span class="token operator">=</span> negativePathCondition<span class="token punctuation">)</span>
            nextStates <span class="token operator">+=</span> negativeState
        <span class="token punctuation">}</span>

        <span class="token comment">// 3. Return the result states</span>
        <span class="token keyword">return</span> nextStates
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Resolves an [expr] inside of a [state] into symbolic representation [KExpr] of some sort.
     */</span>
    <span class="token keyword">private</span> fun <span class="token function">resolveExpr</span><span class="token punctuation">(</span>state<span class="token operator">:</span> <span class="token class-name">State</span><span class="token punctuation">,</span> expr<span class="token operator">:</span> <span class="token class-name">JcExpr</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token class-name">KExpr</span><span class="token generics"><span class="token punctuation">&lt;</span>out <span class="token class-name">KSort</span><span class="token punctuation">&gt;</span></span> <span class="token operator">=</span>
        when <span class="token punctuation">(</span>expr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            is <span class="token class-name">JcAddExpr</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// resolve the left operand recursively</span>
                val leftOperand <span class="token operator">=</span> <span class="token function">resolveExpr</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> expr<span class="token punctuation">.</span>lhv<span class="token punctuation">)</span> as <span class="token class-name">KExpr</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">KBvSort</span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">// resolve the right operand recursively</span>
                val rightOperand <span class="token operator">=</span> <span class="token function">resolveExpr</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> expr<span class="token punctuation">.</span>rhv<span class="token punctuation">)</span> as <span class="token class-name">KExpr</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">KBvSort</span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">// make a symbolic add expression with KSMT builder functions</span>
                leftOperand<span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">mkBvAddExpr</span><span class="token punctuation">(</span>leftOperand<span class="token punctuation">,</span> rightOperand<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// resolve int constant</span>
            is <span class="token class-name">JcInt</span> <span class="token operator">-&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">mkBv</span><span class="token punctuation">(</span>expr<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token number">32</span>U<span class="token punctuation">)</span>

            is <span class="token class-name">JcEqExpr</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">// resolve the left operand recursively</span>
                val leftOperand <span class="token operator">=</span> <span class="token function">resolveExpr</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> expr<span class="token punctuation">.</span>lhv<span class="token punctuation">)</span>
                <span class="token comment">// resolve the right operand recursively</span>
                val rightOperand <span class="token operator">=</span> <span class="token function">resolveExpr</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> expr<span class="token punctuation">.</span>rhv<span class="token punctuation">)</span>
                <span class="token comment">// make a symbolic eq expression with KSMT builder functions</span>
                when <span class="token punctuation">(</span>leftOperand<span class="token punctuation">.</span>sort<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// both operands of the boolean sort</span>
                    is <span class="token class-name">KBoolSort</span> <span class="token operator">-&gt;</span> leftOperand<span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">mkEq</span><span class="token punctuation">(</span>
                        leftOperand as <span class="token class-name">KExpr</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">KBoolSort</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>
                        rightOperand as <span class="token class-name">KExpr</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">KBoolSort</span><span class="token punctuation">&gt;</span></span>
                    <span class="token punctuation">)</span>
                    <span class="token comment">// both operands of the bv sort</span>
                    is <span class="token class-name">KBoolSort</span> <span class="token operator">-&gt;</span> leftOperand<span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">mkEq</span><span class="token punctuation">(</span>
                        leftOperand as <span class="token class-name">KExpr</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">KBvSort</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span>
                        rightOperand as <span class="token class-name">KExpr</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">KBvSort</span><span class="token punctuation">&gt;</span></span>
                    <span class="token punctuation">)</span>

                    <span class="token keyword">else</span> <span class="token operator">-&gt;</span> <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token string">&quot;Process other sorts as well&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            is <span class="token class-name">JcLocalVar</span> <span class="token operator">-&gt;</span> state<span class="token punctuation">.</span>memory<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>expr<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// get the variable from the current symbolic memory</span>
            <span class="token keyword">else</span> <span class="token operator">-&gt;</span> <span class="token function">TODO</span><span class="token punctuation">(</span><span class="token string">&quot;Process other JcExprs as well&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="十二-关于" tabindex="-1"><a class="header-anchor" href="#十二-关于" aria-hidden="true">#</a> 十二 关于</h1><h2 id="关于项目" tabindex="-1"><a class="header-anchor" href="#关于项目" aria-hidden="true">#</a> 关于项目</h2><h3 id="维护" tabindex="-1"><a class="header-anchor" href="#维护" aria-hidden="true">#</a> 维护</h3><p>​ 该库由 UnitTestBot 社区维护。</p><h3 id="贡献指引" tabindex="-1"><a class="header-anchor" href="#贡献指引" aria-hidden="true">#</a> 贡献指引</h3>`,93),V={href:"https://github.com/UnitTestBot/UTBotJava/blob/main/CONTRIBUTING.md",target:"_blank",rel:"noopener noreferrer"},K=e(`<p>贡献代码的一般流程：</p><ol><li>创建你自己的代码分支（fork）。</li><li>将分支库克隆到本地机器。</li><li>实现变更。</li><li>测试你的代码： <ul><li>在创建拉取请求之前，执行对你的代码变更认为必要的测试。</li><li>当实现新功能时，最好找到真实的用户并请他们尝试你的功能，以证明你建议的功能的必要性和质量。</li></ul></li><li>创建拉取请求，你将在 GitHub 上看到自动化测试是否通过。你的审查者可能会建议你进行更多测试。</li><li>请选择 @lehvolk 作为审阅者。如果有必要，他会将你的拉取请求重新分配给核心团队的其他成员。我们会尽力进行审查，但我们很难指定确切的审查时间。请放心，我们一定会回复你的拉取请求！</li></ol><h2 id="基准测试" tabindex="-1"><a class="header-anchor" href="#基准测试" aria-hidden="true">#</a> 基准测试</h2><p>​ 基准测试在不同范围的 Java 字节码上运行：</p><ul><li><p><code>runtime</code> — 仅使用 Java 运行时，没有额外的依赖关系</p></li><li><p><code>runtime + guava</code> — 使用一个 guava 的 JAR 文件的 Java 运行时</p></li><li><p><code>runtime + project classpath</code> — 使用 JacoDB 项目的所有可见依赖关系的 Java 运行时</p></li><li><p><code>runtime + Idea community</code> — 使用 IntelliJ IDEA Community 项目的所有可见依赖关系的 Java 运行时</p><p>JacoDB 的基准测试还包括已安装 Usages 功能的方案。</p></li></ul><h3 id="环境" tabindex="-1"><a class="header-anchor" href="#环境" aria-hidden="true">#</a> 环境</h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>OS</td><td>Windows 10 Pro</td></tr><tr><td>Processor</td><td>11th Gen Intel(R) Core(TM) i7-1165G7 @ 2.80 GHz</td></tr><tr><td>RAM</td><td>16 GB</td></tr><tr><td>Storage</td><td>SSD</td></tr></tbody></table><h3 id="jacodb-基准测试结果" tabindex="-1"><a class="header-anchor" href="#jacodb-基准测试结果" aria-hidden="true">#</a> JacoDB 基准测试结果</h3><p>运行指令：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>./gradlew jcdbBenchmark
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,10),z=n("thead",null,[n("tr",null,[n("th",null,"Benchmark"),n("th",null,"Repeats"),n("th",null,"Avg time per operation")])],-1),H={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/JcdbBenchmarks.kt#L36",target:"_blank",rel:"noopener noreferrer"},W=n("td",null,"5",-1),Q=n("td",null,"1064 ms",-1),X={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/JcdbBenchmarks.kt#L76",target:"_blank",rel:"noopener noreferrer"},$=n("td",null,"5",-1),Y=n("td",null,"1090 ms",-1),Z={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/JcdbBenchmarks.kt#L55",target:"_blank",rel:"noopener noreferrer"},nn=n("td",null,"5",-1),sn=n("td",null,"1551 ms",-1),an={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/JcdbBenchmarks.kt#L97",target:"_blank",rel:"noopener noreferrer"},tn=n("td",null,"5",-1),en=n("td",null,"9054 ms",-1),pn={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/JcdbBenchmarks.kt#L45",target:"_blank",rel:"noopener noreferrer"},cn=n("td",null,"5",-1),on=n("td",null,"1790 ms",-1),ln={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/JcdbBenchmarks.kt#L86",target:"_blank",rel:"noopener noreferrer"},un=n("td",null,"5",-1),rn=n("td",null,"2590 ms",-1),dn={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/JcdbBenchmarks.kt#L65",target:"_blank",rel:"noopener noreferrer"},kn=n("td",null,"5",-1),vn=n("td",null,"2915 ms",-1),mn={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/JcdbBenchmarks.kt#L114",target:"_blank",rel:"noopener noreferrer"},hn=n("td",null,"5",-1),bn=n("td",null,"9798 ms",-1),gn=e(`<h3 id="soot基准测试结果" tabindex="-1"><a class="header-anchor" href="#soot基准测试结果" aria-hidden="true">#</a> Soot基准测试结果</h3><p>运行指令：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>./gradlew sootBenchmark
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,3),fn=n("thead",null,[n("tr",null,[n("th",null,"Benchmark"),n("th",null,"Repeats"),n("th",null,"Avg time per operation")])],-1),yn={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/SootBenchmarks.kt#L61",target:"_blank",rel:"noopener noreferrer"},xn=n("td",null,"5",-1),Jn=n("td",null,"20985 ms",-1),wn={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/SootBenchmarks.kt#L66",target:"_blank",rel:"noopener noreferrer"},_n=n("td",null,"5",-1),jn=n("td",null,"23323 ms",-1),In={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/SootBenchmarks.kt#L71",target:"_blank",rel:"noopener noreferrer"},Sn=n("td",null,"5",-1),Bn=n("td",null,"24027 ms",-1),Cn={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/SootBenchmarks.kt#L76",target:"_blank",rel:"noopener noreferrer"},Rn=n("td",null,"5",-1),An=n("td",null,"30286 ms",-1),En=e(`<h3 id="sootup基准测试结果" tabindex="-1"><a class="header-anchor" href="#sootup基准测试结果" aria-hidden="true">#</a> SootUp基准测试结果</h3><h4 id="createindemandview方式" tabindex="-1"><a class="header-anchor" href="#createindemandview方式" aria-hidden="true">#</a> <code>createInDemandView</code>方式</h4><p>运行指令：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>./gradlew sootupBenchmark
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,4),Ln=n("thead",null,[n("tr",null,[n("th",null,"Benchmark"),n("th",null,"Repeats"),n("th",null,"Avg time per operation")])],-1),qn={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/SootBenchmarks.kt#L39",target:"_blank",rel:"noopener noreferrer"},Tn=n("td",null,"5",-1),On=n("td",null,"0.23 ms",-1),Mn={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/SootupBenchmarks.kt#L44",target:"_blank",rel:"noopener noreferrer"},Dn=n("td",null,"5",-1),Un=n("td",null,"1 ms",-1),Gn={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/SootupBenchmarks.kt#L49",target:"_blank",rel:"noopener noreferrer"},Fn=n("td",null,"5",-1),Pn=n("td",null,"60 ms",-1),Nn={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/SootupBenchmarks.kt#L54",target:"_blank",rel:"noopener noreferrer"},Vn=n("td",null,"5",-1),Kn=n("td",null,"167 ms",-1),zn=n("h4",{id:"createfullview方式",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#createfullview方式","aria-hidden":"true"},"#"),s(),n("code",null,"createFullView"),s("方式")],-1),Hn=n("p",null,"几乎消耗了全部的16GB RAM内存（在12GB时由于OOM错误而失败）。",-1),Wn=n("thead",null,[n("tr",null,[n("th",null,"Benchmark"),n("th",null,"Repeats"),n("th",null,"Avg time per operation")])],-1),Qn={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/SootBenchmarks.kt#L39",target:"_blank",rel:"noopener noreferrer"},Xn=n("td",null,"5",-1),$n=n("td",null,"0.23 ms",-1),Yn={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/SootupBenchmarks.kt#L44",target:"_blank",rel:"noopener noreferrer"},Zn=n("td",null,"5",-1),ns=n("td",null,"89 ms",-1),ss={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/SootupBenchmarks.kt#L49",target:"_blank",rel:"noopener noreferrer"},as=n("td",null,"5",-1),ts=n("td",null,"4247 ms",-1),es={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/SootupBenchmarks.kt#L54",target:"_blank",rel:"noopener noreferrer"},ps=n("td",null,"5",-1),cs=n("td",null,"114 723 ms (fails on 12Gb)",-1),os=e(`<h3 id="对比" tabindex="-1"><a class="header-anchor" href="#对比" aria-hidden="true">#</a> 对比</h3><h4 id="soot" tabindex="-1"><a class="header-anchor" href="#soot" aria-hidden="true">#</a> Soot</h4><p>​ Soot 框架只是读取所有的 JAR 文件并将字节码存储在内存中。与 Soot 不同，JacoDB 从 JAR 文件中读取可用的 .class 文件并并行构建文件夹。因此，在处理多个 JAR 文件时（由于并行执行），它更快。请注意，JacoDB 在几乎所有 API 准备好供使用时执行许多后台任务（层次结构和用法需要后台活动完成）。</p><h4 id="sootup" tabindex="-1"><a class="header-anchor" href="#sootup" aria-hidden="true">#</a> SootUp</h4><p>​ SootUp 框架忽略运行时库。这就是为什么“仅运行时”条件的启动时间几乎等于零的原因。</p><h4 id="jacodb" tabindex="-1"><a class="header-anchor" href="#jacodb" aria-hidden="true">#</a> JacoDB</h4><p>​ JacoDB 在几乎所有 API 已准备好供使用时执行后台任务。以下是执行不带 Usages 功能的后台活动的结果：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>./gradlew awaitBackgroundBenchmark
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,8),is=n("thead",null,[n("tr",null,[n("th",null,"Benchmark"),n("th",null,"Repeats"),n("th",null,"Avg time per operation")])],-1),ls={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/JcdbAwaitBackgroundBenchmarks.kt#L59",target:"_blank",rel:"noopener noreferrer"},us=n("td",null,"5",-1),rs=n("td",null,"3182 ms",-1),ds={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/JcdbAwaitBackgroundBenchmarks.kt#L72",target:"_blank",rel:"noopener noreferrer"},ks=n("td",null,"5",-1),vs=n("td",null,"14737 ms",-1),ms={href:"https://github.com/UnitTestBot/jacodb/tree/main/jacodb-benchmarks/src/test/kotlin/org/jacodb/testing/performance/JcdbAwaitBackgroundBenchmarks.kt#L86",target:"_blank",rel:"noopener noreferrer"},hs=n("td",null,"2",-1),bs=n("td",null,"137528 ms",-1),gs=n("p",null,"​ 对于 IntelliJ IDEA Community 代码库，生成的 SQLite 数据库文件大小约为 3.5 GB。",-1),fs=n("h2",{id:"测试api",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#测试api","aria-hidden":"true"},"#"),s(" 测试API")],-1),ys=n("p",null,"https://jacodb.org/swagger-ui/index.html",-1);function xs(Js,ws){const c=p("font"),t=p("ExternalLinkIcon");return i(),l("div",null,[h,a(c,{color:"red"},{default:u(()=>[s("**示例代码与1.4.2版本接口对不上**")]),_:1}),b,n("table",null,[g,n("tbody",null,[n("tr",null,[n("td",null,[n("a",f,[s("bytecode storage"),a(t)])]),y,x]),n("tr",null,[n("td",null,[n("a",J,[s("scope of visible classes"),a(t)])]),w,_]),n("tr",null,[n("td",null,[n("a",j,[s("class"),a(t)])]),I,S]),B,C,R,n("tr",null,[n("td",null,[n("a",A,[s("3-address bytecode representation"),a(t)])]),E,L]),n("tr",null,[n("td",null,[n("a",q,[s("control flow graph"),a(t)])]),T,O]),n("tr",null,[n("td",null,[n("a",M,[s("class hierarchy"),a(t)])]),D,U]),n("tr",null,[n("td",null,[n("a",G,[s("call graph"),a(t)])]),F,P])])]),N,n("p",null,[n("a",V,[s("贡献指引详细信息"),a(t)])]),K,n("table",null,[z,n("tbody",null,[n("tr",null,[n("td",null,[n("a",H,[s("runtime"),a(t)])]),W,Q]),n("tr",null,[n("td",null,[n("a",X,[s("runtime + guava"),a(t)])]),$,Y]),n("tr",null,[n("td",null,[n("a",Z,[s("runtime + project dependencies"),a(t)])]),nn,sn]),n("tr",null,[n("td",null,[n("a",an,[s("runtime + IDEA community dependecies"),a(t)])]),tn,en]),n("tr",null,[n("td",null,[n("a",pn,[s("runtime + Usages"),a(t)])]),cn,on]),n("tr",null,[n("td",null,[n("a",ln,[s("runtime + guava + Usages"),a(t)])]),un,rn]),n("tr",null,[n("td",null,[n("a",dn,[s("runtime + project dependencies + Usages"),a(t)])]),kn,vn]),n("tr",null,[n("td",null,[n("a",mn,[s("runtime + IDEA community + Usages"),a(t)])]),hn,bn])])]),gn,n("table",null,[fn,n("tbody",null,[n("tr",null,[n("td",null,[n("a",yn,[s("runtime"),a(t)])]),xn,Jn]),n("tr",null,[n("td",null,[n("a",wn,[s("runtime + guava"),a(t)])]),_n,jn]),n("tr",null,[n("td",null,[n("a",In,[s("runtime + project dependencies"),a(t)])]),Sn,Bn]),n("tr",null,[n("td",null,[n("a",Cn,[s("runtime + IDEA community dependecies"),a(t)])]),Rn,An])])]),En,n("table",null,[Ln,n("tbody",null,[n("tr",null,[n("td",null,[n("a",qn,[s("runtime"),a(t)])]),Tn,On]),n("tr",null,[n("td",null,[n("a",Mn,[s("runtime + guava"),a(t)])]),Dn,Un]),n("tr",null,[n("td",null,[n("a",Gn,[s("runtime + project dependencies"),a(t)])]),Fn,Pn]),n("tr",null,[n("td",null,[n("a",Nn,[s("runtime + IDEA community dependecies"),a(t)])]),Vn,Kn])])]),zn,Hn,n("table",null,[Wn,n("tbody",null,[n("tr",null,[n("td",null,[n("a",Qn,[s("runtime"),a(t)])]),Xn,$n]),n("tr",null,[n("td",null,[n("a",Yn,[s("runtime + guava"),a(t)])]),Zn,ns]),n("tr",null,[n("td",null,[n("a",ss,[s("runtime + project dependencies"),a(t)])]),as,ts]),n("tr",null,[n("td",null,[n("a",es,[s("runtime + IDEA community dependecies"),a(t)])]),ps,cs])])]),os,n("table",null,[is,n("tbody",null,[n("tr",null,[n("td",null,[n("a",ls,[s("runtime: wait for background jobs"),a(t)])]),us,rs]),n("tr",null,[n("td",null,[n("a",ds,[s("runtime + project dependencies: wait for background jobs"),a(t)])]),ks,vs]),n("tr",null,[n("td",null,[n("a",ms,[s("runtime + IDEA community dependencies: wait for background jobs"),a(t)])]),hs,bs])])]),gs,fs,ys])}const js=o(m,[["render",xs],["__file","官方使用指南.html.vue"]]);export{js as default};
