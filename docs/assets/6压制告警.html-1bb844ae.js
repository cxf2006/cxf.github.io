import{_ as t,r as p,o,c as l,a as n,d as a,e,b as c}from"./app-b63b8632.js";const i={},u=n("h1",{id:"压制告警",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#压制告警","aria-hidden":"true"},"#"),a(" 压制告警")],-1),r=n("p",null,"​ 摘要：可以通过在源码中添加注解或者注释忽略某些告警，也可以在全局配置中配置忽略某些告警。",-1),d=n("p",null,"​ PMD中有多中忽略告警的配置，可以通过以下几点选择配置方式。",-1),k=n("p",null,"​ 1.如果需要压制的告警属于大多数用户都会压制的告警，可以直接修改Rule规则以抑制告警。或者直接修改该告警。提交合并到PMD代码库。",-1),v=n("p",null,"​ 2.使用注解或者NOPMD标记特殊的问题。",-1),m=n("p",null,"​ 3.正则表达式。",-1),b=n("p",null,"​ 4.XPath查询。",-1),g=n("p",null,"​ 5.修改PMD规则，不提交到PMD代码仓合并。",-1),h={href:"https://docs.pmd-code.org/latest/pmd_userdocs_extending_writing_rules_intro.html",target:"_blank",rel:"noopener noreferrer"},x=c(`<h2 id="anntations" tabindex="-1"><a class="header-anchor" href="#anntations" aria-hidden="true">#</a> Anntations</h2><p>​ 要求java版本&gt;1.5，写法如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 本类中所有PMD问题都不检测</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;PMD&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Bar</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> foo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 不报UnusedLocalVariable类问题</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;PMD.UnusedLocalVariable&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Bar</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> foo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 直接使用JDK的注解</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unused&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Bar</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> foo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">foobar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ Apex下写法：</p><div class="language-apex line-numbers-mode" data-ext="apex"><pre class="language-apex"><code><span class="token comment">// This will suppress all the PMD warnings in this class</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&#39;PMD&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>@SuppressWarnings({&quot;PMD.UnusedLocalVariable&quot;, &quot;PMD.UnusedPrivateMethod&quot;})
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>@SuppressWarnings(&#39;PMD.UnusedLocalVariable, PMD.UnusedPrivateMethod&#39;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="nopmd-标注" tabindex="-1"><a class="header-anchor" href="#nopmd-标注" aria-hidden="true">#</a> NOPMD 标注</h2><p>变量直接标记</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Bar</span> <span class="token punctuation">{</span>
    <span class="token comment">// &#39;bar&#39; is accessed by a native method, so we want to suppress warnings for it</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> bar<span class="token punctuation">;</span> <span class="token comment">//NOPMD</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>命令行模式忽略特定NOPMD标注</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>$ cat <span class="token class-name">Foo</span><span class="token punctuation">.</span>java
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// TURN_OFF_WARNINGS</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

$ pmd check <span class="token operator">-</span>d <span class="token class-name">Foo</span><span class="token punctuation">.</span>java <span class="token operator">-</span>f text <span class="token operator">-</span><span class="token class-name">R</span> java<span class="token operator">-</span>unusedcode <span class="token operator">--</span>suppress<span class="token operator">-</span>marker <span class="token constant">TURN_OFF_WARNINGS</span>
<span class="token class-name">No</span> problems found<span class="token operator">!</span>
<span class="token class-name">UnusedLocalVariable</span> rule violation suppressed by <span class="token comment">//NOPMD in /home/tom/pmd/pmd/bin/Foo.java</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>忽略空if快检查</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>$ cat <span class="token operator">~</span><span class="token operator">/</span>tmp<span class="token operator">/</span><span class="token class-name">Foo</span><span class="token punctuation">.</span>java
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// NOPMD</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
$ java net<span class="token punctuation">.</span>sourceforge<span class="token punctuation">.</span>pmd<span class="token punctuation">.</span><span class="token constant">PMD</span> <span class="token operator">-</span>d <span class="token operator">~</span><span class="token operator">/</span>tmp<span class="token operator">/</span><span class="token class-name">Foo</span><span class="token punctuation">.</span>java <span class="token operator">-</span>f text <span class="token operator">-</span><span class="token class-name">R</span> java<span class="token operator">-</span>basic
<span class="token class-name">No</span> problems found<span class="token operator">!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>标注后的注释体现在报告中</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// NOPMD - this surely will never happen</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>&quot;this surely will never happen&quot;这句描述会体现在PMD的检测结果报告中。</p><h2 id="xpath和正则表达式压制" tabindex="-1"><a class="header-anchor" href="#xpath和正则表达式压制" aria-hidden="true">#</a> XPath和正则表达式压制</h2><h3 id="violationsuppressregex" tabindex="-1"><a class="header-anchor" href="#violationsuppressregex" aria-hidden="true">#</a> violationSuppressRegex</h3><p>匹配检测特定名称的变量名</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rulesets/java/unusedcode.xml/UnusedFormalParameter<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>violationSuppressRegex<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.*&#39;mySpecialParameterName&#39;.*<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>正则表达式的写法参考Java的 java.util.regex.Pattern规则。</p><p>🎗️此处只是定义了规则参数，是否能生效还要看规则实现是否处理了该参数。</p><h3 id="violationsuppressxpath" tabindex="-1"><a class="header-anchor" href="#violationsuppressxpath" aria-hidden="true">#</a> violationSuppressXPath</h3><p>XPath在PMD7的版本是3.1，之前版本是1.0。</p><p>下面规则配置了不报告String类型变量的未使用问题：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rulesets/java/unusedcode.xml/UnusedFormalParameter<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>violationSuppressXPath<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>.[typeIs(&#39;java.lang.String&#39;)]<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>🎗️表达式值解析，“.”开头表示当前上下文节点。“//”开头会配置文件中的所有节点，这样可能会抑制比预期更多的问题，一般不建议这种匹配方式。</p><p>抑制类名字包含“Bean”的类的所有问题：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>violationSuppressXPath<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./ancestor::ClassOrInterfaceDeclaration[contains(@Image, &#39;Bean&#39;)]<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>violationSuppressXPath<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./ancestor::ClassOrInterfaceDeclaration[matches(@Image, &#39;^.*Bean$&#39;)]<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>🎗️此处使用&quot;./ancestor::&quot;开头匹配所有的类或接口定义。</p>`,34),_={href:"https://docs.pmd-code.org/latest/pmd_userdocs_extending_writing_xpath_rules.html",target:"_blank",rel:"noopener noreferrer"};function q(y,f){const s=p("ExternalLinkIcon");return o(),l("div",null,[u,r,d,k,v,m,b,g,n("p",null,[a("如果需要修改Rule，参考 "),n("a",h,[a("如何写规则"),e(s)]),a("。下面是不修改规则的其他方式。")]),x,n("p",null,[a("🎗️如何写XPath查询AST节点以屏蔽自己想要屏蔽的问题，可以参考"),n("a",_,[a("XPath Rule tutorial"),e(s)]),a(".")])])}const P=t(i,[["render",q],["__file","6压制告警.html.vue"]]);export{P as default};
