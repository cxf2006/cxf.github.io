import{_ as s,r as a,o,c as l,a as e,d as t,e as n,b as r}from"./app-b63b8632.js";const d={},c=r('<h1 id="merging-pull-requests" tabindex="-1"><a class="header-anchor" href="#merging-pull-requests" aria-hidden="true">#</a> Merging pull requests</h1><details id="inline-toc-details" style="box-sizing:border-box;border-radius:3px;background:rgb(238, 238, 238);margin-left:10px;display:block;"><summary style="box-sizing:border-box;display:list-item;cursor:pointer;font-size:11pt;vertical-align:top;background:rgb(210, 210, 210);color:black;border-radius:3px;padding:5px 10px;outline:none;">Table of Contents</summary><div id="inline-toc" style="box-sizing:border-box;"><div id="toc" style="box-sizing:border-box;margin-top:15px;margin-left:0px;margin-right:0px;"><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:1rem;background-color:whitesmoke;padding:5px;border-radius:5px;max-width:300px;color:gray;"><li style="box-sizing:border-box;margin:8px 0px 8px 22px;font-size:13.5px;list-style:square;"><a href="https://docs.pmd-code.org/latest/pmd_projectdocs_committers_merging_pull_requests.html#example-1-merging-pr-123-into-master" style="box-sizing:border-box;color:rgb(0, 123, 255);text-decoration:none;background-color:transparent;"></a></li><li style="box-sizing:border-box;margin:8px 0px 8px 22px;font-size:13.5px;list-style:square;"><a href="https://docs.pmd-code.org/latest/pmd_projectdocs_committers_merging_pull_requests.html#example-2-merging-pr-124-into-a-maintenance-branch" style="box-sizing:border-box;color:rgb(0, 123, 255);text-decoration:none;background-color:transparent;"></a><ul style="box-sizing:border-box;margin-top:0px;margin-bottom:0px;background-color:whitesmoke;padding:5px 5px 5px 8px;border-radius:5px;max-width:300px;color:gray;"><li style="box-sizing:border-box;margin:5px 0px 0px;font-size:12.15px;list-style:none;"><a href="https://docs.pmd-code.org/latest/pmd_projectdocs_committers_merging_pull_requests.html#creating-a-maintenance-branch" style="box-sizing:border-box;color:rgb(0, 123, 255);text-decoration:none;background-color:transparent;"></a></li><li style="box-sizing:border-box;margin:5px 0px 0px;font-size:12.15px;list-style:none;"><a href="https://docs.pmd-code.org/latest/pmd_projectdocs_committers_merging_pull_requests.html#merging-the-pr" style="box-sizing:border-box;color:rgb(0, 123, 255);text-decoration:none;background-color:transparent;"></a></li><li style="box-sizing:border-box;margin:5px 0px 0px;font-size:12.15px;list-style:none;"><a href="https://docs.pmd-code.org/latest/pmd_projectdocs_committers_merging_pull_requests.html#merging-into-master" style="box-sizing:border-box;color:rgb(0, 123, 255);text-decoration:none;background-color:transparent;"></a></li><li style="box-sizing:border-box;margin:5px 0px 0px;font-size:12.15px;list-style:none;"><a href="https://docs.pmd-code.org/latest/pmd_projectdocs_committers_merging_pull_requests.html#merging-vs-cherry-picking" style="box-sizing:border-box;color:rgb(0, 123, 255);text-decoration:none;background-color:transparent;"></a></li></ul></li></ul></div></div></details>',2),m={id:"example-1-merging-pr-123-into-master-✏️️",tabindex:"-1"},h=e("a",{class:"header-anchor",href:"#example-1-merging-pr-123-into-master-✏️️","aria-hidden":"true"},"#",-1),p={href:"https://github.com/pmd/pmd/blob/master/docs/pages/pmd/projectdocs/committers/merging_pull_requests.md",target:"_blank",rel:"noopener noreferrer"},g=r(`<li><p>Review the pull request</p><ul><li>Compilation and checkstyle is verified already by github actions build: PRs are automatically checked.</li><li>If it is a bug fix, a new unit test, that reproduces the bug, is mandatory. Without such a test, we might accidentally reintroduce the bug again.</li><li>Add the appropriate labels on the github issue: If the PR fixes a bug, the label “a:bug” should be used.</li><li>Make sure, the PR is added to the appropriate milestone. If the PR fixes a bug, make sure, that the bug issue is added to the same milestone.</li></ul></li><li><p>The actual merge commands:</p><p>We assume, that the PR has been created from the master branch. If this is not the case, then we’ll either need to rebase or ask for rebasing before merging.</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>git checkout master &amp;&amp; git pull origin master                    # make sure, you have the latest code
git fetch origin pull/123/head:pr-123 &amp;&amp; git checkout pr-123     # creates a new temporary branch &quot;pr-123&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li>`,2),u={href:"https://github.com/pmd/pmd/blob/master/docs/pages/release_notes.md",target:"_blank",rel:"noopener noreferrer"},b=r(`<ul><li><p>Are there any API changes, that need to be documented? (Section “API Changes”)</p></li><li><p>Are there any significant changes to existing rules, that should be mentioned? (Section “Modified Rules” / “New Rules” / “Removed Rules”)</p><p>Changes for modified rules are e.g. new properties or changed default values for properties.</p></li><li><p>If the PR fixes a bug, make sure, it is listed under the section “Fixed Issues”. Also make sure, that the PR description mentions this (e.g. “- fixes #issue-number”) and the this PR is linked with the issue. Merging this PR will then automatically close the issue.</p></li><li><p>In any case, add the PR to the section “External Contributions”.</p></li><li><p>Commit these changes with the message:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>git add docs/pages/release_notes.md
git commit -m &quot;[doc] Update release notes (#123)&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p><strong>Note:</strong> If the PR fixes a bug, verify, that we have a commit with the message “Fixes #issue-number”. If this doesn’t exist, you can add it to the commit message when updating the release notes: <code>[doc] Update release notes (#123, fixes #issue-number)</code>. This will automatically close the github issue.</p>`,2),x=r(`<li><p>Add the contributor to <code>.all-contributorsrc</code>:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>npx all-contributors add
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>And follow the instructions. This will create a new commit into to the current branch (pr-123) updating both the file <code>.all-contributorsrc</code> and <code>docs/pages/pmd/projectdocs/credits.md</code>.</p></li><li><p>Now merge the pull request into the master branch:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>git checkout master
git merge --no-ff pr-123 -m &quot;Merge pull request #123 from xyz:branch
    
Full-title-of-the-pr #123&quot; --log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Note:</strong> If there are merge conflicts, you’ll need to deal with them here.</p></li><li><p>Run the complete build: <code>./mvnw clean verify -Pgenerate-rule-docs</code></p><p><strong>Note:</strong> This will execute all the unit tests and the checkstyle tests. It ensures, that the complete project can be build and is functioning on top of the current master.</p><p><strong>Note:</strong> The profile <code>generate-rule-docs</code> will run the doc checks, that would otherwise only run on github actions and fail the build, if e.g. a jdoc or rule reference is wrong.</p></li><li><p>If the build was successful, you are ready to push:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>git push origin master
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Since the temporary branch is now not needed anymore, you can delete it: <code>git branch -d pr-123</code>.</p></li>`,4),v={id:"example-2-merging-pr-124-into-a-maintenance-branch-✏️️",tabindex:"-1"},f=e("a",{class:"header-anchor",href:"#example-2-merging-pr-124-into-a-maintenance-branch-✏️️","aria-hidden":"true"},"#",-1),_={href:"https://github.com/pmd/pmd/blob/master/docs/pages/pmd/projectdocs/committers/merging_pull_requests.md",target:"_blank",rel:"noopener noreferrer"},y=e("p",null,"We ask, to create every pull request against master, to make it easier to contribute. But if a pull request is intended to fix a bug in an older version of PMD, then we need to backport this pull request.",-1),w={id:"creating-a-maintenance-branch-✏️️",tabindex:"-1"},k=e("a",{class:"header-anchor",href:"#creating-a-maintenance-branch-✏️️","aria-hidden":"true"},"#",-1),q={href:"https://github.com/pmd/pmd/blob/master/docs/pages/pmd/projectdocs/committers/merging_pull_requests.md",target:"_blank",rel:"noopener noreferrer"},P=r(`<p>For older versions, we use maintenance branches, like <code>pmd/5.8.x</code>. If there is no maintenance branch for the specific version, then we’ll have to create it first. Let’s say, we want a maintenance branch for PMD version 5.8.0, so that we can create a bugfix release 5.8.1.</p><ol><li><p>We’ll simply create a new branch off of the release tag:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>git branch pmd/5.8.x pmd_releases/5.8.0 &amp;&amp; git checkout pmd/5.8.x
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Now we’ll need to adjust the version, since it’s currently the same as the release version. We’ll change the version to the next patch version: “5.8.1-SNAPSHOT”.</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>./mvnw versions:set -DnewVersion=5.8.1-SNAPSHOT
git add pom.xml \\*/pom.xml pmd-scala-modules/\\*/pom.xml
git commit -m &quot;Prepare next version 5.8.1-SNAPSHOT&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol>`,2),z={id:"merging-the-pr-✏️️",tabindex:"-1"},R=e("a",{class:"header-anchor",href:"#merging-the-pr-✏️️","aria-hidden":"true"},"#",-1),I={href:"https://github.com/pmd/pmd/blob/master/docs/pages/pmd/projectdocs/committers/merging_pull_requests.md",target:"_blank",rel:"noopener noreferrer"},N=r(`<ol><li><p>As above: Review the PR</p></li><li><p>Fetch the PR and rebase it onto the maintenance branch:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>git fetch origin pull/124/head:pr-124 &amp;&amp; git checkout pr-124     # creates a new temporary branch
git rebase master --onto pmd/5.8.x
./mvnw clean verify                                # make sure, everything works after the rebase
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Note:</strong> You might need to fix conflicts / backport the commits for the older PMD version.</p></li><li><p>Update the release notes. See above for details.</p></li><li><p>Now merge the pull request into the maintenance branch:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>git checkout pmd/5.8.x
git merge --no-ff pr-124 -m &quot;Merge pull request #124 from xyz:branch
    
Full-title-of-the-pr #124&quot; --log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Just to be sure, run the complete build again: <code>./mvnw clean verify -Pgenerate-rule-docs</code>.</p></li><li><p>If the build was successful, you are ready to push:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>git push origin pmd/5.8.x
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Since we have rebased the pull request, it won’t appear as merged on github. You need to manually close the pull request. Leave a comment, that it has been rebased onto the maintenance branch.</p></li></ol>`,1),j={id:"merging-into-master-✏️️",tabindex:"-1"},M=e("a",{class:"header-anchor",href:"#merging-into-master-✏️️","aria-hidden":"true"},"#",-1),T={href:"https://github.com/pmd/pmd/blob/master/docs/pages/pmd/projectdocs/committers/merging_pull_requests.md",target:"_blank",rel:"noopener noreferrer"},A=r(`<p>Now the PR has been merged into the maintenance branch, but it is missing in any later version of PMD. Therefore, we merge first into the next minor version maintenance branch (if existing):</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>git checkout pmd/5.9.x
git merge pmd/5.8.x
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>After that, we merge the changes into the master branch:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>git checkout master
git merge pmd/5.9.x
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Note:</strong> This ensures, that every change on the maintenance branch eventually ends up in the master branch and therefore in any future version of PMD. The downside is however, that there are inevitable merge conflicts for the maven <code>pom.xml</code> files, since every branch changed the version number differently. We could avoid this by merging only the temporary branch “pr-124” into each maintenance branch and eventually into master, with the risk of missing single commits in a maintenance branch, that have been done outside the temporary branch.</p>`,5),S={id:"merging-vs-cherry-picking-✏️️",tabindex:"-1"},C=e("a",{class:"header-anchor",href:"#merging-vs-cherry-picking-✏️️","aria-hidden":"true"},"#",-1),W={href:"https://github.com/pmd/pmd/blob/master/docs/pages/pmd/projectdocs/committers/merging_pull_requests.md",target:"_blank",rel:"noopener noreferrer"},D=e("p",null,"We are not using cherry-picking, so that each fix is represented by a single commit. Cherry-picking would duplicate the commit and you can’t see in the log, on which branches the fix has been integrated (e.g. gitk and github show the branches, from which the specific commit is reachable).",-1),E=e("p",null,"The downside is a more complex history - the maintenance branches and master branch are “connected” and not separate.",-1);function F(V,B){const i=a("ExternalLinkIcon");return o(),l("div",null,[c,e("h2",m,[h,t(" Example 1: Merging PR #123 into master "),e("a",p,[t("✏️️"),n(i)])]),e("ol",null,[g,e("li",null,[e("p",null,[t("Update the "),e("a",u,[t("release notes"),n(i)]),t(":")]),b]),x]),e("h2",v,[f,t(" Example 2: Merging PR #124 into a maintenance branch "),e("a",_,[t("✏️️"),n(i)])]),y,e("h3",w,[k,t(" Creating a maintenance branch "),e("a",q,[t("✏️️"),n(i)])]),P,e("h3",z,[R,t(" Merging the PR "),e("a",I,[t("✏️️"),n(i)])]),N,e("h3",j,[M,t(" Merging into master "),e("a",T,[t("✏️️"),n(i)])]),A,e("h3",S,[C,t(" Merging vs. Cherry-Picking "),e("a",W,[t("✏️️"),n(i)])]),D,E])}const U=s(d,[["render",F],["__file","2合并请求.html.vue"]]);export{U as default};
