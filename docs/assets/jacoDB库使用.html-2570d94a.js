import{_ as n,o as s,c as a,b as t}from"./app-b63b8632.js";const p="/notes/assets/image-20231201163922710-b2274383.png",e="/notes/assets/jacodb类梳理.drawio-624c150c.svg",c="/notes/assets/image-20231212181955413-370a5928.png",o="/notes/assets/image-20231222185116977-e5fcf517.png",i={},l=t(`<h1 id="一-jacodb基础" tabindex="-1"><a class="header-anchor" href="#一-jacodb基础" aria-hidden="true">#</a> 一 jacodb基础</h1><h2 id="_1创建数据库" tabindex="-1"><a class="header-anchor" href="#_1创建数据库" aria-hidden="true">#</a> 1创建数据库</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">JcDatabase</span> database <span class="token operator">=</span> <span class="token class-name">JacoDB</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span>jcSettings<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_1-1创建选项jcsettings" tabindex="-1"><a class="header-anchor" href="#_1-1创建选项jcsettings" aria-hidden="true">#</a> 1.1创建选项JcSettings</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>JcSettings jcSettings = new JcSettings()
                .useJavaHomeRuntime()
                .persistent(&quot;./tmp/compilation-db/test.db&quot;),
                .installFeatures(Usages.INSTANCE, InMemoryHierarchy.INSTANCE);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-1-1设置java运行时库" tabindex="-1"><a class="header-anchor" href="#_1-1-1设置java运行时库" aria-hidden="true">#</a> 1.1.1设置java运行时库</h4><p>​ 这里设置成和被监测代码运行时相同的java版本。</p><p>​ useJavaHomeRuntime()</p><p>​ 从JAVA_HOME环境变量加载运行时库。</p><p>​ useProcessJavaRuntime()</p><p>​ 和当前运行程序使用相同的运行时库。</p><p>​ useJavaRuntime(runtime: File)</p><p>​ 指定加载运行时库的位置。</p><p>​ 如果三个都不设置，默认使用useProcessJavaRuntime()。</p><h4 id="_1-1-2设置数据库文件位置" tabindex="-1"><a class="header-anchor" href="#_1-1-2设置数据库文件位置" aria-hidden="true">#</a> 1.1.2设置数据库文件位置</h4><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>.persistent(&quot;./tmp/compilation-db/test.db&quot;)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="_1-1-3加载特性" tabindex="-1"><a class="header-anchor" href="#_1-1-3加载特性" aria-hidden="true">#</a> 1.1.3加载特性</h4><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>.installFeatures(Usages.INSTANCE, InMemoryHierarchy.INSTANCE)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>​ Usages.INSTANCE</p><p>​ InMemoryHierarchy.INSTANCE</p><p><strong>⚠️创建数据库后，jre库的信息会自动存储到数据库。</strong></p><h4 id="_1-1-4-监听文件系统变化" tabindex="-1"><a class="header-anchor" href="#_1-1-4-监听文件系统变化" aria-hidden="true">#</a> 1.1.4 监听文件系统变化</h4><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>.watchFileSystem()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>jar包删除会有以下日志警告：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[DefaultDispatcher-worker-2 @coroutine#186] WARN org.jacodb.impl.fs.ByteCodeLocationsKt$logger$1 - D:\\code\\jacodb-test\\target\\jacodb-test-1.0-SNAPSHOT.jar doesn&#39;t exists. make sure there is no mistake
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>jar包变更会将新的jar包所有内容存储到数据库，旧数据不会清除。</p><p>class文件的删除和新增，数据库不会更新。</p><h2 id="_2加载被分析代码的bitcode信息" tabindex="-1"><a class="header-anchor" href="#_2加载被分析代码的bitcode信息" aria-hidden="true">#</a> 2加载被分析代码的bitcode信息</h2><p>指定jar包位置或者class目录：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">File</span> commonsMath32 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;commons-math3-3.2.jar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">File</span> commonsMath36 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;commons-math3-3.6.1.jar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">File</span> buildDir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;my-project/build/classes/java/main&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
database<span class="token punctuation">.</span><span class="token function">asyncLoad</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>commonsMath32<span class="token punctuation">,</span> commonsMath36<span class="token punctuation">,</span> buildDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-监听class文件变更-无效" tabindex="-1"><a class="header-anchor" href="#_3-监听class文件变更-无效" aria-hidden="true">#</a> 3 监听class文件变更(无效)</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// This method just refreshes the libraries inside the database. If there are any changes in libs then </span>
<span class="token comment">// the database updates data with the new results.</span>
database<span class="token punctuation">.</span><span class="token function">asyncLoad</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span>buildDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试未生效。目录下的class文件变更，和jar包变更都不会更新数据库数据。</p><h2 id="_4-查询类信息" tabindex="-1"><a class="header-anchor" href="#_4-查询类信息" aria-hidden="true">#</a> 4 查询类信息</h2><h3 id="_4-1-指定查询范围" tabindex="-1"><a class="header-anchor" href="#_4-1-指定查询范围" aria-hidden="true">#</a> 4.1 指定查询范围</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">JcClasspath</span> classpath <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">asyncClasspath</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>buildDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">JcClassOrInterface</span> jcClass <span class="token operator">=</span> classpath<span class="token punctuation">.</span><span class="token function">findClassOrNull</span><span class="token punctuation">(</span><span class="token string">&quot;org.example.B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-获取类信息" tabindex="-1"><a class="header-anchor" href="#_4-2-获取类信息" aria-hidden="true">#</a> 4.2 获取类信息</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// 方法数量(包括构造方法)</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jcClass<span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 注解数量</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jcClass<span class="token punctuation">.</span><span class="token function">getAnnotations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 构造函数数量</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">JcClasses</span><span class="token punctuation">.</span><span class="token function">getConstructors</span><span class="token punctuation">(</span>jcClass<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">getClasspath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">asmNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">getInnerClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">bytecode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">getLookup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">getOuterClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">getOuterMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">getSuperClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">getAccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">getDeclaration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">asmNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">extensionValue</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">isAnnotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">isAnonymous</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">isInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">isFinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">isAbstract</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">isPackagePrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">isPrivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">isProtected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">isPublic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">isStatic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
jcClass<span class="token punctuation">.</span><span class="token function">isSynthetic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-类型" tabindex="-1"><a class="header-anchor" href="#_5-类型" aria-hidden="true">#</a> 5 类型</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">JcClassType</span> b <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">JcClassType</span><span class="token punctuation">)</span>classpath<span class="token punctuation">.</span><span class="token function">findTypeOrNull</span><span class="token punctuation">(</span><span class="token string">&quot;org.example.B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">JcType</span> xType <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token function">getFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>it <span class="token operator">-&gt;</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFieldType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">JcClassType</span> stringType <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">JcClassType</span><span class="token punctuation">)</span> classpath<span class="token punctuation">.</span><span class="token function">findTypeOrNull</span><span class="token punctuation">(</span><span class="token string">&quot;java.lang.String&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>xType<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>stringType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// will print &quot;true&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>JcClassType
JcType
JcTypeField
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-method" tabindex="-1"><a class="header-anchor" href="#_6-method" aria-hidden="true">#</a> 6 method</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">JcMethod</span> jcMethod <span class="token operator">=</span> <span class="token class-name">JcClasses</span><span class="token punctuation">.</span><span class="token function">findDeclaredMethodOrNull</span><span class="token punctuation">(</span>cString<span class="token punctuation">,</span> <span class="token string">&quot;getName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;(I)Ljava/lang/String;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>关于第二个入参&quot;desc&quot;的值，形式为：“(Ljava/lang/String;Ljava/lang/String;)Ljava/lang/String;” 括号内的是入参类型，后面是返回值类型。如果desc为null，则返回第一个相同函数名的函数，后续重载方法忽略。</p><p>Raw instruction</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">JcInstList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JcRawInst</span><span class="token punctuation">&gt;</span></span> rawInstructionList <span class="token operator">=</span> jcMethod<span class="token punctuation">.</span><span class="token function">getRawInstList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">JcRawInst</span> instruction <span class="token operator">:</span> rawInstructionList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instruction <span class="token operator">+</span> <span class="token string">&quot;         (&quot;</span> <span class="token operator">+</span> instruction<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JcRawExpr</span><span class="token punctuation">&gt;</span></span> expressionList <span class="token operator">=</span> instruction<span class="token punctuation">.</span><span class="token function">getOperands</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">JcRawExpr</span> expression <span class="token operator">:</span> expressionList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>expression<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>expression<span class="token punctuation">.</span><span class="token function">getTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JcRawValue</span><span class="token punctuation">&gt;</span></span> valueList <span class="token operator">=</span> expression<span class="token punctuation">.</span><span class="token function">getOperands</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">JcRawValue</span> value <span class="token operator">:</span>valueList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;valueType:&quot;</span><span class="token operator">+</span>value<span class="token punctuation">.</span><span class="token function">getTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-instruction" tabindex="-1"><a class="header-anchor" href="#_7-instruction" aria-hidden="true">#</a> 7 Instruction</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">JcInstList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JcInst</span><span class="token punctuation">&gt;</span></span> instructionList <span class="token operator">=</span> jcMethod<span class="token punctuation">.</span><span class="token function">getInstList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">JcInst</span> instruction <span class="token operator">:</span> instructionList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instruction<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;         (&quot;</span> <span class="token operator">+</span> instruction<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>instruction <span class="token keyword">instanceof</span> <span class="token class-name">JcAssignInst</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">JcAssignInst</span> assignInst <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">JcAssignInst</span><span class="token punctuation">)</span>instruction<span class="token punctuation">;</span>
                <span class="token class-name">JcValue</span> lValue <span class="token operator">=</span> assignInst<span class="token punctuation">.</span><span class="token function">getLhv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">JcExpr</span> rValue <span class="token operator">=</span> assignInst<span class="token punctuation">.</span><span class="token function">getRhv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;    &quot;</span> <span class="token operator">+</span> lValue<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;         (&quot;</span> <span class="token operator">+</span> lValue<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;    &quot;</span> <span class="token operator">+</span> rValue<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;         (&quot;</span> <span class="token operator">+</span> rValue<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JcExpr</span><span class="token punctuation">&gt;</span></span> jcExprList  <span class="token operator">=</span> instruction<span class="token punctuation">.</span><span class="token function">getOperands</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token class-name">JcExpr</span> expression <span class="token operator">:</span> jcExprList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;    &quot;</span> <span class="token operator">+</span> expression<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;         (&quot;</span> <span class="token operator">+</span> expression<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-control-flow-graph" tabindex="-1"><a class="header-anchor" href="#_8-control-flow-graph" aria-hidden="true">#</a> 8 control flow graph</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>        <span class="token class-name">JcGraph</span> jcGraph <span class="token operator">=</span> jcMethod<span class="token punctuation">.</span><span class="token function">flowGraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JcInst</span> jcInst <span class="token operator">=</span> jcGraph<span class="token punctuation">.</span><span class="token function">getEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jcInst <span class="token operator">+</span> <span class="token string">&quot;         (&quot;</span> <span class="token operator">+</span> jcInst<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JcExpr</span><span class="token punctuation">&gt;</span></span> jcExprList  <span class="token operator">=</span> jcInst<span class="token punctuation">.</span><span class="token function">getOperands</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token class-name">JcExpr</span> expression <span class="token operator">:</span> jcExprList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;    &quot;</span> <span class="token operator">+</span> expression<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;         (&quot;</span> <span class="token operator">+</span> expression<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token class-name">JcBlockGraph</span> jcBlockGraph <span class="token operator">=</span> jcGraph<span class="token punctuation">.</span><span class="token function">blockGraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="graph可视化" tabindex="-1"><a class="header-anchor" href="#graph可视化" aria-hidden="true">#</a> graph可视化</h3><p>​ 我们还提供了用于可视化JcGraph和JcBlockGraph的API：</p><ul><li><p><code>JcGraph.view(dotCmd: String, viewerCmd: String, viewCatchConnections: Boolean = false)</code> — 使用DOT生成SVG文件（dotCmd需要指定DOT可执行文件的路径），并使用viewerCmd程序（指定浏览器可执行文件）查看。viewCatchConnections标志定义是否在图中显示throw...catch连接。</p></li><li><p><code>JcBlockGraph.view(dotCmd: String, viewerCmd: String)</code> — 类似，但显示JcBlockGraph。</p><p><strong>未验证调用</strong></p></li></ul><h3 id="visitor-api" tabindex="-1"><a class="header-anchor" href="#visitor-api" aria-hidden="true">#</a> Visitor API</h3><h2 id="_9-hierarchy" tabindex="-1"><a class="header-anchor" href="#_9-hierarchy" aria-hidden="true">#</a> 9 hierarchy</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">HierarchyExtension</span> ext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HierarchyExtensionImpl</span><span class="token punctuation">(</span>classpath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Sequence</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JcClassOrInterface</span><span class="token punctuation">&gt;</span></span> classSeq <span class="token operator">=</span> ext<span class="token punctuation">.</span><span class="token function">findSubClasses</span><span class="token punctuation">(</span><span class="token string">&quot;org.example.C&quot;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JcClassOrInterface</span><span class="token punctuation">&gt;</span></span> iter <span class="token operator">=</span> classSeq<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">JcClassOrInterface</span> jcClass <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jcClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Sequence</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JcMethod</span><span class="token punctuation">&gt;</span></span> methodSeq <span class="token operator">=</span> ext<span class="token punctuation">.</span><span class="token function">findOverrides</span><span class="token punctuation">(</span>jcMethod<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JcMethod</span><span class="token punctuation">&gt;</span></span> iterM <span class="token operator">=</span> methodSeq<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>iterM<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">JcMethod</span> method <span class="token operator">=</span> iterM<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>findSubClasses未生效，无法找到子类</p><p>findOverrides未生效，未找到重写的方法。</p><h2 id="_10-usages" tabindex="-1"><a class="header-anchor" href="#_10-usages" aria-hidden="true">#</a> 10 Usages</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>        <span class="token class-name">SyncUsagesExtension</span> usages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SyncUsagesExtension</span><span class="token punctuation">(</span>ext<span class="token punctuation">,</span>classpath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Sequence</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JcMethod</span><span class="token punctuation">&gt;</span></span> usageMethods <span class="token operator">=</span> usages<span class="token punctuation">.</span><span class="token function">findUsages</span><span class="token punctuation">(</span>jcMethod<span class="token punctuation">)</span><span class="token punctuation">;</span>
usages<span class="token punctuation">.</span><span class="token function">findUsages</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> <span class="token class-name">FieldUsageMode</span><span class="token punctuation">.</span><span class="token constant">READ</span><span class="token punctuation">)</span>
usages<span class="token punctuation">.</span><span class="token function">findUsages</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> <span class="token class-name">FieldUsageMode</span><span class="token punctuation">.</span><span class="token constant">WRITE</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_11-测试代码" tabindex="-1"><a class="header-anchor" href="#_11-测试代码" aria-hidden="true">#</a> 11 测试代码</h2><h3 id="测试类-被检测" tabindex="-1"><a class="header-anchor" href="#测试类-被检测" aria-hidden="true">#</a> 测试类-被检测</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SubC</span> <span class="token keyword">extends</span> <span class="token class-name">C</span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;alex&quot;</span><span class="token operator">+</span>k<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token keyword">int</span> orderNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> k <span class="token operator">=</span> orderNum <span class="token operator">+</span>j<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> orderNum <span class="token operator">&gt;</span> j <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            k <span class="token operator">=</span> orderNum <span class="token operator">+</span> j<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>orderNum <span class="token operator">&lt;</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            orderNum <span class="token operator">++</span><span class="token punctuation">;</span>
            k <span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token function">genName</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">genName</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;alex&quot;</span><span class="token operator">+</span>k<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;alex&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">jdk<span class="token punctuation">.</span>jfr<span class="token punctuation">.</span></span><span class="token class-name">Description</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Description</span><span class="token punctuation">(</span><span class="token string">&quot;test annotation&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">A</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">InterfaceA</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> j<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>i <span class="token operator">=</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span><span class="token keyword">int</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>i <span class="token operator">=</span> i<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>j <span class="token operator">=</span> j<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">meth1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">A</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token class-name">T</span> x <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="测试类" tabindex="-1"><a class="header-anchor" href="#测试类" aria-hidden="true">#</a> 测试类</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">kotlin<span class="token punctuation">.</span>sequences<span class="token punctuation">.</span></span><span class="token class-name">Sequence</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">JcClassOrInterface</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">JcClasspath</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">JcDatabase</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">JcMethod</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span>cfg<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span>ext<span class="token punctuation">.</span></span><span class="token class-name">HierarchyExtension</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span>ext<span class="token punctuation">.</span></span><span class="token class-name">JcClasses</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">JacoDB</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">JcSettings</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>features<span class="token punctuation">.</span></span><span class="token class-name">InMemoryHierarchy</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>features<span class="token punctuation">.</span></span><span class="token class-name">Usages</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Iterator</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutionException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>features<span class="token punctuation">.</span></span><span class="token class-name">HierarchyExtensionImpl</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GraphTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">GraphTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建一个DB</span>
        <span class="token class-name">JcSettings</span> jcSettings <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JcSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">watchFileSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">persistent</span><span class="token punctuation">(</span><span class="token string">&quot;./tmp/compilation-db/test.db&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">installFeatures</span><span class="token punctuation">(</span><span class="token class-name">Usages</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">,</span> <span class="token class-name">InMemoryHierarchy</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Usages.INSTANCE,</span>
        <span class="token class-name">JcDatabase</span> database <span class="token operator">=</span> <span class="token class-name">JacoDB</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span>jcSettings<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// persist data</span>

        <span class="token comment">// 加载字节码信息</span>
        <span class="token class-name">File</span> buildDir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;target/classes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        database<span class="token punctuation">.</span><span class="token function">asyncLoad</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>buildDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// class查找范围</span>
        <span class="token class-name">JcClasspath</span> classpath <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">asyncClasspath</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>buildDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// find class</span>
        <span class="token class-name">JcClassOrInterface</span> cString <span class="token operator">=</span>  classpath<span class="token punctuation">.</span><span class="token function">findClassOrNull</span><span class="token punctuation">(</span><span class="token string">&quot;org.example.C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// find  method</span>
        <span class="token keyword">assert</span> cString <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">JcMethod</span> jcMethod <span class="token operator">=</span> <span class="token class-name">JcClasses</span><span class="token punctuation">.</span><span class="token function">findDeclaredMethodOrNull</span><span class="token punctuation">(</span>cString<span class="token punctuation">,</span> <span class="token string">&quot;getName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;(I)Ljava/lang/String;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3-address bytecode</span>
        <span class="token keyword">assert</span> jcMethod <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         *
        System.out.println(&quot;---------&gt;Raw instruction&lt;---------&quot;);
         // raw instruction
        JcInstList<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>JcRawInst</span><span class="token punctuation">&gt;</span></span> rawInstructionList = jcMethod.getRawInstList();
        for (JcRawInst instruction : rawInstructionList) <span class="token punctuation">{</span>
            System.out.println(instruction + &quot;         (&quot; + instruction.getClass().getSimpleName() + &quot;)&quot;);
//            List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>JcRawExpr</span><span class="token punctuation">&gt;</span></span> expressionList = instruction.getOperands();
//            for (JcRawExpr expression : expressionList) <span class="token punctuation">{</span>
//                System.out.println(expression.toString());
//                System.out.println(expression.getTypeName().getTypeName());
//                List<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>JcRawValue</span><span class="token punctuation">&gt;</span></span> valueList = expression.getOperands();
//                for (JcRawValue value :valueList) <span class="token punctuation">{</span>
//                    System.out.println(&quot;valueType:&quot;+value.getTypeName().getTypeName());
//                <span class="token punctuation">}</span>
//            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
         */</span>
        <span class="token doc-comment comment">/**
         *
         */</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;---------&gt;Instruction&lt;---------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// instruction</span>
        <span class="token class-name">JcInstList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JcInst</span><span class="token punctuation">&gt;</span></span> instructionList <span class="token operator">=</span> jcMethod<span class="token punctuation">.</span><span class="token function">getInstList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">JcInst</span> instruction <span class="token operator">:</span> instructionList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>instruction<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;         (&quot;</span> <span class="token operator">+</span> instruction<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>instruction <span class="token keyword">instanceof</span> <span class="token class-name">JcAssignInst</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">JcAssignInst</span> assignInst <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">JcAssignInst</span><span class="token punctuation">)</span>instruction<span class="token punctuation">;</span>
                <span class="token class-name">JcValue</span> lValue <span class="token operator">=</span> assignInst<span class="token punctuation">.</span><span class="token function">getLhv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">JcExpr</span> rValue <span class="token operator">=</span> assignInst<span class="token punctuation">.</span><span class="token function">getRhv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;    &quot;</span> <span class="token operator">+</span> lValue<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;         (&quot;</span> <span class="token operator">+</span> lValue<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;    &quot;</span> <span class="token operator">+</span> rValue<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;         (&quot;</span> <span class="token operator">+</span> rValue<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JcExpr</span><span class="token punctuation">&gt;</span></span> jcExprList  <span class="token operator">=</span> instruction<span class="token punctuation">.</span><span class="token function">getOperands</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token class-name">JcExpr</span> expression <span class="token operator">:</span> jcExprList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;    &quot;</span> <span class="token operator">+</span> expression<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTypeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;         (&quot;</span> <span class="token operator">+</span> expression<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token doc-comment comment">/**
         *
        // control flow graph
        System.out.println(&quot;---------&gt;control flow graph<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>---------&quot;);</span>
        <span class="token attr-name">JcGraph</span> <span class="token attr-name">jcGraph</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> jcMethod.flowGraph();</span>
        <span class="token attr-name">JcInst</span> <span class="token attr-name">jcInst</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> jcGraph.getEntry();</span>
        <span class="token attr-name">System.out.println(jcInst</span> <span class="token attr-name">+</span> <span class="token attr-name">&quot;</span>         <span class="token attr-name">(&quot;</span> <span class="token attr-name">+</span> <span class="token attr-name">jcInst.getClass().getSimpleName()</span> <span class="token attr-name">+</span> <span class="token attr-name">&quot;)&quot;);</span>
        <span class="token attr-name">List&lt;JcExpr</span><span class="token punctuation">&gt;</span></span> jcExprList  = jcInst.getOperands();
        for ( JcExpr expression : jcExprList) <span class="token punctuation">{</span>
            System.out.println(&quot;    &quot; + expression.getType().getTypeName() + &quot;         (&quot; + expression.getClass().getSimpleName() + &quot;)&quot;);
        <span class="token punctuation">}</span>
         */</span>

        <span class="token comment">// hierarchy</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;---------&gt;hierarchy&lt;---------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HierarchyExtension</span> ext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HierarchyExtensionImpl</span><span class="token punctuation">(</span>classpath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Sequence</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JcClassOrInterface</span><span class="token punctuation">&gt;</span></span> classSeq <span class="token operator">=</span> ext<span class="token punctuation">.</span><span class="token function">findSubClasses</span><span class="token punctuation">(</span><span class="token string">&quot;org.example.C&quot;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JcClassOrInterface</span><span class="token punctuation">&gt;</span></span> iter <span class="token operator">=</span> classSeq<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>iter<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">JcClassOrInterface</span> jcClass <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jcClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Sequence</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JcMethod</span><span class="token punctuation">&gt;</span></span> methodSeq <span class="token operator">=</span> ext<span class="token punctuation">.</span><span class="token function">findOverrides</span><span class="token punctuation">(</span>jcMethod<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JcMethod</span><span class="token punctuation">&gt;</span></span> iterM <span class="token operator">=</span> methodSeq<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>iterM<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">JcMethod</span> method <span class="token operator">=</span> iterM<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="二-jacodb静态数据流分析" tabindex="-1"><a class="header-anchor" href="#二-jacodb静态数据流分析" aria-hidden="true">#</a> 二 jacodb静态数据流分析</h1><h2 id="_1-功能调用" tabindex="-1"><a class="header-anchor" href="#_1-功能调用" aria-hidden="true">#</a> 1 功能调用</h2><h3 id="api方式调用" tabindex="-1"><a class="header-anchor" href="#api方式调用" aria-hidden="true">#</a> api方式调用</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span></span><span class="token class-name">AnalysisMain</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">IfdsUnitRunnerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">UnitResolver</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">VulnerabilityInstance</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>graph<span class="token punctuation">.</span></span><span class="token class-name">ApplicationGraphFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>library<span class="token punctuation">.</span></span><span class="token class-name">UnitResolversLibrary</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">JcClassOrInterface</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">JcClasspath</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">JcDatabase</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">JcMethod</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span></span><span class="token class-name">JcApplicationGraph</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">JacoDB</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">JcSettings</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>features<span class="token punctuation">.</span></span><span class="token class-name">InMemoryHierarchy</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>features<span class="token punctuation">.</span></span><span class="token class-name">Usages</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutionException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>library<span class="token punctuation">.</span></span><span class="token class-name">RunnersLibrary</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>sarif<span class="token punctuation">.</span></span><span class="token class-name">SarifReport</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticDataFlow</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">UnusedVariableTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建一个DB</span>
        <span class="token class-name">JcSettings</span> jcSettings <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JcSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">installFeatures</span><span class="token punctuation">(</span><span class="token class-name">Usages</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">,</span> <span class="token class-name">InMemoryHierarchy</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Usages.INSTANCE,</span>
        <span class="token class-name">JcDatabase</span> database <span class="token operator">=</span> <span class="token class-name">JacoDB</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span>jcSettings<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// persist data</span>
        <span class="token comment">// 加载字节码信息</span>
        <span class="token class-name">File</span> buildDir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;target/classes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        database<span class="token punctuation">.</span><span class="token function">asyncLoad</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>buildDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// class查找范围</span>
        <span class="token class-name">JcClasspath</span> classpath <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">asyncClasspath</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>buildDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// find class</span>
        <span class="token class-name">JcClassOrInterface</span> cString <span class="token operator">=</span>  classpath<span class="token punctuation">.</span><span class="token function">findClassOrNull</span><span class="token punctuation">(</span><span class="token string">&quot;org.example.C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">assert</span> cString <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JcMethod</span><span class="token punctuation">&gt;</span></span> methodsToAnalyze <span class="token operator">=</span> cString<span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JcApplicationGraph</span> applicationGraph <span class="token operator">=</span> <span class="token class-name">ApplicationGraphFactory</span>
                <span class="token punctuation">.</span><span class="token function">asyncNewApplicationGraphForAnalysis</span><span class="token punctuation">(</span>classpath<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">UnitResolver</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> resolver <span class="token operator">=</span> <span class="token class-name">UnitResolversLibrary</span><span class="token punctuation">.</span><span class="token function">getMethodUnitResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IfdsUnitRunnerFactory</span> runner <span class="token operator">=</span> <span class="token class-name">RunnersLibrary</span><span class="token punctuation">.</span><span class="token function">getUnusedVariableRunnerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">VulnerabilityInstance</span><span class="token punctuation">&gt;</span></span> vulns <span class="token operator">=</span> <span class="token class-name">AnalysisMain</span><span class="token punctuation">.</span><span class="token function">runAnalysis</span><span class="token punctuation">(</span>
                applicationGraph<span class="token punctuation">,</span>
                resolver<span class="token punctuation">,</span>
                runner<span class="token punctuation">,</span>
                methodsToAnalyze<span class="token punctuation">,</span>
                <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SarifReport</span> report <span class="token operator">=</span> <span class="token class-name">SarifReport<span class="token punctuation">.</span>Companion</span><span class="token punctuation">.</span><span class="token function">fromVulnerabilities</span><span class="token punctuation">(</span>vulns<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">OutputStream</span> outputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;./report.sarif.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        report<span class="token punctuation">.</span><span class="token function">encodeToStream</span><span class="token punctuation">(</span>outputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        outputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        outputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>graph</strong></p><p>​ 根据cp生成graph</p><p><strong>UnitResolver</strong></p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">fun</span> <span class="token function">getByName</span><span class="token punctuation">(</span>name<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> UnitResolver<span class="token operator">&lt;</span><span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">when</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token string-literal singleline"><span class="token string">&quot;method&quot;</span></span>    <span class="token operator">-&gt;</span> MethodUnitResolver
        <span class="token string-literal singleline"><span class="token string">&quot;class&quot;</span></span>     <span class="token operator">-&gt;</span> <span class="token function">getClassUnitResolver</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token string-literal singleline"><span class="token string">&quot;package&quot;</span></span>   <span class="token operator">-&gt;</span> PackageUnitResolver
        <span class="token string-literal singleline"><span class="token string">&quot;singleton&quot;</span></span> <span class="token operator">-&gt;</span> SingletonUnitResolver
        <span class="token keyword">else</span>        <span class="token operator">-&gt;</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Unknown unit resolver </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>runner</strong></p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">val</span> runner <span class="token operator">=</span> <span class="token keyword">when</span> <span class="token punctuation">(</span>analysis<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token string-literal singleline"><span class="token string">&quot;NPE&quot;</span></span> <span class="token operator">-&gt;</span> <span class="token function">newNpeRunnerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token string-literal singleline"><span class="token string">&quot;Unused&quot;</span></span> <span class="token operator">-&gt;</span> UnusedVariableRunnerFactory
    <span class="token string-literal singleline"><span class="token string">&quot;SQL&quot;</span></span> <span class="token operator">-&gt;</span> <span class="token function">newSqlInjectionRunnerFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">error</span> <span class="token punctuation">{</span> <span class="token string-literal singleline"><span class="token string">&quot;Unknown analysis type: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">analysis</span></span><span class="token string">&quot;</span></span> <span class="token punctuation">}</span>
        <span class="token keyword">return</span><span class="token label symbol">@mapNotNull</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>methods</strong></p><p>​ -s指定从哪个类开始分析，配置文件配置分析类型和解析器。</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">val</span> startClassesAsList <span class="token operator">=</span> startClasses<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;;&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">val</span> startJcClasses <span class="token operator">=</span> ConcurrentHashMap<span class="token punctuation">.</span>newKeySet<span class="token operator">&lt;</span>JcClassOrInterface<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
cp<span class="token punctuation">.</span><span class="token function">executeAsync</span><span class="token punctuation">(</span><span class="token keyword">object</span> <span class="token operator">:</span> JcClassProcessingTask <span class="token punctuation">{</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">process</span><span class="token punctuation">(</span>clazz<span class="token operator">:</span> JcClassOrInterface<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>startClassesAsList<span class="token punctuation">.</span><span class="token function">any</span> <span class="token punctuation">{</span> clazz<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            startJcClasses<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> startJcMethods <span class="token operator">=</span> startJcClasses<span class="token punctuation">.</span><span class="token function">flatMap</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span>declaredMethods <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">filter</span> <span class="token punctuation">{</span> <span class="token operator">!</span>it<span class="token punctuation">.</span>isPrivate <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cli方式调用" tabindex="-1"><a class="header-anchor" href="#cli方式调用" aria-hidden="true">#</a> cli方式调用</h3><p>​ 官方未发布cli的jar包，需要下载源码自己编译。</p><p><img src="`+p+`" alt="image-20231201163922710"></p><div class="language-bat line-numbers-mode" data-ext="bat"><pre class="language-bat"><code>java -classpath ^
jacodb-cli-1.4.jar;^
.\\libs\\annotations-13.0.jar;^
.\\libs\\asm-9.5.jar;^
.\\libs\\asm-analysis-9.5.jar;^
.\\libs\\asm-commons-9.5.jar;^
.\\libs\\asm-tree-9.5.jar;^
.\\libs\\asm-util-9.5.jar;^
.\\libs\\checker-qual-3.12.0.jar;^
.\\libs\\commons-math3-3.2.jar;^
.\\libs\\error_prone_annotations-2.11.0.jar;^
.\\libs\\failureaccess-1.0.1.jar;^
.\\libs\\guava-31.1-jre.jar;^
.\\libs\\hamcrest-core-1.3.jar;^
.\\libs\\j2objc-annotations-1.3.jar;^
.\\libs\\jacodb-1.4-SNAPSHOT.jar;^
.\\libs\\jacodb-analysis-1.4-SNAPSHOT-test-fixtures.jar;^
.\\libs\\jacodb-analysis-1.4-SNAPSHOT.jar;^
.\\libs\\jacodb-analysis-1.4.2.jar;^
.\\libs\\jacodb-api-1.4-SNAPSHOT.jar;^
.\\libs\\jacodb-api-1.4.2.jar;^
.\\libs\\jacodb-approximations-1.4-SNAPSHOT.jar;^
.\\libs\\jacodb-approximations-1.4.2.jar;^
.\\libs\\jacodb-benchmarks-1.4-SNAPSHOT.jar;^
.\\libs\\jacodb-core-1.4-SNAPSHOT-test-fixtures.jar;^
.\\libs\\jacodb-core-1.4-SNAPSHOT.jar;^
.\\libs\\jacodb-core-1.4.2.jar;^
.\\libs\\jacodb-examples-1.4-SNAPSHOT.jar;^
.\\libs\\jacodb-taint-configuration-1.4-SNAPSHOT.jar;^
.\\libs\\jacodb-taint-configuration-1.4.2.jar;^
.\\libs\\javax.activation-api-1.2.0.jar;^
.\\libs\\jaxb-api-2.3.1.jar;^
.\\libs\\jdot-1.0.jar;^
.\\libs\\jooq-3.14.16.jar;^
.\\libs\\jsr305-3.0.2.jar;^
.\\libs\\junit-4.13.1.jar;^
.\\libs\\kotlin-logging-1.8.3.jar;^
.\\libs\\kotlin-reflect-1.7.21.jar;^
.\\libs\\kotlin-stdlib-1.7.21.jar;^
.\\libs\\kotlin-stdlib-common-1.3.72.jar;^
.\\libs\\kotlin-stdlib-common-1.7.21.jar;^
.\\libs\\kotlin-stdlib-jdk7-1.7.21.jar;^
.\\libs\\kotlin-stdlib-jdk8-1.7.21.jar;^
.\\libs\\kotlinx-benchmark-runtime-jvm-0.4.4.jar;^
.\\libs\\kotlinx-cli-jvm-0.3.5.jar;^
.\\libs\\kotlinx-collections-immutable-jvm-0.3.5.jar;^
.\\libs\\kotlinx-coroutines-core-1.6.4.jar;^
.\\libs\\kotlinx-coroutines-core-common-1.3.8.jar;^
.\\libs\\kotlinx-coroutines-core-jvm-1.6.4.jar;^
.\\libs\\kotlinx-coroutines-jdk8-1.6.4.jar;^
.\\libs\\kotlinx-coroutines-reactive-1.6.4.jar;^
.\\libs\\kotlinx-coroutines-reactor-1.6.4.jar;^
.\\libs\\kotlinx-metadata-jvm-0.5.0.jar;^
.\\libs\\kotlinx-serialization-cbor-jvm-1.4.1.jar;^
.\\libs\\kotlinx-serialization-core-jvm-1.4.1.jar;^
.\\libs\\kotlinx-serialization-json-jvm-1.4.1.jar;^
.\\libs\\listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar;^
.\\libs\\reactive-streams-1.0.2.jar;^
.\\libs\\slf4j-api-1.7.29.jar;^
.\\libs\\slf4j-simple-1.7.36.jar;^
.\\libs\\sqlite-jdbc-3.41.2.2.jar ^
org.jacodb.cli.MainKt -a config.json -s org.jacodb.testing.analysis.NpeExamples
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>命令参数</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>	--analysisConf, -a — 包含以 JSON 格式提供的分析配置的文件路径（详细描述见下文）。
​	 --start, -s — 指定分析开始的类。 
​	--classpath, -cp — JacoDB 分析所需的类路径。 [可选] 
​	--dbLocation, -l — 存储字节码数据的 SQLite 数据库的位置。如果未指定，将不会将数据存储在数据库中。 [可选] 
​	--output, -o — 用于存储分析报告的文件。默认为 report.json。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>config.json</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;analyses&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;NPE&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;Unused&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;UnitResolver&quot;</span><span class="token operator">:</span> <span class="token string">&quot;class&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;SQL&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ UnitResolver有四种，分别为：method、class、package、singleton。分析精度依次递增，消耗依次递增。</p><p>​ NPE-进行空指针异常检查</p><p>​ Unused-进行未使用变量检查</p><p>​ SQL-sql注入检查</p><p>​ 目前已有的三项检测功能，如果不检测哪一项，不配置即可。</p><h2 id="_2-已实现功能" tabindex="-1"><a class="header-anchor" href="#_2-已实现功能" aria-hidden="true">#</a> 2 已实现功能</h2><p>​ 空指针异常(NPE)</p><p>​ 未使用变量(Unused)</p><p>​ sql注入(SQL)</p><p>​ 通用污点分析</p><p>具体功能参考源码，在自定义分析时可以参考上述实现，以及【Analysis模块类结构】可以快速理清自定义分析器的逻辑。</p><h2 id="_3-自定义分析" tabindex="-1"><a class="header-anchor" href="#_3-自定义分析" aria-hidden="true">#</a> 3 自定义分析</h2><h3 id="自定义分析器" tabindex="-1"><a class="header-anchor" href="#自定义分析器" aria-hidden="true">#</a> 自定义分析器</h3><p>定义了一个空的分析器，只写了分析器扩展的基本结构类。在TestForwardFunctions.java文件中处理发现问题。</p><p>RunnersLibraryExt.java</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>library</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">BaseIfdsUnitRunnerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>library<span class="token punctuation">.</span>analyzers<span class="token punctuation">.</span></span><span class="token class-name">TestAnalyzerFactory</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RunnersLibraryExt</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">BaseIfdsUnitRunnerFactory</span> <span class="token function">newTestRunnerFactory</span><span class="token punctuation">(</span><span class="token keyword">int</span> maxPathLength<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>maxPathLength <span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            maxPathLength <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BaseIfdsUnitRunnerFactory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TestAnalyzerFactory</span><span class="token punctuation">(</span>maxPathLength<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>TestAnalyzer.java</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>library<span class="token punctuation">.</span>analyzers</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">AbstractAnalyzer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">FlowFunctionsSpace</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span></span><span class="token class-name">JcApplicationGraph</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jetbrains<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">NotNull</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestAnalyzer</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractAnalyzer</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">int</span> maxPathLength<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">JcApplicationGraph</span> graph<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">TestAnalyzer</span><span class="token punctuation">(</span><span class="token class-name">JcApplicationGraph</span> graph<span class="token punctuation">,</span> <span class="token keyword">int</span> maxPathLength<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>graph<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>maxPathLength <span class="token operator">=</span> maxPathLength<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>graph <span class="token operator">=</span> graph<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isMainAnalyzer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@NotNull</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">FlowFunctionsSpace</span> <span class="token function">getFlowFunctions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TestForwardFunctions</span><span class="token punctuation">(</span>graph<span class="token punctuation">.</span><span class="token function">getClasspath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>maxPathLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>TestAnalyzerFactory.java</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>library<span class="token punctuation">.</span>analyzers</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">Analyzer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">AnalyzerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span></span><span class="token class-name">JcApplicationGraph</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jetbrains<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">NotNull</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">TestAnalyzerFactory</span> <span class="token keyword">implements</span>   <span class="token class-name">AnalyzerFactory</span><span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> maxPathLength<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">TestAnalyzerFactory</span><span class="token punctuation">(</span><span class="token keyword">int</span> maxPathLength<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>maxPathLength <span class="token operator">=</span> maxPathLength<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@NotNull</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Analyzer</span> <span class="token function">newAnalyzer</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NotNull</span> <span class="token class-name">JcApplicationGraph</span> graph<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">TestAnalyzer</span><span class="token punctuation">(</span>graph<span class="token punctuation">,</span>maxPathLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>TestForwardFunctions.java</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>library<span class="token punctuation">.</span>analyzers</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">DomainFact</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">ZEROFact</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">JcClasspath</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span>cfg<span class="token punctuation">.</span></span><span class="token class-name">JcExpr</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span>cfg<span class="token punctuation">.</span></span><span class="token class-name">JcInst</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span>cfg<span class="token punctuation">.</span></span><span class="token class-name">JcValue</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jetbrains<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">NotNull</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collection</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestForwardFunctions</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractTaintForwardFunctions</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> maxPathLength<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">TestForwardFunctions</span><span class="token punctuation">(</span><span class="token class-name">JcClasspath</span> cp<span class="token punctuation">,</span> <span class="token keyword">int</span> maxPathLength<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>cp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>maxPathLength <span class="token operator">=</span> maxPathLength<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@NotNull</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DomainFact</span><span class="token punctuation">&gt;</span></span> <span class="token function">obtainPossibleStartFacts</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NotNull</span> <span class="token class-name">JcInst</span> startStatement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DomainFact</span><span class="token punctuation">&gt;</span></span> factList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        factList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">ZEROFact</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;obtainPossibleStartFacts---&gt; &quot;</span> <span class="token operator">+</span> startStatement<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> factList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@NotNull</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DomainFact</span><span class="token punctuation">&gt;</span></span> <span class="token function">transmitDataFlow</span><span class="token punctuation">(</span>
            <span class="token annotation punctuation">@NotNull</span> <span class="token class-name">JcExpr</span> jcExpr<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@NotNull</span> <span class="token class-name">JcValue</span> jcValue<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@NotNull</span> <span class="token class-name">JcInst</span> jcInst<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@NotNull</span> <span class="token class-name">DomainFact</span> domainFact<span class="token punctuation">,</span>
            <span class="token keyword">boolean</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;transmitDataFlow---&gt; &quot;</span> <span class="token operator">+</span> jcExpr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;transmitDataFlow---&gt; &quot;</span> <span class="token operator">+</span> jcValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;transmitDataFlow---&gt; &quot;</span> <span class="token operator">+</span> jcInst<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;transmitDataFlow---&gt; &quot;</span> <span class="token operator">+</span> domainFact<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;transmitDataFlow---&gt; &quot;</span> <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@NotNull</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DomainFact</span><span class="token punctuation">&gt;</span></span> <span class="token function">transmitDataFlowAtNormalInst</span><span class="token punctuation">(</span>
            <span class="token annotation punctuation">@NotNull</span> <span class="token class-name">JcInst</span> jcInst<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@NotNull</span> <span class="token class-name">JcInst</span> jcInst1<span class="token punctuation">,</span>
            <span class="token annotation punctuation">@NotNull</span> <span class="token class-name">DomainFact</span> domainFact<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;transmitDataFlowAtNormalInst---&gt; &quot;</span> <span class="token operator">+</span> jcInst<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;transmitDataFlowAtNormalInst---&gt; &quot;</span> <span class="token operator">+</span> jcInst1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;transmitDataFlowAtNormalInst---&gt; &quot;</span> <span class="token operator">+</span> domainFact<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="调用自定义分析器" tabindex="-1"><a class="header-anchor" href="#调用自定义分析器" aria-hidden="true">#</a> 调用自定义分析器</h3><p>只有这句和之前调用不一致。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">IfdsUnitRunnerFactory</span> runner <span class="token operator">=</span> <span class="token class-name">RunnersLibraryExt</span><span class="token punctuation">.</span><span class="token function">newTestRunnerFactory</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>完整代码：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span></span><span class="token class-name">AnalysisMain</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">IfdsUnitRunnerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">UnitResolver</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>engine<span class="token punctuation">.</span></span><span class="token class-name">VulnerabilityInstance</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>graph<span class="token punctuation">.</span></span><span class="token class-name">ApplicationGraphFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>library<span class="token punctuation">.</span></span><span class="token class-name">RunnersLibraryExt</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>library<span class="token punctuation">.</span></span><span class="token class-name">UnitResolversLibrary</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">JcClassOrInterface</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">JcClasspath</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">JcDatabase</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">JcMethod</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>api<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span></span><span class="token class-name">JcApplicationGraph</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">JacoDB</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">JcSettings</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>features<span class="token punctuation">.</span></span><span class="token class-name">InMemoryHierarchy</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>features<span class="token punctuation">.</span></span><span class="token class-name">Usages</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutionException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jacodb<span class="token punctuation">.</span>analysis<span class="token punctuation">.</span>sarif<span class="token punctuation">.</span></span><span class="token class-name">SarifReport</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticDataFlow</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">UnusedVariableTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建一个DB</span>
        <span class="token class-name">JcSettings</span> jcSettings <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JcSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">installFeatures</span><span class="token punctuation">(</span><span class="token class-name">Usages</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">,</span> <span class="token class-name">InMemoryHierarchy</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Usages.INSTANCE,</span>
        <span class="token class-name">JcDatabase</span> database <span class="token operator">=</span> <span class="token class-name">JacoDB</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span>jcSettings<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// persist data</span>
        <span class="token comment">// 加载字节码信息</span>
        <span class="token class-name">File</span> buildDir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;target/classes&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        database<span class="token punctuation">.</span><span class="token function">asyncLoad</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>buildDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// class查找范围</span>
        <span class="token class-name">JcClasspath</span> classpath <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">asyncClasspath</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>buildDir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// find class</span>
        <span class="token class-name">JcClassOrInterface</span> cString <span class="token operator">=</span>  classpath<span class="token punctuation">.</span><span class="token function">findClassOrNull</span><span class="token punctuation">(</span><span class="token string">&quot;org.example.C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">assert</span> cString <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">JcMethod</span><span class="token punctuation">&gt;</span></span> methodsToAnalyze <span class="token operator">=</span> cString<span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JcApplicationGraph</span> applicationGraph <span class="token operator">=</span> <span class="token class-name">ApplicationGraphFactory</span>
                <span class="token punctuation">.</span><span class="token function">asyncNewApplicationGraphForAnalysis</span><span class="token punctuation">(</span>classpath<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">UnitResolver</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> resolver <span class="token operator">=</span> <span class="token class-name">UnitResolversLibrary</span><span class="token punctuation">.</span><span class="token function">getMethodUnitResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">IfdsUnitRunnerFactory</span> runner <span class="token operator">=</span> <span class="token class-name">RunnersLibraryExt</span><span class="token punctuation">.</span><span class="token function">newTestRunnerFactory</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">VulnerabilityInstance</span><span class="token punctuation">&gt;</span></span> vulns <span class="token operator">=</span> <span class="token class-name">AnalysisMain</span><span class="token punctuation">.</span><span class="token function">runAnalysis</span><span class="token punctuation">(</span>
                applicationGraph<span class="token punctuation">,</span>
                resolver<span class="token punctuation">,</span>
                runner<span class="token punctuation">,</span>
                methodsToAnalyze<span class="token punctuation">,</span>
                <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SarifReport</span> report <span class="token operator">=</span> <span class="token class-name">SarifReport<span class="token punctuation">.</span>Companion</span><span class="token punctuation">.</span><span class="token function">fromVulnerabilities</span><span class="token punctuation">(</span>vulns<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">OutputStream</span> outputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">&quot;./report.sarif.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        report<span class="token punctuation">.</span><span class="token function">encodeToStream</span><span class="token punctuation">(</span>outputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
        outputStream<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        outputStream<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="三-analysis模块类结构" tabindex="-1"><a class="header-anchor" href="#三-analysis模块类结构" aria-hidden="true">#</a> 三 Analysis模块类结构</h1><p><img src="`+e+`" alt="jacodb类梳理.drawio"></p><h1 id="四-ifds过程内path遍历" tabindex="-1"><a class="header-anchor" href="#四-ifds过程内path遍历" aria-hidden="true">#</a> 四 ifds过程内path遍历</h1><h2 id="getname方法的代码如下" tabindex="-1"><a class="header-anchor" href="#getname方法的代码如下" aria-hidden="true">#</a> getName方法的代码如下：</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>example</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token function">getName</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token keyword">int</span> orderNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> k <span class="token operator">=</span> orderNum <span class="token operator">+</span>j<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> orderNum <span class="token operator">&gt;</span> j <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            k <span class="token operator">=</span> orderNum <span class="token operator">+</span> j<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>orderNum <span class="token operator">&lt;</span> j<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            orderNum <span class="token operator">++</span><span class="token punctuation">;</span>
            k <span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="getname方法的cfg" tabindex="-1"><a class="header-anchor" href="#getname方法的cfg" aria-hidden="true">#</a> getName方法的CFG：</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>%0 = 0
%1 = arg$0 + %0
%2 = %1
%5 = %2
if (arg$0 &lt;= %0)
goto JcInstRef(index=10)
%3 = arg$0 + %0
%2 = %3
%5 = %2
goto JcInstRef(index=10)
if (arg$0 &gt;= %0)
goto JcInstRef(index=15)
arg$0 = arg$0 + 1
%5 = %5 + 1
goto JcInstRef(index=10)
return &quot;&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ifds分析getname方法时处理的指令" tabindex="-1"><a class="header-anchor" href="#ifds分析getname方法时处理的指令" aria-hidden="true">#</a> ifds分析getName方法时处理的指令：</h2><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>------------&gt;Start-Facts&lt;------------ 
positionMethod: (id:72)org.example.C#getName(int)
lineNumber: 8
startStatement: noop
facts: [[ZERO fact]]


------------&gt;Normal&lt;------------ 
positionMethod: (id:72)org.example.C#getName(int)
lineNumber: 8
current: noop
next: %0 = 0


------------&gt;Normal&lt;------------ 
positionMethod: (id:72)org.example.C#getName(int)
lineNumber: 9
current: %0 = 0
next: %1 = arg$0 + %0


------------&gt;Normal&lt;------------ 
positionMethod: (id:72)org.example.C#getName(int)
lineNumber: 10
current: %1 = arg$0 + %0
next: %2 = %1


------------&gt;Normal&lt;------------ 
positionMethod: (id:72)org.example.C#getName(int)
lineNumber: 10
current: %2 = %1
next: %5 = %2


------------&gt;Normal&lt;------------ 
positionMethod: (id:72)org.example.C#getName(int)
lineNumber: 11
current: %5 = %2
next: if (arg$0 &lt;= %0)


------------&gt;Normal&lt;------------ 
positionMethod: (id:72)org.example.C#getName(int)
lineNumber: 11
current: if (arg$0 &lt;= %0)
next: goto JcInstRef(index=10)


------------&gt;Normal&lt;------------ 
positionMethod: (id:72)org.example.C#getName(int)
lineNumber: 11
current: if (arg$0 &lt;= %0)
next: %3 = arg$0 + %0


------------&gt;Normal&lt;------------ 
positionMethod: (id:72)org.example.C#getName(int)
lineNumber: 11
current: goto JcInstRef(index=10)
next: if (arg$0 &gt;= %0)


------------&gt;Normal&lt;------------ 
positionMethod: (id:72)org.example.C#getName(int)
lineNumber: 12
current: %3 = arg$0 + %0
next: %2 = %3


------------&gt;Normal&lt;------------ 
positionMethod: (id:72)org.example.C#getName(int)
lineNumber: 14
current: if (arg$0 &gt;= %0)
next: goto JcInstRef(index=15)


------------&gt;Normal&lt;------------ 
positionMethod: (id:72)org.example.C#getName(int)
lineNumber: 14
current: if (arg$0 &gt;= %0)
next: arg$0 = arg$0 + 1


------------&gt;Normal&lt;------------ 
positionMethod: (id:72)org.example.C#getName(int)
lineNumber: 12
current: %2 = %3
next: %5 = %2


------------&gt;Normal&lt;------------ 
positionMethod: (id:72)org.example.C#getName(int)
lineNumber: 14
current: goto JcInstRef(index=15)
next: return &quot;&quot;


------------&gt;Normal&lt;------------ 
positionMethod: (id:72)org.example.C#getName(int)
lineNumber: 15
current: arg$0 = arg$0 + 1
next: %5 = %5 + 1


------------&gt;Normal&lt;------------ 
positionMethod: (id:72)org.example.C#getName(int)
lineNumber: 12
current: %5 = %2
next: goto JcInstRef(index=10)


------------&gt;Normal&lt;------------ 
positionMethod: (id:72)org.example.C#getName(int)
lineNumber: 16
current: %5 = %5 + 1
next: goto JcInstRef(index=10)


------------&gt;Normal&lt;------------ 
positionMethod: (id:72)org.example.C#getName(int)
lineNumber: 12
current: goto JcInstRef(index=10)
next: if (arg$0 &gt;= %0)


------------&gt;Normal&lt;------------ 
positionMethod: (id:72)org.example.C#getName(int)
lineNumber: 16
current: goto JcInstRef(index=10)
next: if (arg$0 &gt;= %0)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="图示遍历过程" tabindex="-1"><a class="header-anchor" href="#图示遍历过程" aria-hidden="true">#</a> 图示遍历过程：</h2><p><img src="`+c+`" alt="image-20231212181955413"></p><p>此处需要注意的是遇到条件判断语句时，由于静态分析无法判断条件是否成立，遇到条件语句时遍历path会拆分成两条。这就虽然CFG中if (arg$0 &lt;= %0)只出现一次，ifds遍历时这条指令出现了两次的原因。</p><h1 id="五-自定义jaco-ifds分析器的关键点" tabindex="-1"><a class="header-anchor" href="#五-自定义jaco-ifds分析器的关键点" aria-hidden="true">#</a> 五 自定义Jaco-ifds分析器的关键点</h1><h2 id="domainfact" tabindex="-1"><a class="header-anchor" href="#domainfact" aria-hidden="true">#</a> DomainFact</h2><p>​ ZEROFact：0点</p><p>​ 其他Fact可以基于这个接口定义。例如框架已提供的UnusedVariableNode、TaintNode、NpeTaintNode、TaintAnalysisNode</p><p>​ 也可以理解成ifds图中的小圆圈。</p><h2 id="summaryfact" tabindex="-1"><a class="header-anchor" href="#summaryfact" aria-hidden="true">#</a> SummaryFact</h2><p>​ VulnerabilityLocation：记录问题信息</p><p>​ SummaryEdgeFact：记录边信息</p><p>​ CrossUnitCallFact：跨Unit调用时的调用信息</p><p>​ TraceGraphFact: 调用链信息</p><p>​ TraceGraph：处理完的调用链？</p><h2 id="summarystorage" tabindex="-1"><a class="header-anchor" href="#summarystorage" aria-hidden="true">#</a> SummaryStorage</h2><p>​ 存储SummaryFact信息，不同的Unit之间可以共享信息。</p><h2 id="analysisdependentevent" tabindex="-1"><a class="header-anchor" href="#analysisdependentevent" aria-hidden="true">#</a> AnalysisDependentEvent</h2><p>​ NewSummaryFact</p><p>​ 可以报告记录检测出的问题，以及其他的SummaryFact信息。</p><p>​ EdgeForOtherRunnerQuery</p><p>​ 跨unit调用时会产生这个事件。</p><h2 id="flowfunctionsspace" tabindex="-1"><a class="header-anchor" href="#flowfunctionsspace" aria-hidden="true">#</a> FlowFunctionsSpace</h2><p>​ 定义了domainFact的传播处理函数。</p><p>​ obtainPossibleStartFacts</p><p>​ 初始化fact。设置开始分析时的domainFact。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>initFacts: [[ZERO fact], [This is test fact]]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>​ obtainSequentFlowFunction</p><p>​ normal边处理函数。可以获取当前处理指令、下一条指令以及domainFact信息。一个示例数据：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>current : %4 = %1 + %2
next : %6 = this.genName(%4, %0)
domainFact : [ZERO fact]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ obtainCallToStartFlowFunction</p><p>​ call边处理函数。可以获取调用点、被调用函数以及domainFact信息。一个示例数据：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>callStatement: %6 = this.genName(%4, %0)
callee: (id:72)org.example.C#genName(int, java.lang.String)
domainFact: [ZERO fact]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ obtainCallToReturnFlowFunction</p><p>​ call-to-return边处理函数。可以获取调用点和返回点，以及domainFact信息。一个示例数据：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>callStatement: %6 = this.genName(%4, %0)
returnSite: return %6
domainFact: [ZERO fact]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​</p><p>​ obtainExitToReturnSiteFlowFunction</p><p>​ return边处理函数。可以获取调用点、返回点、退出点以及domainFact信息。一个示例数据：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>callStatement: %6 = this.genName(%4, %0)
returnSite: return %6
exitStatement: return %1
domainFact: [ZERO fact]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="handlenewedge" tabindex="-1"><a class="header-anchor" href="#handlenewedge" aria-hidden="true">#</a> handleNewEdge</h2><p>​ 发现新的edge就会调用这个函数处理。</p><p>​ 产生AnalysisDependentEvent，即NewSummaryFact和EdgeForOtherRunnerQuery事件。</p><h2 id="handlenewcrossunitcall" tabindex="-1"><a class="header-anchor" href="#handlenewcrossunitcall" aria-hidden="true">#</a> handleNewCrossUnitCall</h2><p>​ 跨unit调用时，调用该函数处理</p><p>​ 产生AnalysisDependentEvent，即NewSummaryFact和EdgeForOtherRunnerQuery事件。</p><h2 id="handleifdsresult" tabindex="-1"><a class="header-anchor" href="#handleifdsresult" aria-hidden="true">#</a> handleIfdsResult</h2><p>​ unit内fact传播结束后调用该函数处理。</p><p>​ 生成检测结果调用链信息。</p><h2 id="关系图" tabindex="-1"><a class="header-anchor" href="#关系图" aria-hidden="true">#</a> 关系图</h2><p>运行时的一个调用关系图，大概时这样的：</p><p><img src="`+o+`" alt="image-20231222185116977"></p><p>TestFact生成ZeroFact，为什么后续还会传播问题。</p><h1 id="六-jacodb已实现分析器解读" tabindex="-1"><a class="header-anchor" href="#六-jacodb已实现分析器解读" aria-hidden="true">#</a> 六 JacoDB已实现分析器解读</h1><h2 id="npe-空指针异常检测" tabindex="-1"><a class="header-anchor" href="#npe-空指针异常检测" aria-hidden="true">#</a> NPE(空指针异常检测)</h2><h3 id="maxpathlength" tabindex="-1"><a class="header-anchor" href="#maxpathlength" aria-hidden="true">#</a> maxPathLength</h3><p>​ 生成RunnerFactory时指定该参数,默认是5。</p><p>​ NPE规则中使用</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code>    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">transmitDataFlow</span><span class="token punctuation">(</span>from<span class="token operator">:</span> JcExpr<span class="token punctuation">,</span> <span class="token keyword">to</span><span class="token operator">:</span> JcValue<span class="token punctuation">,</span> atInst<span class="token operator">:</span> JcInst<span class="token punctuation">,</span> fact<span class="token operator">:</span> DomainFact<span class="token punctuation">,</span> dropFact<span class="token operator">:</span> Boolean<span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>DomainFact<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> default <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>dropFact <span class="token operator">&amp;&amp;</span> fact <span class="token operator">!=</span> ZEROFact<span class="token punctuation">)</span> <span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token function">listOf</span><span class="token punctuation">(</span>fact<span class="token punctuation">)</span>
        <span class="token keyword">val</span> toPath <span class="token operator">=</span> <span class="token keyword">to</span><span class="token punctuation">.</span><span class="token function">toPathOrNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>maxPathLength<span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token keyword">return</span> default
        <span class="token operator">..</span><span class="token operator">..</span><span class="token operator">..</span>
        <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ismainanalyzer" tabindex="-1"><a class="header-anchor" href="#ismainanalyzer" aria-hidden="true">#</a> isMainAnalyzer</h3><p>​ 一般正向分析设置成true，反向分析设置成false。</p><h3 id="obtainpossiblestartfacts" tabindex="-1"><a class="header-anchor" href="#obtainpossiblestartfacts" aria-hidden="true">#</a> obtainPossibleStartFacts</h3><p>​ 每个函数开始分析时，设置可能的初始domainFact。</p><h4 id="npe规则处理" tabindex="-1"><a class="header-anchor" href="#npe规则处理" aria-hidden="true">#</a> NPE规则处理</h4><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">obtainPossibleStartFacts</span><span class="token punctuation">(</span>startStatement<span class="token operator">:</span> JcInst<span class="token punctuation">)</span><span class="token operator">:</span> Collection<span class="token operator">&lt;</span>DomainFact<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> result <span class="token operator">=</span> mutableListOf<span class="token operator">&lt;</span>DomainFact<span class="token operator">&gt;</span><span class="token punctuation">(</span>ZEROFact<span class="token punctuation">)</span>
<span class="token comment">//        return result</span>

        <span class="token keyword">val</span> method <span class="token operator">=</span> startStatement<span class="token punctuation">.</span>location<span class="token punctuation">.</span>method

        <span class="token comment">// Note that here and below we intentionally don&#39;t expand fields because this may cause</span>
        <span class="token comment">//  an increase of false positives and significant performance drop</span>

        <span class="token comment">// Possibly null arguments</span>
        result <span class="token operator">+=</span> method<span class="token punctuation">.</span><span class="token function">flowGraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>locals
            <span class="token punctuation">.</span>filterIsInstance<span class="token operator">&lt;</span>JcArgument<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">filter</span> <span class="token punctuation">{</span> method<span class="token punctuation">.</span>parameters<span class="token punctuation">[</span>it<span class="token punctuation">.</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>isNullable <span class="token operator">!=</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
            <span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> <span class="token function">NpeTaintNode</span><span class="token punctuation">(</span>AccessPath<span class="token punctuation">.</span><span class="token function">fromLocal</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

        <span class="token comment">// Possibly null statics</span>
        <span class="token comment">// TODO: handle statics in a more general manner</span>
        result <span class="token operator">+=</span> method<span class="token punctuation">.</span>enclosingClass<span class="token punctuation">.</span>fields
            <span class="token punctuation">.</span><span class="token function">filter</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span>isNullable <span class="token operator">!=</span> <span class="token boolean">false</span> <span class="token operator">&amp;&amp;</span> it<span class="token punctuation">.</span>isStatic <span class="token punctuation">}</span>
            <span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> <span class="token function">NpeTaintNode</span><span class="token punctuation">(</span>AccessPath<span class="token punctuation">.</span><span class="token function">fromStaticField</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

        <span class="token keyword">val</span> thisInstance <span class="token operator">=</span> method<span class="token punctuation">.</span>thisInstance

        <span class="token comment">// Possibly null public non-final fields</span>
        result <span class="token operator">+=</span> method<span class="token punctuation">.</span>enclosingClass<span class="token punctuation">.</span>fields
            <span class="token punctuation">.</span><span class="token function">filter</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span>isNullable <span class="token operator">!=</span> <span class="token boolean">false</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>it<span class="token punctuation">.</span>isStatic <span class="token operator">&amp;&amp;</span> it<span class="token punctuation">.</span>isPublic <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>it<span class="token punctuation">.</span>isFinal <span class="token punctuation">}</span>
            <span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span>
                <span class="token function">NpeTaintNode</span><span class="token punctuation">(</span>
                    AccessPath<span class="token punctuation">.</span><span class="token function">fromOther</span><span class="token punctuation">(</span>AccessPath<span class="token punctuation">.</span><span class="token function">fromLocal</span><span class="token punctuation">(</span>thisInstance<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">listOf</span><span class="token punctuation">(</span><span class="token function">FieldAccessor</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 从上面代码可以看出，无条件加了ZEROFact。查找判断了【函数入参】、【类静态变量】、【类的非final成员变量】中可能为空的变量，如果可能为空则增加一个NpeTaintNode。</p><h3 id="handlenewedge-1" tabindex="-1"><a class="header-anchor" href="#handlenewedge-1" aria-hidden="true">#</a> handleNewEdge</h3><h3 id="默认处理" tabindex="-1"><a class="header-anchor" href="#默认处理" aria-hidden="true">#</a> 默认处理</h3><p>​ 在isMainAnalyzer为true时，并且edge是start-to-end边时，返回这个edge的NewSummaryFact事件。start-to-end边是指在IfdsEdge中u、v两个Vertex，其中v中的statement是当前函数的exit points。u、v在执行顺序上，u在前v在后。其中edge中的u是产生DomainFact的位置。如果有n个domainFact，同一条边也会被处理n次。</p><p>​ 一个实际例子看handleNewedge处理了哪些边。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token keyword">int</span> orderNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">genName</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">genName</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;alex&quot;</span> <span class="token operator">+</span> k<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>getName指令</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>%0 = null
%1 = 3
%2 = this.genName(%1, %0)
return %2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>genName指令</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>%0 = arg$1.length()
%1 = JcDynamicCallExpr(bsmRef=org.jacodb.impl.cfg.TypedMethodRefImpl@bbe284c6, bsmArgs=[&quot;alex&quot;], callSiteMethodName=makeConcatWithConstants, callSiteArgTypes=[org.jacodb.api.PredefinedPrimitive@197ef], callSiteReturnType=org.jacodb.impl.types.JcClassTypeImpl@e7c6d061, callSiteArgs=[arg$0])
return %1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>处理日志</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>------------&gt;handleNewEdge&lt;------------ 
method:getName
edge: IfdsEdge(u=IfdsVertex(statement=noop, domainFact=[ZERO fact]), v=IfdsVertex(statement=noop, domainFact=[ZERO fact]))

------------&gt;handleNewEdge&lt;------------ 
method:genName
edge: IfdsEdge(u=IfdsVertex(statement=noop, domainFact=[ZERO fact]), v=IfdsVertex(statement=noop, domainFact=[ZERO fact]))

------------&gt;handleNewEdge&lt;------------ 
method:getName
edge: IfdsEdge(u=IfdsVertex(statement=noop, domainFact=[ZERO fact]), v=IfdsVertex(statement=%0 = null, domainFact=[ZERO fact]))

------------&gt;handleNewEdge&lt;------------ 
method:genName
edge: IfdsEdge(u=IfdsVertex(statement=noop, domainFact=[ZERO fact]), v=IfdsVertex(statement=%0 = arg$1.length(), domainFact=[ZERO fact]))

------------&gt;handleNewEdge&lt;------------ 
method:getName
edge: IfdsEdge(u=IfdsVertex(statement=noop, domainFact=[ZERO fact]), v=IfdsVertex(statement=%1 = 3, domainFact=[ZERO fact]))

------------&gt;handleNewEdge&lt;------------ 
method:genName
edge: IfdsEdge(u=IfdsVertex(statement=noop, domainFact=[ZERO fact]), v=IfdsVertex(statement=%1 = JcDynamicCallExpr(bsmRef=org.jacodb.impl.cfg.TypedMethodRefImpl@bbe284c6, bsmArgs=[&quot;alex&quot;], callSiteMethodName=makeConcatWithConstants, callSiteArgTypes=[org.jacodb.api.PredefinedPrimitive@197ef], callSiteReturnType=org.jacodb.impl.types.JcClassTypeImpl@e7c6d061, callSiteArgs=[arg$0]), domainFact=[ZERO fact]))

------------&gt;handleNewEdge&lt;------------ 
method:getName
edge: IfdsEdge(u=IfdsVertex(statement=noop, domainFact=[ZERO fact]), v=IfdsVertex(statement=%2 = this.genName(%1, %0), domainFact=[ZERO fact]))

------------&gt;handleNewEdge&lt;------------ 
method:genName
edge: IfdsEdge(u=IfdsVertex(statement=noop, domainFact=[ZERO fact]), v=IfdsVertex(statement=return %1, domainFact=[ZERO fact]))

return %1
------------&gt;handleNewEdge&lt;------------ 
method:getName
edge: IfdsEdge(u=IfdsVertex(statement=noop, domainFact=[ZERO fact]), v=IfdsVertex(statement=return %2, domainFact=[ZERO fact]))

return %2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 从上面处理日志可以看出，getName和genName方法的指令是并行处理的(同一个unit中的不同方法也是并行处理的)。最后两条分别是两个方法的start-to-end边。在exit-point记录SummaryEdgeFact，<strong>猜测</strong>是在计算路径可达时需要使用。</p><h4 id="npe规则的处理" tabindex="-1"><a class="header-anchor" href="#npe规则的处理" aria-hidden="true">#</a> NPE规则的处理</h4><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">handleNewEdge</span><span class="token punctuation">(</span>edge<span class="token operator">:</span> IfdsEdge<span class="token punctuation">)</span><span class="token operator">:</span> List<span class="token operator">&lt;</span>AnalysisDependentEvent<span class="token operator">&gt;</span> <span class="token operator">=</span> buildList <span class="token punctuation">{</span>
    <span class="token keyword">val</span> <span class="token punctuation">(</span>inst<span class="token punctuation">,</span> fact0<span class="token punctuation">)</span> <span class="token operator">=</span> edge<span class="token punctuation">.</span>v
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fact0 <span class="token keyword">is</span> NpeTaintNode <span class="token operator">&amp;&amp;</span> fact0<span class="token punctuation">.</span>activation <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> fact0<span class="token punctuation">.</span>variable<span class="token punctuation">.</span><span class="token function">isDereferencedAt</span><span class="token punctuation">(</span>inst<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">val</span> message <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;Dereference of possibly-null </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">fact0<span class="token punctuation">.</span>variable</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span></span>
        <span class="token keyword">val</span> desc <span class="token operator">=</span> <span class="token function">VulnerabilityDescription</span><span class="token punctuation">(</span><span class="token function">SarifMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">,</span> ruleId<span class="token punctuation">)</span>
        <span class="token function">add</span><span class="token punctuation">(</span><span class="token function">NewSummaryFact</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">VulnerabilityLocation</span><span class="token punctuation">(</span>desc<span class="token punctuation">,</span> edge<span class="token punctuation">.</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        verticesWithTraceGraphNeeded<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>edge<span class="token punctuation">.</span>v<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">addAll</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">handleNewEdge</span><span class="token punctuation">(</span>edge<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 如果NpeTaintNode中的变量，在新的edge指令中被使用了，报一个包含漏洞信息的NewSummaryFact事件，并记录edge信息。调用默认实现功能。</p><h3 id="taintnode" tabindex="-1"><a class="header-anchor" href="#taintnode" aria-hidden="true">#</a> TaintNode</h3><p>​ 实现DomainFact接口</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>val variable: AccessPath
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>val activation: JcInst? = null
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>val nodeType: String
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>abstract fun updateActivation(newActivation: JcInst?): TaintNode
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>abstract fun moveToOtherPath(newPath: AccessPath): TaintNode
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h1 id="七-其他" tabindex="-1"><a class="header-anchor" href="#七-其他" aria-hidden="true">#</a> 七 其他</h1><h2 id="jvm-description-of-method" tabindex="-1"><a class="header-anchor" href="#jvm-description-of-method" aria-hidden="true">#</a> jvm description of method</h2><p>入参为空，返回值为String类型。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>()Ljava/lang/String;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>入参为int类型，返回值为空。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>(I)Ljava/lang/String;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="类方法介绍" tabindex="-1"><a class="header-anchor" href="#类方法介绍" aria-hidden="true">#</a> 类方法介绍</h2><p>​ JcClasspath方法介绍</p><p>​ findClassOrNull：根据类名(包括路径)查找单个类。</p><p>​ findClasses：根据类名(包括路径)查找多个类，有时不同jar包存在类型完全相同的类。</p><h2 id="units解析" tabindex="-1"><a class="header-anchor" href="#units解析" aria-hidden="true">#</a> units解析</h2><p>​ methodUnit：单个方法就作为一个unit，速度快，精度低。</p><p>​ classUnit：单个类作为一个unit。</p><p>​ packageUnit：同一个包下的类作为一个unit。</p><p>​ singletonUnit: 整个分析过程就一个unit，速度慢，精度高。</p><p>​ 多个unit之间进行单独的并发分析，分析结果可以通过SummaryStorage中存储的信息进行共享。unit数量越多结果越不准确，速度越快。</p><h2 id="applicationgraph" tabindex="-1"><a class="header-anchor" href="#applicationgraph" aria-hidden="true">#</a> ApplicationGraph</h2><h3 id="jcapplicationgraphimpl" tabindex="-1"><a class="header-anchor" href="#jcapplicationgraphimpl" aria-hidden="true">#</a> JcApplicationGraphImpl</h3><h3 id="simplifiedjcapplicationgraph" tabindex="-1"><a class="header-anchor" href="#simplifiedjcapplicationgraph" aria-hidden="true">#</a> SimplifiedJcApplicationGraph</h3><p>​ 这个是专为 IFDS [JcApplicationGraph] 设计的Graph,有以下特殊点：</p><p>​ 1、忽略与 [bannedPackagePrefixes] 匹配的方法调用（即将它们视为没有被调用者的简单指令）</p><p>​ 2、在 [callers] 中只返回之前访问过的调用点</p><p>​ 3、在每个方法的开头添加了一个特殊的 [JcNoopInst] 指令（因为向后分析可能希望方法以中性指令开始）。JcNoopInst指无操作指令。</p><h3 id="backwardapplicationgraph" tabindex="-1"><a class="header-anchor" href="#backwardapplicationgraph" aria-hidden="true">#</a> BackwardApplicationGraph</h3><h2 id="jaco-ifds默认的空指针检测问题" tabindex="-1"><a class="header-anchor" href="#jaco-ifds默认的空指针检测问题" aria-hidden="true">#</a> jaco-ifds默认的空指针检测问题</h2><p>​ 同一个变量，多处出现空指针问题，只会检测出先遇到的问题代码。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token keyword">int</span> orderNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">genName</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">genName</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;alex&quot;</span><span class="token operator">+</span>k<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ 以上代码，如果getName方法为检测入口方法。只会检测出getName方法中的str.length();有空指针问题。genName方法中的str.length();不会被检测出来。以下代码可以检测出genName的空指针问题。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token keyword">int</span> orderNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">genName</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">genName</span><span class="token punctuation">(</span><span class="token keyword">int</span> k<span class="token punctuation">,</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;alex&quot;</span><span class="token operator">+</span>k<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​</p>`,242),u=[l];function r(k,d){return s(),a("div",null,u)}const v=n(i,[["render",r],["__file","jacoDB库使用.html.vue"]]);export{v as default};
